/*! cornerstone-tools - 2.5.0 - 2020-02-18 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstoneTools",[],t):"object"==typeof exports?exports.cornerstoneTools=t():e.cornerstoneTools=t()}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=71)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=window.cornerstone,o=window.cornerstoneMath,r=window.Hammer;t.default={set cornerstone(e){a=e},get cornerstone(){return a},set cornerstoneMath(e){o=e},get cornerstoneMath(){return o},set Hammer(e){r=e},get Hammer(){return r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_REMOVED:"cornerstonemeasurementremoved",MEASUREMENT_COMPLETED:"cornerstonemeasurementcompleted",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonestackscroll",LINE_SAMPLE_UPDATED:"cornerstonelinesampleupdated"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=void 0;var a=l(n(1)),o=l(n(0)),r=n(30),i=l(n(6));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){var t=o.default.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=r.globalImageIdSpecificToolStateManager),t.toolStateManager}t.addToolState=function(e,t,n){u(e).add(e,t,n);var o=a.default.MEASUREMENT_ADDED,r={toolType:t,element:e,measurementData:n};(0,i.default)(e,o,r)},t.getToolState=function(e,t){return u(e).get(e,t)},t.removeToolState=function(e,t,n){for(var o=u(e).get(e,t),r=-1,l=0;l<o.data.length;l++)o.data[l]===n&&(r=l);if(-1!==r){o.data.splice(r,1);var d=a.default.MEASUREMENT_REMOVED,s={toolType:t,element:e,measurementData:n};(0,i.default)(e,d,s)}},t.clearToolState=function(e,t){var n=u(e).get(e,t);void 0!==n&&(n.data=[])},t.setElementToolStateManager=function(e,t){o.default.cornerstone.getEnabledElement(e).toolStateManager=t},t.getElementToolStateManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewContext=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},t.draw=function(e,t){e.save(),t(e),e.restore()},t.path=d,t.setShadow=function(e,t){t.shadow&&(e.shadowColor=(0,o.getDefault)(t.shadowColor,"#000000"),e.shadowBlur=(0,o.getDefault)(t.shadowBlur,0),e.shadowOffsetX=(0,o.getDefault)(t.shadowOffsetX,1),e.shadowOffsetY=(0,o.getDefault)(t.shadowOffsetY,1))},t.drawLine=function(e,t,n,o,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";d(e,r,function(e){if("pixel"===i){var r=a.default.cornerstone;n=r.pixelToCanvas(t,n),o=r.pixelToCanvas(t,o)}e.moveTo(n.x,n.y),e.lineTo(o.x,o.y)})},t.drawLines=function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";d(e,o,function(e){n.forEach(function(n){var o=n.start,i=n.end;if("pixel"===r){var l=a.default.cornerstone;o=l.pixelToCanvas(t,o),i=l.pixelToCanvas(t,i)}e.moveTo(o.x,o.y),e.lineTo(i.x,i.y)})})},t.drawJoinedLines=function(e,t,n,o,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";d(e,r,function(e){if("pixel"===i){var r=a.default.cornerstone;n=r.pixelToCanvas(t,n),o=o.map(function(e){return r.pixelToCanvas(t,e)})}e.moveTo(n.x,n.y),o.forEach(function(t){var n=t.x,a=t.y;e.lineTo(n,a)})})},t.drawCircle=function(e,t,n,o,r){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=a.default.cornerstone.pixelToCanvas(t,n));d(e,r,function(e){e.arc(n.x,n.y,o,0,2*Math.PI)})},t.drawRotatedEllipse=function(e,t,n,o,r,i){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"pixel",s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=r.isFirst;"pixel"===u&&(n=a.default.cornerstone.pixelToCanvas(t,n),o=a.default.cornerstone.pixelToCanvas(t,o),r=a.default.cornerstone.pixelToCanvas(t,r));var f=a.default.cornerstone.getViewport(t),v=t.clientWidth,g=t.clientHeight,m=f.scale,h=f.translation,p=f.rotation-s,E={x:v/2+h.x*m,y:g/2+h.y*m};Math.abs(p)>.05&&(n=(0,l.rotatePoint)(n,E,-p),o=(0,l.rotatePoint)(o,E,-p),r=a.default.cornerstone.pixelToCanvas(t,r));var T=Math.abs(n.x-o.x),y=Math.abs(n.y-o.y),M=Math.min(n.x,o.x),x=Math.min(n.y,o.y),_={x:M+T/2,y:x+y/2};Math.abs(p)>.05&&(_=(0,l.rotatePoint)(_,E,p));var S=function(e){return e*e},O=Math.sqrt(S(T)+S(y)),b=c?0:Math.sqrt(S(r.x-_.x)+S(r.y-_.y)),C=p*Math.PI/180+Math.atan2(o.y-n.y,o.x-n.x);d(e,i,function(e){e.ellipse(_.x,_.y,O/2,b,C,0,2*Math.PI)})},t.drawEllipse=function(e,t,n,o,r){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=a.default.cornerstone.pixelToCanvas(t,n),o=a.default.cornerstone.pixelToCanvas(t,o));var i=Math.min(n.x,o.x),l=Math.min(n.y,o.y),u=Math.abs(n.x-o.x),s=Math.abs(n.y-o.y),c=u/2*.5522848,f=s/2*.5522848,v=i+u,g=l+s,m=i+u/2,h=l+s/2;d(e,r,function(e){e.moveTo(i,h),e.bezierCurveTo(i,h-f,m-c,l,m,l),e.bezierCurveTo(m+c,l,v,h-f,v,h),e.bezierCurveTo(v,h+f,m+c,g,m,g),e.bezierCurveTo(m-c,g,i,h+f,i,h),e.closePath()})},t.drawRect=function(e,t,n,o,r){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=a.default.cornerstone;n=i.pixelToCanvas(t,n),o=i.pixelToCanvas(t,o)}var l=Math.min(n.x,o.x),u=Math.min(n.y,o.y),s=Math.abs(n.x-o.x),c=Math.abs(n.y-o.y);d(e,r,function(e){e.rect(l,u,s,c)})},t.fillOutsideRect=function(e,t,n,o,r){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=a.default.cornerstone;n=i.pixelToCanvas(t,n),o=i.pixelToCanvas(t,o)}var l=Math.min(n.x,o.x),u=Math.min(n.y,o.y),s=Math.abs(n.x-o.x),c=Math.abs(n.y-o.y);d(e,r,function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(l+s,u,-s,c)})},t.fillBox=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)},t.fillTextLines=function(e,t,n,a,o){var r=i.default.getFontSize();e.font=i.default.getFont(),e.textBaseline="top",e.fillStyle=a,n.forEach(function(n,a){e.fillText(n,t.left+o,t.top+o+a*(r+o))})};var a=u(n(0)),o=n(149),r=u(n(13)),i=u(n(22)),l=n(38);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){var a=t.color,o=t.lineWidth,i=t.fillStyle,l=t.lineDash;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=o||void 0===o&&r.default.getToolWidth()||e.lineWidth,l&&e.setLineDash(l),n(e),i&&(e.fillStyle=i,e.fill()),e.stroke(),l&&e.setLineDash([])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};t.getToolOptions=function(e,t){if(!a[e])return{};var n=a[e].find(function(e){return e.element===t});return n?n.options:{}},t.setToolOptions=function(e,t,n){if(a[e]){var o=a[e].findIndex(function(e){return e.element===t});if(-1===o)a[e].push({element:t,options:n});else{var r=a[e][o].options||{};a[e][o].options=Object.assign(r,n)}}else a[e]=[{element:t,options:n}]},t.clearToolOptions=function(e,t){var n=a[e];n&&(a[e]=n.filter(function(e){return e.element!==t}))},t.clearToolOptionsByToolType=function(e){delete a[e]},t.clearToolOptionsByElement=function(e){for(var t in a)a[t]=a[t].filter(function(t){return t.element!==e})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=void 0;"function"==typeof window.CustomEvent?a=new CustomEvent(t,{detail:n,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,n);return e.dispatchEvent(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="white",o="greenyellow",r="transparent";var i={setFillColor:function(e){r=e},getFillColor:function(){return r},setToolColor:function(e){a=e},getToolColor:function(){return a},setActiveColor:function(e){o=e},getActiveColor:function(){return o},getColorIfActive:function(e){return e.color?e.color:e.active?o:a}};t.default=i},function(e,t,n){"use strict";function a(e,t,n){return Math.min(Math.max(t,e),n)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,t.clipToBox=function(e,t){e.x=a(e.x,0,t.width),e.y=a(e.y,0,t.height)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,l){Object.keys(n).forEach(function(u){var d=n[u];if(!0!==d.drawnIndependently&&(!l||!0!==l.drawHandlesIfActive||d.active)){var s=function(e){var t=void 0;t=e&&e.handleRadius?e.handleRadius:r;return t}(l),c={color:i,lineWidth:d.active?a.default.getActiveWidth():a.default.getToolWidth(),fillStyle:l&&l.fill};(0,o.drawCircle)(e,t.element,d,s,c)}})};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(13)),o=n(3);var r=6},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={},n=e.toolType;function h(t){var r=t.detail,i=r.element,l=(0,m.getToolOptions)(n,i);(0,f.default)(r.which,l.mouseButtonMask)&&(e.addNewMeasurement?e.addNewMeasurement(r):function(t){var r=o.default.cornerstone,i=t.element,l=e.createNewMeasurement(t);if(!l)return;(0,v.addToolState)(t.element,n,l),i.removeEventListener(a.default.MOUSE_MOVE,T),i.removeEventListener(a.default.MOUSE_DOWN,y),i.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),x&&i.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x);r.updateImage(i);var s=void 0;s=1===Object.keys(l.handles).length?u.default:d.default;var f=void 0;f=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage;s(t,n,l,l.handles.end,function(){l.active=!1,l.invalidated=!0,(0,c.default)(t,l.handles)?(0,v.removeToolState)(i,n,l):e.onHandleDoneMove&&e.onHandleDoneMove(i,l),i.addEventListener(a.default.MOUSE_MOVE,T),i.addEventListener(a.default.MOUSE_DOWN,y),i.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),x&&i.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x),r.updateImage(i)},f)}(r),t.preventDefault(),t.stopPropagation())}function p(t){var a=t.detail;r.default.setCoords(a);var i=(0,v.getToolState)(a.element,n);if(i){for(var u=!1,d=0;d<i.data.length;d++){var s=a.currentPoints.canvas,c=i.data[d];!0===(0,l.default)(a.element,c.handles,s)&&(u=!0),(e.pointNearTool(a.element,c,s)&&!c.active||!e.pointNearTool(a.element,c,s)&&c.active)&&(c.active=!c.active,u=!0)}!0===u&&o.default.cornerstone.updateImage(a.element)}}function E(t){var r=t.detail,l=void 0,d=r.element,g=(0,m.getToolOptions)(n,d);if((0,f.default)(r.which,g.mouseButtonMask)){var h=r.startPoints.canvas,p=(0,v.getToolState)(t.currentTarget,n);if(p){var E=void 0,y=void 0;for(y=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,E=0;E<p.data.length;E++){l=p.data[E];var M=(0,i.default)(d,l.handles,h,6);if(M)return d.removeEventListener(a.default.MOUSE_MOVE,T),l.active=!0,(0,u.default)(r,n,l,M,_,y),t.stopImmediatePropagation(),t.stopPropagation(),void t.preventDefault()}if(e.pointNearTool){var x=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(E=0;E<p.data.length;E++)if((l=p.data[E]).active=!1,e.pointNearTool(d,l,h))return l.active=!0,d.removeEventListener(a.default.MOUSE_MOVE,T),(0,s.default)(t,l,p,n,x,_),t.stopImmediatePropagation(),t.stopPropagation(),void t.preventDefault()}}}function _(){l.invalidated=!0,(0,c.default)(r,l.handles)?(0,v.removeToolState)(d,n,l):e.onHandleDoneMove&&e.onHandleDoneMove(d,l),o.default.cornerstone.updateImage(d),d.addEventListener(a.default.MOUSE_MOVE,T)}}var T=e.mouseMoveCallback||p,y=e.mouseDownCallback||E,M=e.mouseDownActivateCallback||h,x=e.mouseDoubleClickCallback;var _={enable:function(t){t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,T),t.removeEventListener(a.default.MOUSE_DOWN,y),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),x&&t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),t.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.default.cornerstone.updateImage(t)},disable:function(t){t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,T),t.removeEventListener(a.default.MOUSE_DOWN,y),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),x&&t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),o.default.cornerstone.updateImage(t)},activate:function(t,r){(0,m.setToolOptions)(n,t,{mouseButtonMask:r}),t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,T),t.removeEventListener(a.default.MOUSE_DOWN,y),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),t.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,T),t.addEventListener(a.default.MOUSE_DOWN,y),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),x&&(t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x)),o.default.cornerstone.updateImage(t)},deactivate:function(t,r){(0,m.setToolOptions)(n,t,{mouseButtonMask:r});var i=a.default.TOOL_DEACTIVATED,l={mouseButtonMask:r,toolType:n,type:i};(0,g.default)(t,i,l),t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,T),t.removeEventListener(a.default.MOUSE_DOWN,y),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,M),t.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,T),t.addEventListener(a.default.MOUSE_DOWN,y),x&&(t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x)),e.deactivate&&e.deactivate(t,r),o.default.cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e},mouseDownCallback:E,mouseMoveCallback:p,mouseDownActivateCallback:h};return e.pointNearTool&&(_.pointNearTool=e.pointNearTool),x&&(_.mouseDoubleClickCallback=x),e.addNewMeasurement&&(_.addNewMeasurement=e.addNewMeasurement),_};var a=h(n(1)),o=h(n(0)),r=h(n(36)),i=h(n(24)),l=h(n(29)),u=h(n(35)),d=h(n(28)),s=h(n(34)),c=h(n(15)),f=h(n(5)),v=n(2),g=h(n(6)),m=n(4);function h(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(1)),o=f(n(0)),r=f(n(15)),i=f(n(24)),l=f(n(61)),u=f(n(32)),d=f(n(62)),s=n(2),c=f(n(6));function f(e){return e&&e.__esModule?e:{default:e}}function v(e){Object.keys(e).forEach(function(t){e[t].active=!1})}function g(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&v(n.handles)}}t.default=function(e){function t(i){var l=i.detail;e.addNewMeasurement?e.addNewMeasurement(l):function(i){var l=o.default.cornerstone,d=i.element,c=e.createNewMeasurement(i);if(c){if((0,s.addToolState)(d,e.toolType,c),1===Object.keys(c.handles).length&&i.type===a.default.TAP)return c.active=!1,c.handles.end.active=!1,c.handles.end.highlight=!1,c.invalidated=!0,(0,r.default)(i,c.handles)?(0,s.removeToolState)(d,e.toolType,c):e.onHandleDoneMove&&e.onHandleDoneMove(d,c),void l.updateImage(d);d.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),d.removeEventListener(a.default.TAP,e.tapCallback||n),d.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),l.updateImage(d),(0,u.default)(i,e.toolType,c,c.handles.end,function(){c.active=!1,c.invalidated=!0,(0,r.default)(i,c.handles)?(0,s.removeToolState)(d,e.toolType,c):e.onHandleDoneMove&&e.onHandleDoneMove(d,c),d.addEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),d.addEventListener(a.default.TAP,e.tapCallback||n),d.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),l.updateImage(d)})}}(l),i.stopImmediatePropagation(),i.preventDefault()}function n(u){var c=u.detail,v=o.default.cornerstone,m=c.element,h=c.currentPoints.canvas,p=(0,s.getToolState)(u.currentTarget,e.toolType),E=void 0,T=void 0;function y(){g(p),(0,r.default)(c,E.handles)?(0,s.removeToolState)(m,e.toolType,E):e.onHandleDoneMove&&e.onHandleDoneMove(m,E),v.updateImage(m),m.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),m.addEventListener(a.default.TAP,e.tapCallback||n)}if(g(p),p)for(T=0;T<p.data.length;T++){E=p.data[T];var M=(0,i.default)(m,E.handles,h,25);if(M)return m.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),m.removeEventListener(a.default.TAP,e.tapCallback||n),E.active=!0,M.active=!0,v.updateImage(m),(0,l.default)(u,e.toolType,E,M,y),u.stopImmediatePropagation(),void u.preventDefault()}if(p&&e.pointNearTool)for(T=0;T<p.data.length;T++)if(E=p.data[T],e.pointNearTool(m,E,h))return m.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),m.removeEventListener(a.default.TAP,e.tapCallback||n),E.active=!0,v.updateImage(m),(0,d.default)(u,E,p,e.toolType,!0,y),u.stopImmediatePropagation(),void u.preventDefault();return e.touchDownActivateCallback?e.touchDownActivateCallback(u):t(u),!1}function f(t){var u=t.detail,v=o.default.cornerstone,g=u.element,m=u.startPoints.canvas,h=void 0,p=(0,s.getToolState)(t.currentTarget,e.toolType),E=void 0;function T(t,o){h.active=!1,h.invalidated=!0,(0,r.default)(u,h.handles)?(0,s.removeToolState)(u.element,e.toolType,h):e.onHandleDoneMove&&e.onHandleDoneMove(g,h),v.updateImage(u.element),g.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),g.addEventListener(a.default.TAP,e.tapCallback||n),e.pressCallback&&g.addEventListener(a.default.TOUCH_PRESS,e.pressCallback),t&&t.type===a.default.TOUCH_PRESS&&(0,c.default)(g,t.type,o)}if(p){for(E=0;E<p.data.length;E++){h=p.data[E];var y=(0,i.default)(u.element,h.handles,m,28);if(y)return g.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),g.removeEventListener(a.default.TAP,e.tapCallback||n),e.pressCallback&&g.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),h.active=!0,(0,l.default)(t,e.toolType,h,y,T),t.stopImmediatePropagation(),t.preventDefault(),void t.stopPropagation()}if(e.pointNearTool)for(E=0;E<p.data.length;E++)if(h=p.data[E],e.pointNearTool(u.element,h,m))return g.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),g.removeEventListener(a.default.TAP,e.tapCallback||n),e.pressCallback&&g.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),(0,d.default)(t,h,p,e.toolType,!0,T),t.stopImmediatePropagation(),t.preventDefault(),void t.stopPropagation()}}var v={enable:function(r){r.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),r.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),r.removeEventListener(a.default.TAP,e.tapCallback||n),r.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),e.doubleTapCallback&&r.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),e.pressCallback&&r.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),o.default.cornerstone.updateImage(r)},disable:function(r){r.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),r.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),r.removeEventListener(a.default.TAP,e.tapCallback||n),e.doubleTapCallback&&r.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),e.pressCallback&&r.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),o.default.cornerstone.updateImage(r)},activate:function(r){r.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),r.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),r.removeEventListener(a.default.TAP,e.tapCallback||n),r.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),r.addEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),r.addEventListener(a.default.TAP,e.tapCallback||n),e.doubleTapCallback&&(r.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),r.addEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback)),e.pressCallback&&(r.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),r.addEventListener(a.default.TOUCH_PRESS,e.pressCallback)),o.default.cornerstone.updateImage(r)},deactivate:function(r){var i=a.default.TOOL_DEACTIVATED,l={toolType:e.toolType,type:i};(0,c.default)(r,i,l),r.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.removeEventListener(a.default.TOUCH_START,e.touchStartCallback||f),r.removeEventListener(a.default.TOUCH_START_ACTIVE,e.touchDownActivateCallback||t),r.removeEventListener(a.default.TAP,e.tapCallback||n),r.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),r.addEventListener(a.default.TOUCH_START,e.touchStartCallback||f),e.doubleTapCallback&&r.removeEventListener(a.default.DOUBLE_TAP,e.doubleTapCallback),e.pressCallback&&r.removeEventListener(a.default.TOUCH_PRESS,e.pressCallback),o.default.cornerstone.updateImage(r)},touchStartCallback:e.touchStartCallback||f,touchDownActivateCallback:e.touchDownActivateCallback||t,tapCallback:e.tapCallback||n};return e.pointNearTool&&(v.pointNearTool=e.pointNearTool),e.doubleTapCallback&&(v.doubleTapCallback=e.doubleTapCallback),e.pressCallback&&(v.pressCallback=e.pressCallback),e.addNewMeasurement&&(v.addNewMeasurement=e.addNewMeasurement),v}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textBoxWidth=r,t.default=function(e,t,n,i,l,u){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var d=a.default.getFontSize(),s=a.default.getBackgroundColor(),c=0;t.forEach(function(t){var n=r(e,t,5);c=Math.max(c,n)});var f={width:c,height:5+t.length*(d+5)};return(0,o.draw)(e,function(e){e.strokeStyle=l,u&&u.centering&&!0===u.centering.x&&(n-=f.width/2),u&&u.centering&&!0===u.centering.y&&(i-=f.height/2),f.left=n,f.top=i;var a=u&&!0===u.debug?"#FF0000":s;(0,o.fillBox)(e,f,a),(0,o.fillTextLines)(e,f,t,l,5)}),f};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(22)),o=n(3);function r(e,t,n){var o=a.default.getFont(),r=e.font;o&&o!==r&&(e.font=o);var i=e.measureText(t).width;return o&&o!==r&&(e.font=r),i+2*n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=1,o=2;var r={setToolWidth:function(e){a=e},getToolWidth:function(){return a},setActiveWidth:function(e){o=e},getActiveWidth:function(){return o}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=a.default.MEASUREMENT_COMPLETED,i={toolType:n,element:e,measurementData:t};(0,o.default)(e,r,i)};var a=r(n(1)),o=r(n(6));function r(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.image,o={left:0,top:0,width:n.width,height:n.height},r=!1;return Object.keys(t).forEach(function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===a.default.cornerstoneMath.point.insideRect(n,o)&&(r=!0)}),r};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,o=void 0,r=void 0;var i={setStartLoadHandler:function(e){a=e},getStartLoadHandler:function(){return a},setEndLoadHandler:function(e){o=e},getEndLoadHandler:function(){return o},setErrorLoadingHandler:function(e){r=e},getErrorLoadingHandler:function(){return r}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,l,u,d,s,c,f){var v=a.default.cornerstone,g=v.pixelToCanvas(t,n);c&&(g.x+=c);var m={centering:{x:!1,y:f}};if(n.boundingBox=(0,o.default)(e,i,g.x,g.y,d,m),n.hasMoved){var h=u(l).map(function(e){return v.pixelToCanvas(t,e)});(0,r.default)(h,g,n.boundingBox,e,d,s)}};var a=i(n(0)),o=i(n(12)),r=i(n(112));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!t)throw new Error("simpleMouseButtonTool: toolType is required");var n={};return{activate:function(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.mouseButtonMask=r,(0,o.setToolOptions)(t,n,i),n.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,e),n.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,e)},disable:function(t){t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,e)},enable:function(t){t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,e)},deactivate:function(t){t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,e)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=a.default.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=void 0,o=void 0;return t?(n=t.rowPixelSpacing||t.rowImagePixelSpacing,o=t.columnPixelSpacing||t.colImagePixelSpacing):(n=e.rowPixelSpacing,o=e.columnPixelSpacing),{rowPixelSpacing:n,colPixelSpacing:o}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=[a.default.TOUCH_DRAG];return n&&!0===n.fireOnTouchStart&&r.push(a.default.TOUCH_START),{activate:function(i){n&&n.eventData&&(0,o.setToolOptions)(t,i,n.eventData),r.forEach(function(t){i.removeEventListener(t,e),i.addEventListener(t,e)}),n&&n.activateCallback&&n.activateCallback(i),n&&n.touchStartCallback&&i.addEventListener(a.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&i.addEventListener(a.default.TOUCH_END,n.touchEndCallback)},disable:function(t){r.forEach(function(n){t.removeEventListener(n,e)}),n&&n.disableCallback&&n.disableCallback(t),n&&n.touchStartCallback&&t.removeEventListener(a.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&t.removeEventListener(a.default.TOUCH_END,n.touchEndCallback)},enable:function(t){r.forEach(function(n){t.removeEventListener(n,e)}),n&&n.enableCallback&&n.enableCallback(t),n&&n.touchStartCallback&&t.removeEventListener(a.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&t.removeEventListener(a.default.TOUCH_END,n.touchEndCallback)},deactivate:function(t){r.forEach(function(n){t.removeEventListener(n,e)}),n&&n.deactivateCallback&&n.deactivateCallback(t),n&&n.touchStartCallback&&t.removeEventListener(a.default.TOUCH_START,n.touchStartCallback),n&&n.touchEndCallback&&t.removeEventListener(a.default.TOUCH_END,n.touchEndCallback)}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=a.default.cornerstone,r=n.metaData.get("patientStudyModule",e.imageId),i=n.metaData.get("generalSeriesModule",e.imageId);if(r&&i&&"PT"===i.modality){var l=t*e.slope+e.intercept,u=r.patientWeight;if(u){var d=n.metaData.get("petIsotopeModule",e.imageId);if(d){var s=d.radiopharmaceuticalInfo,c=s.radiopharmaceuticalStartTime,f=s.radionuclideTotalDose,v=s.radionuclideHalfLife,g=i.seriesTime;if(c&&f&&v&&g){var m=o(g.fractionalSeconds||0)+g.seconds+60*g.minutes+60*g.hours*60-(o(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60);return l*u/(f*Math.exp(-m*Math.log(2)/v))*1e3}}}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0));function o(e){return parseFloat("."+e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=20,o=a+"px Arial",r="transparent";var i={setFont:function(e){o=e},getFont:function(){return o},setFontSize:function(e){a=e},getFontSize:function(){return a},setBackgroundColor:function(e){r=e},getBackgroundColor:function(){return r}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=a.default.cornerstoneMath;if(e instanceof t.Vector3)return e;return new t.Vector3(e[0],e[1],e[2])};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){var i=void 0;if(t)return Object.keys(t).forEach(function(l){var u=t[l];if(u.hasOwnProperty("pointNearHandle")){if(u.pointNearHandle(e,u,n))return void(i=u)}else if(!0===u.hasBoundingBox){if((0,o.default)(u,n))return void(i=u)}else{var d=a.default.cornerstone.pixelToCanvas(e,u);if(a.default.cornerstoneMath.point.distance(d,n)<=r)return void(i=u)}}),i};var a=r(n(0)),o=r(n(25));function r(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return a.default.cornerstoneMath.point.insideRect(t,e.boundingBox)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.freehand=void 0;var a=I(n(1)),o=I(n(0)),r=I(n(13)),i=I(n(7)),l=I(n(9)),u=I(n(29)),d=I(n(25)),s=I(n(21)),c=I(n(6)),f=I(n(14)),v=I(n(5)),g=I(n(17)),m=n(2),h=n(4),p=n(8),E=I(n(19)),T=n(57),y=I(n(104)),M=I(n(103)),x=I(n(102)),_=I(n(100)),S=I(n(99)),O=I(n(56)),b=n(40),C=n(3),P=I(n(97));function I(e){return e&&e.__esModule?e:{default:e}}function L(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var w="freehand",D={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},keyDown:{shift:!1,ctrl:!0,alt:!1},activePencilMode:!0,spacing:5,activeHandleRadius:3,completeHandleRadius:6,alwaysShowHandles:!1,invalidColor:"crimson",modifying:!1,movingTextBox:!1,currentHandle:0,currentTool:-1};function U(e,t,n){var a=t.handles.map(function(t){return o.default.cornerstone.pixelToCanvas(e,t)});return(0,P.default)(a,n)}function A(e,t,n){var a=X.getConfiguration();if(void 0===t.handles)return null;if(!1===t.visible)return null;for(var r=0;r<t.handles.length;r++){var i=o.default.cornerstone.pixelToCanvas(e,t.handles[r]);if(o.default.cornerstoneMath.point.distance(i,n)<a.spacing)return r}return t.textBox&&(0,d.default)(t.textBox,n)?t.textBox:null}function R(e){var t=e.detail,n=t.element,o=X.getConfiguration(),r=(0,h.getToolOptions)(w,n);(0,v.default)(t.which,r.mouseButtonMask)&&(t.event.shiftKey&&(o.activePencilMode=!1),function(e){e.element.addEventListener(a.default.MOUSE_MOVE,j);var t={visible:!0,active:!0,invalidated:!0,color:null,handles:[],textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},n=X.getConfiguration();n.mouseLocation.handles.start.x=e.currentPoints.image.x,n.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,m.addToolState)(e.element,w,t);var o=(0,m.getToolState)(e.element,w);n.currentTool=o.data.length-1}(t),k(t),e.preventDefault(),e.stopPropagation())}function k(e){var t=(0,m.getToolState)(e.element,w);if(void 0!==t){var n=X.getConfiguration(),r=t.data[n.currentTool];if(!r.handles.invalidHandlePlacement){var i=new b.FreehandHandleData(e.currentPoints.image);r.handles.length&&r.handles[n.currentHandle-1].lines.push(e.currentPoints.image),r.handles.push(i),n.currentHandle+=1,o.default.cornerstone.updateImage(e.element),function(e,t){var n=a.default.MEASUREMENT_MODIFIED,o={toolType:w,element:e,measurementData:t};(0,c.default)(e,n,o)}(e.element,r)}}}function N(e,t){var n=(0,m.getToolState)(e.element,w);if(n){var a=X.getConfiguration(),r=n.data[a.currentTool],i=!1;if(r){if(r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,void 0!==t&&(r.handles.length>2?r.handles[a.currentHandle-1].lines.push(r.handles[0]):i=!0),a.modifying&&(a.modifying=!1,r.invalidated=!0),a.currentHandle=0,a.currentTool=-1,a.activePencilMode=!0,r.canComplete=!1,i)(0,m.removeToolState)(e.element,w,r);else{var l=o.default.cornerstone.metaData.get("generalSeriesModule",e.image.imageId),u=void 0;l&&(u=l.modality);var d=(0,E.default)(e.image),s=d.rowPixelSpacing,c=d.colPixelSpacing;z(r,e.element,e.image,u,s,c),(0,f.default)(e.element,r,w)}o.default.cornerstone.updateImage(e.element)}}}function H(e){var t=e.detail,n=t.element,o=(0,h.getToolOptions)(w,n);if((0,v.default)(t.which,o.mouseButtonMask)){var r=X.getConfiguration().currentTool;if(r<0)!function(e){var t=e.detail,n=function(e){var t=e.element,n=e.currentPoints.canvas,a=(0,m.getToolState)(t,w);if(a)for(var o=void 0,r=0;r<a.data.length;r++)if(null!==(o=A(t,a.data[r],n)))return{handleNearby:o,toolIndex:r}}(t);t.event.ctrlKey?(0,x.default)(e,n):void 0!==n&&function(e,t){var n=e.detail,o=n.element,r=(0,m.getToolState)(n.element,w),i=t.handleNearby;i.hasBoundingBox?function(e,t){var n=X.getConfiguration(),o=t.handleNearby,r=t.toolIndex;e.addEventListener(a.default.MOUSE_UP,B),e.addEventListener(a.default.MOUSE_DRAG,V),n.movingTextBox=!0,n.currentHandle=o,n.currentTool=r}(o,t):void 0!==i&&function(e,t,n){var o=X.getConfiguration(),r=t.handleNearby,i=t.toolIndex;e.removeEventListener(a.default.MOUSE_MOVE,j),o.dragOrigin={x:n.data[i].handles[r].x,y:n.data[i].handles[r].y},e.addEventListener(a.default.MOUSE_UP,B),e.addEventListener(a.default.MOUSE_CLICK,B),e.addEventListener(a.default.MOUSE_DRAG,V),o.modifying=!0,o.currentHandle=r,o.currentTool=i}(o,t,r);e.preventDefault(),e.stopPropagation()}(e,n)}(e);else{var i=(0,m.getToolState)(t.element,w);r>=0&&i.data[r].active&&function(e,t,n){var a=e.detail,o=X.getConfiguration(),r=a.element,i=t.data[n],l=A(r,i,a.currentPoints.canvas);!O.default.end(i.handles)&&i.canComplete?N(a,o.currentHandle):null===l&&k(a),e.preventDefault(),e.stopPropagation()}(e,i,r)}}}function j(e){var t=e.detail,n=(0,m.getToolState)(t.element,w);if(console.log(e),n){if(X.getConfiguration().currentTool<0){if(!function(e,t){for(var n=!1,a=0;a<t.data.length;a++){var o=e.element,r=t.data[a],i=e.currentPoints.canvas;!0===(0,u.default)(o,r.handles,i)&&(n=!0),(U(o,r,i)&&!r.active||!U(o,r,i)&&r.active)&&(r.active=!r.active,n=!0),!0===r.textBox&&(0,d.default)(r.textBox,i)&&(r.active=!r.active,r.highlight=!r.highlight,n=!0)}return n}(t,n))return}else!function(e,t){var n=X.getConfiguration(),a=n.currentTool,r=e.element,i=t.data[a],l=e.currentPoints.canvas;if(W(e),function(e){var t=X.getConfiguration();if(e.handles.length<2)return!0;var n=void 0;n=t.activePencilMode?function(e){var t=X.getConfiguration().mouseLocation.handles.start,n=e.handles,a=O.default.newHandle(t,n);return!1===a&&(a=function(e,t){var n=X.getConfiguration(),a=e.handles;if(o.default.cornerstoneMath.point.distance(a[0],t)<n.spacing)return e.canComplete=!0,!1;e.canComplete=!1;for(var r=1;r<a.length-1;r++)if(o.default.cornerstoneMath.point.distance(a[r],t)<n.spacing)return!0;return!1}(e,t)),a}(e):function(e){var t=X.getConfiguration(),n=t.mouseLocation.handles.start,a=e.handles,r=!1;return e.canComplete=!1,o.default.cornerstoneMath.point.distance(a[0],n)<t.spacing&&!O.default.end(a)?(e.canComplete=!0,r=!1):r=O.default.newHandle(n,a),r}(e),e.handles.invalidHandlePlacement=n}(i),n.activePencilMode)!function(e,t){for(var n=X.getConfiguration(),a=n.mouseLocation.handles.start,r=0;r<t.length;r++)if(o.default.cornerstoneMath.point.distance(t[r],a)<n.spacing)return;k(e)}(e,i.handles);else{var u=A(r,i,l);null!==u&&!u.hasBoundingBox&&u<i.handles.length-1&&(n.mouseLocation.handles.start.x=i.handles[u].x,n.mouseLocation.handles.start.y=i.handles[u].y)}}(t,n);o.default.cornerstone.updateImage(t.element)}}function V(e){var t=e.detail,n=(0,m.getToolState)(t.element,w);if(n){var a=X.getConfiguration(),r=n.data[a.currentTool],i=a.currentHandle;W(t),a.currentTool>=0&&(0,y.default)(i,r),o.default.cornerstone.updateImage(t.element)}}function B(e){var t=e.detail,n=t.element,r=(0,m.getToolState)(t.element,w);(n.removeEventListener(a.default.MOUSE_UP,B),n.removeEventListener(a.default.MOUSE_DRAG,V),n.removeEventListener(a.default.MOUSE_CLICK,B),n.addEventListener(a.default.MOUSE_MOVE,j),void 0!==r)&&("handle"===(0,M.default)(e,r)&&N(t),e.preventDefault(),e.stopPropagation(),o.default.cornerstone.updateImage(t.element))}function W(e){var t=X.getConfiguration();t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,p.clipToBox)(t.mouseLocation.handles.start,e.image)}function G(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function F(e){var t=e.detail,n=(0,m.getToolState)(e.currentTarget,w);if(void 0!==n){var a=o.default.cornerstone,u=t.image,d=t.element,s=X.getConfiguration(),c=a.metaData.get("generalSeriesModule",u.imageId),f=void 0,v=(0,E.default)(u),h=v.rowPixelSpacing,p=v.colPixelSpacing;c&&(f=c.modality);for(var T=(0,C.getNewContext)(t.canvasContext.canvas),y=r.default.getToolWidth(),M=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,C.draw)(T,function(e){var n=i.default.getColorIfActive(a),o=void 0;if(a.active?a.handles.invalidHandlePlacement?(n=s.invalidColor,o=s.invalidColor):(n=i.default.getColorIfActive(a),o=i.default.getFillColor()):o=i.default.getToolColor(),a.handles.length)for(var r=0;r<a.handles.length;r++){var c=[].concat(L(a.handles[r].lines));r!==a.handles.length-1||a.polyBoundingBox||c.push(s.mouseLocation.handles.start),(0,C.drawJoinedLines)(e,t.element,a.handles[r],c,{color:n})}var v={fill:o};if((s.alwaysShowHandles||s.keyDown.ctrl||a.active&&a.polyBoundingBox)&&(v.handleRadius=s.activeHandleRadius,(0,l.default)(e,t,a.handles,n,v)),a.canComplete&&(v.handleRadius=s.completeHandleRadius,(0,l.default)(e,t,[a.handles[0]],n,v)),a.active&&!a.polyBoundingBox&&(v.handleRadius=s.activeHandleRadius,(0,l.default)(e,t,s.mouseLocation.handles,n,v),(0,l.default)(e,t,[a.handles[0]],n,v)),z(a,d,u,f,h,p),a.polyBoundingBox&&!a.textBox.freehand){a.textBox.hasMoved||(a.textBox.x=a.polyBoundingBox.left+a.polyBoundingBox.width,a.textBox.y=a.polyBoundingBox.top+a.polyBoundingBox.height/2);var m=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=e.extra,r=[];if(t&&void 0!==t.mean){var i="";"CT"===f&&(i=" HU");var l="Mean: "+G(t.mean.toFixed(2))+i,u="StdDev: "+G(t.stdDev.toFixed(2))+i;if(n&&void 0!==n.mean){l+=" SUV: "+G(n.mean.toFixed(2)),u+=" SUV: "+G(n.stdDev.toFixed(2))}r.push(l),r.push(u)}if(a){var d=" mm"+String.fromCharCode(178);h&&p||(d=" pixels"+String.fromCharCode(178));var s="Area: "+G(a.toFixed(2))+d;r.push(s)}return o?[o]:[]}(a);(0,g.default)(e,d,a.textBox,m,a.handles,_,n,y,0,!0)}})},x=0;x<n.data.length;x++)M(x)}function _(e){return e}}function z(e,t,n,a,r,i){var l=o.default.cornerstone,u=void 0,d=void 0,c=void 0;if(!1===e.invalidated)d=e.meanStdDev,c=e.meanStdDevSUV,u=e.area;else if(!e.active){for(var f={left:e.handles[0].x,right:e.handles[0].x,bottom:e.handles[0].y,top:e.handles[0].x},v=0;v<e.handles.length;v++)f.left=Math.min(f.left,e.handles[v].x),f.right=Math.max(f.right,e.handles[v].x),f.bottom=Math.min(f.bottom,e.handles[v].y),f.top=Math.max(f.top,e.handles[v].y);var g={left:f.left,top:f.bottom,width:Math.abs(f.right-f.left),height:Math.abs(f.top-f.bottom)};if(e.polyBoundingBox=g,!n.color){var m=l.getPixels(t,g.left,g.top,g.width,g.height);d=(0,S.default)(m,g,e.handles),"PT"===a&&(c={mean:(0,s.default)(n,(d.mean-n.intercept)/n.slope),stdDev:(0,s.default)(n,(d.stdDev-n.intercept)/n.slope)}),d&&!isNaN(d.mean)&&(e.meanStdDev=d,e.meanStdDevSUV=c)}var h=(i||1)*(r||1);u=(0,_.default)(e.handles,h),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),r&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}function K(e){var t=e.detail,n=(0,m.getToolState)(e.currentTarget,w);void 0!==n&&(!function(e,t){e.element;var n=X.getConfiguration(),a=t.data[n.currentTool];if(!O.default.end(a.handles)&&a.handles.length>=2){var o=n.currentHandle;a.polyBoundingBox={},N(e,o)}}(t,n),e.preventDefault(),e.stopPropagation())}function q(e){e.removeEventListener(a.default.MOUSE_DOWN,H),e.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,R),e.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,K),e.removeEventListener(a.default.MOUSE_DRAG,V),e.removeEventListener(a.default.MOUSE_UP,B),e.removeEventListener(a.default.MOUSE_MOVE,j),e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,F),e.removeEventListener(a.default.KEY_DOWN,T.keyDownCallback),e.removeEventListener(a.default.KEY_UP,T.keyUpCallback)}function Y(e){var t=X.getConfiguration();if(t.currentTool>=0){var n=t.currentHandle;N({element:e,image:o.default.cornerstone.getEnabledElement(e).image},n)}}var X={enable:function(e){Y(e),q(e),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,F),o.default.cornerstone.updateImage(e)},disable:function(e){Y(e),q(e),o.default.cornerstone.updateImage(e)},activate:function(e,t){(0,h.setToolOptions)(w,e,{mouseButtonMask:t}),q(e),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,F),e.addEventListener(a.default.MOUSE_MOVE,j),e.addEventListener(a.default.MOUSE_DOWN,H),e.addEventListener(a.default.MOUSE_DOUBLE_CLICK,K),e.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,R),e.addEventListener(a.default.KEY_DOWN,T.keyDownCallback),e.addEventListener(a.default.KEY_UP,T.keyUpCallback),o.default.cornerstone.updateImage(e)},deactivate:function(e,t){(0,h.setToolOptions)(w,e,{mouseButtonMask:t});var n=a.default.TOOL_DEACTIVATED,r={mouseButtonMask:t,toolType:w,type:n};(0,c.default)(e,n,r),Y(e),q(e),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,F),e.addEventListener(a.default.MOUSE_MOVE,j),e.addEventListener(a.default.MOUSE_DOWN,H),e.addEventListener(a.default.MOUSE_DOUBLE_CLICK,K),e.addEventListener(a.default.KEY_DOWN,T.keyDownCallback),e.addEventListener(a.default.KEY_UP,T.keyUpCallback),o.default.cornerstone.updateImage(e)},getConfiguration:function(){return D},setConfiguration:function(e){D=e},pointNearTool:U};t.freehand=X},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{disable:function(t){t.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,e)},enable:function(t){t.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,e),t.addEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,e),a.default.cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u,d){var s=o.default.cornerstone,c=e.element;function f(e){var o=e.detail;l.active=!0,l.x=o.currentPoints.image.x,l.y=o.currentPoints.image.y,d&&(0,i.clipToBox)(l,o.image),s.updateImage(c);var u=a.default.MEASUREMENT_MODIFIED,f={toolType:t,element:c,measurementData:n};(0,r.default)(c,u,f)}function v(e){c.removeEventListener(a.default.MOUSE_MOVE,v),c.removeEventListener(a.default.MOUSE_DRAG,v),c.addEventListener(a.default.MOUSE_MOVE,f),c.addEventListener(a.default.MOUSE_DRAG,f),c.addEventListener(a.default.MOUSE_CLICK,h),e.type===a.default.MOUSE_DRAG&&c.addEventListener(a.default.MOUSE_UP,h)}function g(e){e.detail.measurementData===n&&h()}function m(e){e.detail.toolType===t&&(c.removeEventListener(a.default.MOUSE_MOVE,f),c.removeEventListener(a.default.MOUSE_DRAG,f),c.removeEventListener(a.default.MOUSE_CLICK,h),c.removeEventListener(a.default.MOUSE_UP,h),c.removeEventListener(a.default.MEASUREMENT_REMOVED,g),c.removeEventListener(a.default.TOOL_DEACTIVATED,m),l.active=!1,s.updateImage(c))}function h(){c.removeEventListener(a.default.MOUSE_MOVE,f),c.removeEventListener(a.default.MOUSE_DRAG,f),c.removeEventListener(a.default.MOUSE_CLICK,h),c.removeEventListener(a.default.MOUSE_UP,h),c.removeEventListener(a.default.MEASUREMENT_REMOVED,g),c.removeEventListener(a.default.TOOL_DEACTIVATED,m),l.active=!1,s.updateImage(c),"function"==typeof u&&u()}c.addEventListener(a.default.MOUSE_DRAG,v),c.addEventListener(a.default.MOUSE_MOVE,v),c.addEventListener(a.default.MEASUREMENT_REMOVED,g),c.addEventListener(a.default.TOOL_DEACTIVATED,m)};var a=l(n(1)),o=l(n(0)),r=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){o||(o=6);var r=function(e){var t=void 0;return Object.keys(e).forEach(function(n){var a=e[n];!0!==a.active||(t=a)}),t}(t),i=(0,a.default)(e,t,n,o);return r!==i&&(void 0!==i&&(i.active=!0),void 0!==r&&(r.active=!1),!0)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(24))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0));function o(){var e={};return{get:function(t,n){var o=a.default.cornerstone.getEnabledElement(t);if(o.image&&!1!==e.hasOwnProperty(o.image.imageId)){var r=e[o.image.imageId];if(!1!==r.hasOwnProperty(n))return r[n]}},add:function(t,n,o){var r=a.default.cornerstone.getEnabledElement(t);r.image&&!1!==e.hasOwnProperty(r.image.imageId)||(e[r.image.imageId]={});var i=e[r.image.imageId];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(o)},clear:function(t){var n=a.default.cornerstone.getEnabledElement(t);n.image&&!1!==e.hasOwnProperty(n.image.imageId)&&delete e[n.image.imageId]},saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var r=o();t.newImageIdSpecificToolStateManager=o,t.globalImageIdSpecificToolStateManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){var r=a.default.cornerstone,i={start:r.pixelToCanvas(e,t),end:r.pixelToCanvas(e,n)};return a.default.cornerstoneMath.lineSegment.distanceToPoint(i,o)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u,d){var s=o.default.cornerstone,c=e.element,f=s.pageToPixel(c,e.currentPoints.page.x,e.currentPoints.page.y+50),v={x:l.x-f.x,y:l.y-f.y};function g(e){var o=e.detail;l.x=o.currentPoints.image.x+v.x,l.y=o.currentPoints.image.y+v.y,d&&(0,i.clipToBox)(l,o.image),s.updateImage(c);var u=a.default.MEASUREMENT_MODIFIED,f={toolType:t,element:c,measurementData:n};(0,r.default)(c,u,f)}function m(e){var t=e.detail;if(c.removeEventListener(a.default.TOUCH_DRAG,g),c.removeEventListener(a.default.TOUCH_PINCH,m),c.removeEventListener(a.default.TOUCH_END,m),c.removeEventListener(a.default.TAP,m),c.removeEventListener(a.default.TOUCH_START,h),c.removeEventListener(a.default.TOOL_DEACTIVATED,p),e.type===a.default.TOUCH_PINCH||e.type===a.default.TOUCH_PRESS)return l.active=!1,s.updateImage(c),void u();l.active=!1,n.active=!1,l.x=t.currentPoints.image.x+v.x,l.y=t.currentPoints.image.y+v.y,d&&(0,i.clipToBox)(l,t.image),s.updateImage(c),"function"==typeof u&&u()}function h(e){return e.stopImmediatePropagation(),!1}function p(){c.removeEventListener(a.default.TOUCH_DRAG,g),c.removeEventListener(a.default.TOUCH_PINCH,m),c.removeEventListener(a.default.TOUCH_END,m),c.removeEventListener(a.default.TAP,m),c.removeEventListener(a.default.TOUCH_START,h),c.removeEventListener(a.default.TOOL_DEACTIVATED,p),l.active=!1,n.active=!1,l.x=e.currentPoints.image.x+v.x,l.y=e.currentPoints.image.y+v.y,d&&(0,i.clipToBox)(l,e.image),s.updateImage(c)}l.active=!0,n.active=!0,c.addEventListener(a.default.TOUCH_DRAG,g),c.addEventListener(a.default.TOUCH_PINCH,m),c.addEventListener(a.default.TOUCH_END,m),c.addEventListener(a.default.TAP,m),c.addEventListener(a.default.TOUCH_START,h),c.addEventListener(a.default.TOOL_DEACTIVATED,p)};var a=l(n(1)),o=l(n(0)),r=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){t.removeEventListener(a.default.MOUSE_WHEEL,e),t.addEventListener(a.default.MOUSE_WHEEL,e)},disable:function(t){t.removeEventListener(a.default.MOUSE_WHEEL,e)},enable:function(t){t.removeEventListener(a.default.MOUSE_WHEEL,e)},deactivate:function(t){t.removeEventListener(a.default.MOUSE_WHEEL,e)}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,d,s,c){var f=o.default.cornerstone,v=e.detail.element;function g(e){var n=e.detail;t.active=!0,Object.keys(t.handles).forEach(function(e){var a=t.handles[e];!0!==a.movesIndependently&&(a.x+=n.deltaPoints.image.x,a.y+=n.deltaPoints.image.y,s.preventHandleOutsideImage&&(0,u.clipToBox)(a,n.image))}),f.updateImage(v);var o=a.default.MEASUREMENT_MODIFIED,r={toolType:d,element:v,measurementData:t};(0,l.default)(v,o,r),e.preventDefault(),e.stopPropagation()}function m(e){var n=e.detail;t.invalidated=!0,v.removeEventListener(a.default.MOUSE_DRAG,g),v.removeEventListener(a.default.MOUSE_UP,m),v.removeEventListener(a.default.MOUSE_CLICK,m),!0===s.deleteIfHandleOutsideImage&&(0,r.default)(n,t.handles)&&(0,i.removeToolState)(v,d,t),f.updateImage(v),"function"==typeof c&&c()}return v.addEventListener(a.default.MOUSE_DRAG,g),v.addEventListener(a.default.MOUSE_UP,m),v.addEventListener(a.default.MOUSE_CLICK,m),!0};var a=d(n(1)),o=d(n(0)),r=d(n(15)),i=n(2),l=d(n(6)),u=n(8);function d(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u,d){var s=o.default.cornerstone,c=e.element,f={x:l.x-e.currentPoints.image.x,y:l.y-e.currentPoints.image.y};function v(e){var o=e.detail;!1===l.hasMoved&&(l.hasMoved=!0),l.active=!0,l.x=o.currentPoints.image.x+f.x,l.y=o.currentPoints.image.y+f.y,d&&(0,i.clipToBox)(l,o.image),s.updateImage(c);var u=a.default.MEASUREMENT_MODIFIED,v={toolType:t,element:c,measurementData:n};(0,r.default)(c,u,v)}function g(){l.active=!1,c.removeEventListener(a.default.MOUSE_DRAG,v),c.removeEventListener(a.default.MOUSE_UP,g),c.removeEventListener(a.default.MOUSE_CLICK,g),s.updateImage(c),"function"==typeof u&&u()}c.addEventListener(a.default.MOUSE_DRAG,v),c.addEventListener(a.default.MOUSE_UP,g),c.addEventListener(a.default.MOUSE_CLICK,g)};var a=l(n(1)),o=l(n(0)),r=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0;var o={setCoords:function(e){a=e.currentPoints.canvas},getCoords:function(){return a}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0,o={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function r(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=void 0;return/trident/i.test(t[1])?"IE "+((n=/\brv[ :]+(\d+)/g.exec(e)||[])[1]||""):"Chrome"===t[1]&&null!==(n=e.match(/\b(OPR|Edge)\/(\d+)/))?n.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(n=e.match(/version\/(\d+)/i))&&t.splice(1,1,n[1]),t.join(" "))}function i(){var e=r().split(" "),t=e[0],n=e[1],a=o[t];return a?a[n]?a[n]:a.default:o.default}t.getDefaultSimultaneousRequests=i,t.getMaxSimultaneousRequests=function(){return a||i()},t.setMaxSimultaneousRequests=function(e){a=e},t.getBrowserInfo=r,t.isMobileDevice=function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=function(e,t){var n=(0,o.default)(t.rowCosines),a=(0,o.default)(t.columnCosines),r=(0,o.default)(t.imagePositionPatient),i=e.clone().sub(r),l=n.dot(i)/t.columnPixelSpacing,u=a.dot(i)/t.rowPixelSpacing;return{x:l,y:u}},t.imagePointToPatientPoint=i,t.planePlaneIntersection=function(e,t){var n=(0,o.default)(e.rowCosines),r=(0,o.default)(e.columnCosines),l=(0,o.default)(e.imagePositionPatient),u=(0,o.default)(t.rowCosines),d=(0,o.default)(t.columnCosines),s=(0,o.default)(t.imagePositionPatient),c=n.clone().cross(r),f=new a.default.cornerstoneMath.Plane;f.setFromNormalAndCoplanarPoint(c,l);var v=u.clone().cross(d),g=new a.default.cornerstoneMath.Plane;g.setFromNormalAndCoplanarPoint(v,s);var m=g.clone().intersectPlane(f),h=m.origin,p=m.direction,E=i({x:t.columns,y:t.rows},t),T=s.distanceTo(E),y=new a.default.cornerstoneMath.Line3;y.start=h,y.end=h.clone().add(p.multiplyScalar(T));var M=function(e){var t=i({x:0,y:0},e),n=i({x:e.columns,y:0},e),o=i({x:0,y:e.rows},e),r=i({x:e.columns,y:e.rows},e);return{top:new a.default.cornerstoneMath.Line3(t,n),left:new a.default.cornerstoneMath.Line3(t,o),right:new a.default.cornerstoneMath.Line3(n,r),bottom:new a.default.cornerstoneMath.Line3(o,r)}}(t),x=function(e,t){var n=[];return Object.keys(t).forEach(function(a){var o=t[a],r=e.intersectLine(o);r&&n.push(r)}),n}(y,M);if(2!==x.length)return;return{start:x[0],end:x[1]}};var a=r(n(0)),o=r(n(23));function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=(0,o.default)(t.rowCosines),a=(0,o.default)(t.columnCosines),r=(0,o.default)(t.imagePositionPatient),i=n.clone().multiplyScalar(e.x);i.multiplyScalar(t.columnPixelSpacing||1);var l=a.clone().multiplyScalar(e.y);l.multiplyScalar(t.rowPixelSpacing||1);var u=i.add(l);return u.add(r),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawBrushOnCanvas=t.drawBrushPixels=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=n(3);t.drawBrushPixels=function(e,t,n,a){e.forEach(function(e){var o=function(e,t){return t*a+e}(e[0],e[1]);t[o]=n})},t.drawBrushOnCanvas=function(e,t,n,r){var i=a.default.cornerstone.pixelToCanvas(r,{x:0,y:0}),l=a.default.cornerstone.pixelToCanvas(r,{x:1,y:1}),u=l.x-i.x,d=l.y-i.y;(0,o.draw)(t,function(t){e.forEach(function(e){var i=a.default.cornerstone.pixelToCanvas(r,{x:e[0],y:e[1]}),l={left:i.x,top:i.y,width:u,height:d};(0,o.fillBox)(t,l,n)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FreehandHandleData=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=a,this.lines=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n={},o=[a.default.MULTI_TOUCH_DRAG];return t&&!0===t.fireOnTouchStart&&o.push(a.default.MULTI_TOUCH_START),{activate:function(n){o.forEach(function(t){n.removeEventListener(t,e),n.addEventListener(t,e)}),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){o.forEach(function(t){n.removeEventListener(t,e)}),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){o.forEach(function(t){n.removeEventListener(t,e)}),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){o.forEach(function(t){n.removeEventListener(t,e)}),t&&t.deactivateCallback&&t.deactivateCallback(n)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var l=(0,o.getToolState)(e,"timeSeries");if(l&&l.data&&l.data.length){var u=a.default.cornerstone,d=l.data[0],s=d.stacks[d.currentStackIndex].currentImageIdIndex,c=d.currentStackIndex+t;if(n?(c>=d.stacks.length&&(c=0),c<0&&(c=d.stacks.length-1)):c=(0,i.default)(c,0,d.stacks.length-1),c!==d.currentStackIndex){var f=u.getViewport(e),v=d.stacks[c],g=r.default.getStartLoadHandler(),m=r.default.getEndLoadHandler(),h=r.default.getErrorLoadingHandler();g&&g(e);(!0===v.preventCache?u.loadImage(v.imageIds[s]):u.loadAndCacheImage(v.imageIds[s])).then(function(t){d.currentImageIdIndex!==s&&(v.currentImageIdIndex=s,d.currentStackIndex=c,u.displayImage(e,t,f),m&&m(e,t))},function(t){var n=v.imageIds[s];h&&h(e,n,t)})}}};var a=l(n(0)),o=n(2),r=l(n(16)),i=l(n(8));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=0,o=0,r=0,i=0,l=t.top;l<t.top+t.height;l++)for(var u=t.left;u<t.left+t.width;u++){var d={x:u,y:l};(0,a.default)(t,d)&&(n+=e[i],o+=e[i]*e[i],r++),i++}if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var s=n/r,c=o/r-s*s;return{count:r,mean:s,variance:c,stdDev:Math.sqrt(c)}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(46))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:a.default.cornerstoneMath.point.copy(e.page),image:a.default.cornerstoneMath.point.copy(e.image),client:a.default.cornerstoneMath.point.copy(e.client),canvas:a.default.cornerstoneMath.point.copy(e.canvas)}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i=a.default.cornerstone.getEnabledElement(e),l=[],u=0,d=i.image.getPixelData(),s=void 0,c=void 0,f=void 0;if(i.image.color)for(c=0;c<r;c++)for(f=0;f<o;f++){var v=d[s=4*((c+n)*i.image.columns+(f+t))],g=d[s+1],m=d[s+2],h=d[s+3];l[u++]=v,l[u++]=g,l[u++]=m,l[u++]=h}return l};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.width/2,a=e.height/2;if(n<=0||a<=0)return!1;var o=e.left+n,r=e.top+a,i=t.x-o,l=t.y-r;return i*i/(n*n)+l*l/(a*a)<=1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=(0,o.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var u=l.data[0];u.pending||(u.pending=[]);var d=u.currentImageIdIndex+t;if(n)d%=u.imageIds.length;else d=(0,r.default)(d,0,u.imageIds.length-1);if(i)(0,a.default)(e,d);else{var s={index:d};u.pending.push(s),function e(t,n,o){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],o));o.addEventListener(external.cornerstone.EVENTS.NEW_IMAGE,function e(r){t.imageIds.indexOf(r.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),o.removeEventListener(external.cornerstone.EVENTS.NEW_IMAGE,e),t.pending.length>0&&function e(t,n,o){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],o));o.addEventListener(external.cornerstone.EVENTS.NEW_IMAGE,function a(r){t.imageIds.indexOf(r.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),o.removeEventListener(external.cornerstone.EVENTS.NEW_IMAGE,a),t.pending.length>0&&e(t,t.pending[0],o))}),(0,a.default)(o,n.index)}}(t,t.pending[0],o))}),(0,a.default)(o,n.index)}}(u,s,e)}}};var a=i(n(67)),o=n(2),r=i(n(8));function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index){e.pending.splice(e.pending.indexOf(t),1);if(e.pending.length>0){l(e,e.pending[0],n)}return}var o=function a(o){var r;if(e.imageIds.indexOf(o.detail.image.imageId)===t.index){e.pending.splice(e.pending.indexOf(t),1);n.removeEventListener(external.cornerstone.EVENTS.NEW_IMAGE,a);if(e.pending.length>0){l(e,e.pending[0],n)}}};n.addEventListener(external.cornerstone.EVENTS.NEW_IMAGE,o);(0,a.default)(n,t.index)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=n(37);var r={interaction:[],thumbnail:[],prefetch:[]},i={interaction:0,thumbnail:0,prefetch:0},l={interaction:6,thumbnail:6,prefetch:5},u=!1,d=20;function s(){u&&setTimeout(function(){f()},d)}function c(e){var t=a.default.cornerstone,n=e.type;i[n]++,u=!0;var o=e.imageId,r=e.doneCallback,l=e.failCallback,d=t.imageCache.getImageLoadObject(o);if(d)d.promise.then(function(e){i[n]--,r(e),s()},function(e){i[n]--,l(e),s()});else{var c=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(o,{priority:c,type:e.type}):t.loadAndCacheImage(o,{priority:c,type:e.type})).then(function(e){i[n]--,r(e),s()},function(e){i[n]--,l(e),s()})}}function f(){var e=(0,o.getMaxSimultaneousRequests)();l={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(i.interaction+i.thumbnail+i.prefetch),n=0;n<t;n++){var a=v();a&&c(a)}}function v(){return r.interaction.length&&i.interaction<l.interaction?r.interaction.shift():r.thumbnail.length&&i.thumbnail<l.thumbnail?r.thumbnail.shift():r.prefetch.length&&i.prefetch<l.prefetch?r.prefetch.shift():(r.interaction.length||r.thumbnail.length||r.prefetch.length||(u=!1),!1)}t.default={addRequest:function(e,t,n,o,i,l,d){if(!r.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var s={type:n,imageId:t,preventCache:o,doneCallback:i,failCallback:l},c=a.default.cornerstone.imageCache.getImageLoadObject(t);c?c.promise.then(function(e){i(e)},function(e){l(e)}):(d?r[n].unshift(s):r[n].push(s),u=!0)}},clearRequestStack:function(e){if(!r.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");r[e]=[]},startGrabbing:f,getRequestPool:function(){return r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=Math.round(a),i=Math.round(o);if(1===e)return[[r,i]];for(var l=[],u=0,d=-e;d<=e;d++){var s=i+d;if(!(s>t||s<0))for(var c=-e;c<=e;c++){var f=r+c;f>n||f<0||c*c+d*d<e*e&&(l[u++]=[r+c,i+d])}}return l}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.toolType;function n(e){var t=e.detail,n=!1;n=function(e){var t=e.keyCode,n=!1;109===t||173===t?(m(),n=!0):61!==t&&107!==t||(g(),n=!0);return n}(t)||n,(n=function(e){var t=e.keyCode,n=!1;219===t?(p(),n=!0):221===t&&(h(),n=!0);return n}(t)||n)&&o.default.cornerstone.updateImage(t.element)}function s(e){var t=O.getConfiguration(),n=o.default.cornerstone.colors.getColormap(t.colormapId);t.draw=e;var a=n.getColor(t.draw);t.hoverColor="rgba("+a[[0]]+", "+a[[1]]+", "+a[[2]]+", 1.0 )",t.dragColor="rgba("+a[[0]]+", "+a[[1]]+", "+a[[2]]+", 0.8 )"}function g(){var e=O.getConfiguration();e.radius=(0,d.default)(e.radius+1,e.minRadius,e.maxRadius)}function m(){var e=O.getConfiguration();e.radius=(0,d.default)(e.radius-1,e.minRadius,e.maxRadius)}function h(){var e=O.getConfiguration(),t=E(),n=e.draw+1;n===t&&(n=0),s(n)}function p(){var e=O.getConfiguration(),t=E(),n=e.draw-1;n<0&&(n=t-1),s(n)}function E(){var e=O.getConfiguration(),t=o.default.cornerstone.colors.getColormap(e.colormapId);return t.getNumberOfColors()}function T(t){e.onMouseMove(t)}function y(t){var n=t.detail,o=n.element;e.onMouseUp(t),o.removeEventListener(a.default.MOUSE_DRAG,T),o.removeEventListener(a.default.MOUSE_DRAG,M),o.removeEventListener(a.default.MOUSE_UP,y),o.removeEventListener(a.default.MOUSE_CLICK,y)}function M(t){return e.onDrag(t),!1}function x(t){e.onMouseDoubleClick(t)}function _(n){var o=n.detail,r=o.element,i=(0,u.getToolOptions)(t,r);if((0,l.default)(o.which,i.mouseButtonMask))return r.addEventListener(a.default.MOUSE_DRAG,M),r.addEventListener(a.default.MOUSE_UP,y),r.addEventListener(a.default.MOUSE_CLICK,y),r.addEventListener(a.default.MOUSE_DOUBLE_CLICK,x),e.onMouseDown(n),!1;r.addEventListener(a.default.MOUSE_DRAG,T),r.addEventListener(a.default.MOUSE_UP,y)}function S(t){var n=t.detail,a=n.element,i=(0,r.getToolState)(a,c),l=void 0;i?l=i.data[0].pixelData:(l=new Uint8ClampedArray(n.image.width*n.image.height),(0,r.addToolState)(a,c,{pixelData:l}));var u=o.default.cornerstone.getLayer(n.element,f);u.image.setPixelData(l),u.invalid=!0,o.default.cornerstone.updateImage(a),e.onImageRendered(t)}var O=(0,i.default)({mouseMoveCallback:T,mouseDownActivateCallback:_,onImageRendered:S,deactivate:function(e){e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,S),e.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,_),e.removeEventListener(a.default.MOUSE_MOVE,T),e.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,x),e.removeEventListener(a.default.KEY_DOWN,n),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,S),O.getConfiguration().active=!1}});return O.keyDownCallback=n,O.activate=function(e,i){(0,u.setToolOptions)(t,e,{mouseButtonMask:i}),e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,S),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,S),e.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,_),e.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,_),e.removeEventListener(a.default.MOUSE_MOVE,T),e.addEventListener(a.default.MOUSE_MOVE,T),e.removeEventListener(a.default.KEY_DOWN,n),e.addEventListener(a.default.KEY_DOWN,n);var l=o.default.cornerstone.getEnabledElement(e),d=l.image,s=d.width,g=d.height,m=new Uint8ClampedArray(s*g),h=O.getConfiguration();h.active=!0;var p=h.colormapId;if(!p){var E=O.getConfiguration();(function(e){var t=o.default.cornerstone.colors.getColormap(e);t.setNumberOfColors(20),t.setColor(0,[255,255,255,0]),t.setColor(1,[230,25,75,102]),t.setColor(2,[60,180,175,102]),t.setColor(3,[255,225,25,102]),t.setColor(4,[0,130,200,102]),t.setColor(5,[245,130,48,102]),t.setColor(6,[145,30,180,102]),t.setColor(7,[70,240,240,102]),t.setColor(8,[240,50,230,102]),t.setColor(9,[210,245,60,102]),t.setColor(10,[250,190,190,102]),t.setColor(11,[0,128,128,102]),t.setColor(12,[230,190,255,102]),t.setColor(13,[170,110,40,102]),t.setColor(14,[255,250,200,102]),t.setColor(15,[128,0,0,102]),t.setColor(16,[170,255,195,102]),t.setColor(17,[128,128,0,102]),t.setColor(18,[255,215,180,102]),t.setColor(19,[0,0,128,102])})(p="BrushColorMap"),E.colormapId=p}var y={minPixelValue:0,maxPixelValue:1,slope:1,intercept:0,getPixelData:function(){return m},rows:l.image.height,columns:l.image.width,height:g,width:s,pixelData:m,setPixelData:function(e){m=e},colormap:p,color:!1,rgba:!1,labelmap:!0,invert:!1,columnPixelSpacing:1,rowPixelSpacing:1,sizeInBytes:l.image.width*l.image.height},M=void 0;v||(v=o.default.cornerstone.addLayer(e,o.default.cornerstone.getEnabledElement(e).image)),f&&(M=o.default.cornerstone.getLayer(e,f)),M||(f=o.default.cornerstone.addLayer(e,y,{viewport:{pixelReplication:!0}})),(0,r.addToolState)(e,c,{pixelData:m}),h.brushLayerId=f,O.setConfiguration(h),o.default.cornerstone.updateImage(e)},O.changeDrawColor=s,O.increaseRadius=g,O.decreaseRadius=m,O.nextSegmentation=h,O.previousSegmentation=p,O};var a=s(n(1)),o=s(n(0)),r=n(2),i=s(n(10)),l=s(n(5)),u=n(4),d=s(n(8));function s(e){return e&&e.__esModule?e:{default:e}}var c="brush",f=void 0,v=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){t.removeEventListener(a.default.TOUCH_PINCH,e),t.addEventListener(a.default.TOUCH_PINCH,e)},disable:function(t){t.removeEventListener(a.default.TOUCH_PINCH,e)},enable:function(t){t.removeEventListener(a.default.TOUCH_PINCH,e)},deactivate:function(t){t.removeEventListener(a.default.TOUCH_PINCH,e)}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.toolType;function g(o){var r=o.detail,i=r.element,l=(0,v.getToolOptions)(n,i);if((0,c.default)(r.which,l.mouseButtonMask))return function(o){var r=o.element,i=e.createNewMeasurement(o);i&&((0,f.addToolState)(o.element,n,i),r.removeEventListener(a.default.MOUSE_MOVE,m),(0,u.default)(o,n,i,i.handles.end,function(){i.active=!1,(0,s.default)(o,i.handles)?(0,f.removeToolState)(o.element,n,i):e.onHandleDoneMove&&e.onHandleDoneMove(r,i),r.addEventListener(a.default.MOUSE_MOVE,m)},t))}(r),!1}function m(t){var a=t.detail;r.default.setCoords(a);var i=(0,f.getToolState)(a.element,n);if(void 0!==i){for(var u=!1,d=a.currentPoints.canvas,s=0;s<i.data.length;s++){var c=i.data[s];!0===(0,l.default)(a.element,c.handles,d)&&(u=!0),(e.pointInsideRect(a.element,c,d)&&!c.active||!e.pointInsideRect(a.element,c,d)&&c.active)&&(c.active=!c.active,u=!0)}!0===u&&o.default.cornerstone.updateImage(a.element)}}function h(r){var l=r.detail,g=l.element,h=o.default.cornerstone,p=void 0,E=(0,v.getToolOptions)(n,g);if((0,c.default)(l.which,E.mouseButtonMask)){var T=l.startPoints.canvas,y=(0,f.getToolState)(r.currentTarget,n),M=void 0;if(void 0!==y)for(M=0;M<y.data.length;M++){p=y.data[M];var x=(0,i.default)(l.element,p.handles,T,25);if(void 0!==x)return g.removeEventListener(a.default.MOUSE_MOVE,m),p.active=!0,(0,u.default)(l,n,p,x,S,t),r.stopImmediatePropagation(),!1}var _={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==y&&void 0!==e.pointInsideRect)for(M=0;M<y.data.length;M++)if(p=y.data[M],e.pointInsideRect(l.element,p,T))return g.removeEventListener(a.default.MOUSE_MOVE,m),(0,d.default)(r,p,y,n,_,S),g.addEventListener(a.default.MOUSE_MOVE,m),r.stopImmediatePropagation(),!1}function S(){p.active=!1,(0,s.default)(l,p.handles)?(0,f.removeToolState)(l.element,n,p):e.onHandleDoneMove&&e.onHandleDoneMove(g,p),h.updateImage(l.element),g.addEventListener(a.default.MOUSE_MOVE,m)}}return{enable:function(t){t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,m),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,g),t.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),o.default.cornerstone.updateImage(t)},disable:function(t){t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,m),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,g),o.default.cornerstone.updateImage(t)},activate:function(t,r){(0,v.setToolOptions)(n,t,{mouseButtonMask:r}),t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,m),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,g),t.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,m),t.addEventListener(a.default.MOUSE_DOWN,h),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,g),o.default.cornerstone.updateImage(t)},deactivate:function(t,r){(0,v.setToolOptions)(n,t,{mouseButtonMask:r}),t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.removeEventListener(a.default.MOUSE_MOVE,m),t.removeEventListener(a.default.MOUSE_DOWN,h),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,g),t.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,e.onImageRendered),t.addEventListener(a.default.MOUSE_MOVE,m),t.addEventListener(a.default.MOUSE_DOWN,h),o.default.cornerstone.updateImage(t)}}};var a=g(n(1)),o=g(n(0)),r=g(n(36)),i=g(n(24)),l=g(n(29)),u=g(n(35)),d=g(n(34)),s=g(n(15)),c=g(n(5)),f=n(2),v=n(4);function g(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.freehandSculpter=void 0;var a=g(n(1)),o=g(n(0)),r=n(26),i=g(n(7)),l=g(n(9)),u=g(n(5)),d=n(2),s=n(4),c=n(8),f=n(57),v=n(55);function g(e){return e&&e.__esModule?e:{default:e}}var m=new(n(96).Sculpter),h="freehandSculpter",p="freehand",E={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},keyDown:{shift:!1,ctrl:!1,alt:!1},active:!1,minSpacing:5,maxSpacing:20,toolSizeImage:null,toolSizeCanvas:null,currentTool:null,color:i.default.getActiveColor()};function T(e){var t=e.detail,n=t.element,r=(0,s.getToolOptions)(h,n),i=P.getConfiguration(),l=!1;if(!(0,u.default)(t.which,r.mouseButtonMask))return e.stopPropagation(),void e.preventDefault();t.event.ctrlKey?(!function(e){var t=P.getConfiguration(),n=e.element,a=new v.FreehandLineFinder(e).findTool();t.currentTool=a,function(e,t){for(var n=(0,d.getToolState)(e,p),a=0;a<n.data.length;a++)n.data[a].active=a===t}(n,a)}(t),l=!0):null!==i.currentTool&&(!function(e){var t=P.getConfiguration(),n=e.element;(function(e){for(var t=P.getConfiguration(),n=t.currentTool,a=(0,d.getToolState)(e.element,p).data[n].handles,r=e.currentPoints.image,i=e.currentPoints.canvas,l=1/0,u=1/0,s=0;s<a.length;s++){var c=a[s],f=o.default.cornerstoneMath.point.distance(c,r);if(f<l){l=f;var v=o.default.cornerstone.pixelToCanvas(e.element,a[s]);u=o.default.cornerstoneMath.point.distance(v,i)}}t.toolSizeImage=l,t.toolSizeCanvas=u})(e),t.active=!0,S(e),n.addEventListener(a.default.MOUSE_UP,M),n.addEventListener(a.default.MOUSE_CLICK,M),n.addEventListener(a.default.MOUSE_DRAG,y)}(t),l=!0),l&&o.default.cornerstone.updateImage(t.element)}function y(e){var t=e.detail,n=(0,d.getToolState)(t.element,p);if(n){var a=P.getConfiguration(),r=n.data[a.currentTool].handles;S(t),m.sculpt(t,r),o.default.cornerstone.updateImage(t.element)}}function M(e){var t=e.detail,n=t.element,r=P.getConfiguration();n.removeEventListener(a.default.MOUSE_UP,M),n.removeEventListener(a.default.MOUSE_DRAG,y),n.removeEventListener(a.default.MOUSE_CLICK,M),r.active=!1,e.preventDefault(),e.stopPropagation(),function(e){var t=P.getConfiguration(),n=e.element;(0,d.getToolState)(n,p).data[t.currentTool].invalidated=!0,o.default.cornerstone.updateImage(n)}(t)}function x(e){_(e.detail.element)}function _(e){var t=P.getConfiguration(),n=(0,d.getToolState)(e,p);if(t.currentTool=null,n)for(var a=0;a<n.data.length;a++)n.data[a].active=!1;o.default.cornerstone.updateImage(e)}function S(e){var t=P.getConfiguration();t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,c.clipToBox)(t.mouseLocation.handles.start,e.image)}function O(e){var t=e.detail,n=t.canvasContext.canvas.getContext("2d"),a=P.getConfiguration();if(a.active){var o={fill:null,handleRadius:a.toolSizeCanvas};(0,l.default)(n,t,a.mouseLocation.handles,a.color,o)}}function b(e){_(e),C(e)}function C(e){e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,O),e.removeEventListener(a.default.MOUSE_DOWN,T),e.removeEventListener(a.default.MOUSE_DRAG,y),e.removeEventListener(a.default.MOUSE_UP,M),e.removeEventListener(a.default.KEY_DOWN,f.keyDownCallback),e.removeEventListener(a.default.KEY_UP,f.keyUpCallback),e.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,x)}var P={enable:function(e){b(e)},disable:b,activate:function(e,t){(0,s.setToolOptions)(h,e,{mouseButtonMask:t}),r.freehand.enable(e),C(e),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,O),e.addEventListener(a.default.MOUSE_DOWN,T),e.addEventListener(a.default.KEY_DOWN,f.keyDownCallback),e.addEventListener(a.default.KEY_UP,f.keyUpCallback),e.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,x),e.focus(),o.default.cornerstone.updateImage(e)},deactivate:function(e){b(e)},getConfiguration:function(){return E},setConfiguration:function(e){E=e}};t.freehandSculpter=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreehandLineFinder=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),i=n(101);t.FreehandLineFinder=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventData=t}return a(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=(0,o.getToolState)(this._eventData.element,"freehand"),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var a=this._nearestHandleToPoint(n);null!==a&&(a.distance<t.distance&&(t=a))}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e];if(void 0===n.handles)return null;if(!1===n.visible)return null;for(var a={toolIndex:e,handleIndex:null,distance:1/0},o=0;o<n.handles.length;o++){var i=r.default.cornerstone.pixelToCanvas(t.element,n.handles[o]),l=r.default.cornerstoneMath.point.distance(i,this._mousePoint);l<a.distance&&(a.handleIndex=o,a.distance=l)}return a}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles,a=[],o=0;o<n.length;o++){var r=e.getNextHandleIndex(o,n.length);this._distanceOfPointfromLine(n[o],n[r])<10&&a.push([o,r])}return a}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new i.ClickedLineData(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var a=this._eventData,o=this._toolData.data[t];if(void 0!==o.handles){if(!1===o.visible)return!1;var r=o.handles[n[0]],i=o.handles[n[1]],l=e.getCanvasPointsFromHandles(r,i,a.element),u=e.getLineAsVector(l),d=this._getLineOriginToMouseAsVector(l),s=(d[0]*u[0]+d[1]*u[1])/u.magnitude;return s>0&&s<u.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,a=r.default.cornerstone.pixelToCanvas(n.element,e),o=r.default.cornerstone.pixelToCanvas(n.element,t),i=this._mousePoint;return Math.abs((o.y-a.y)*i.x-(o.x-a.x)*i.y+o.x*a.y-o.y*a.x)/r.default.cornerstoneMath.point.distance(a,o)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var a=[];return e.x<t.x?(a.push(r.default.cornerstone.pixelToCanvas(n,e)),a.push(r.default.cornerstone.pixelToCanvas(n,t))):(a.push(r.default.cornerstone.pixelToCanvas(n,t)),a.push(r.default.cornerstone.pixelToCanvas(n,e))),a}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=r.default.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}()},function(e,t,n){"use strict";function a(e,t,n,a){for(var i=e.length-1,l=0;l<e.length;l++)if(-1===a.indexOf(l)&&-1===a.indexOf(i)){if(o(t,n,r(e[i]),r(e[l])))return!0;i=l}else i=l;return!1}function o(e,t,n,a){var o=!1,r=[i(e,t,n),i(e,t,a),i(n,a,e),i(n,a,t)];return r[0]!==r[1]&&r[2]!==r[3]||(0===r[0]&&l(e,n,t)?o=!0:0===r[1]&&l(e,a,t)?o=!0:0===r[2]&&l(n,e,a)?o=!0:0===r[3]&&l(n,t,a)&&(o=!0),o)}function r(e){return{x:e.x,y:e.y}}function i(e,t,n){var a=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===a?0:a>0?1:2}function l(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}Object.defineProperty(t,"__esModule",{value:!0});var u={newHandle:function(e,t){var n=t.length-1;return a(t,r(t[n]),r(e),[n])},end:function(e){var t=e.length-1;return a(e,r(e[t]),r(e[0]),[t,0])},modify:function(e,t){var n=r(e[t]),o=t-1;0===t&&(o=e.length-1);var i=r(e[o]);return!!a(e,n,i,[t,o])||a(e,n,i=r(e[o=t===e.length-1?0:t+1]),[t,o])}};t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyDownCallback=function(e){var t=e.detail,n=o.freehand.getConfiguration(),i=t.keyCode,l=!1;i===r.CTRL&&(n.keyDown.ctrl=!0,l=!0);i===r.SHIFT&&(n.keyDown.shift=!0);i===r.ALT&&(n.keyDown.alt=!0);l&&a.default.cornerstone.updateImage(t.element)},t.keyUpCallback=function(e){var t=e.detail,n=o.freehand.getConfiguration(),i=t.keyCode,l=!1;i===r.CTRL&&(n.keyDown.ctrl=!1,l=!0);i===r.SHIFT&&(n.keyDown.shift=!1);i===r.ALT&&(n.keyDown.alt=!1);l&&a.default.cornerstone.updateImage(t.element)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=n(26);var r={SHIFT:16,CTRL:17,ALT:18}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!t)throw new Error("simpleTouchTool: toolType is required");var n={};return{activate:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.setToolOptions)(t,n,r),n.removeEventListener(a.default.TOUCH_START,e),n.addEventListener(a.default.TOUCH_START,e)},disable:function(t){t.removeEventListener(a.default.TOUCH_START,e)},enable:function(t){t.removeEventListener(a.default.TOUCH_START,e)},deactivate:function(t){t.removeEventListener(a.default.TOUCH_START,e)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){t.removeEventListener(a.default.DOUBLE_TAP,e),t.addEventListener(a.default.DOUBLE_TAP,e)},disable:function(t){t.removeEventListener(a.default.DOUBLE_TAP,e)},enable:function(t){t.removeEventListener(a.default.DOUBLE_TAP,e)},deactivate:function(t){t.removeEventListener(a.default.DOUBLE_TAP,e)}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=2e3,o={mouse:0,touch:1},r=void 0,i=void 0;function l(e,t){var n=Date.now();if(e!==r){if(n-i<=a)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;r=e}i=n}var u=l.bind(null,o.mouse),d=l.bind(null,o.touch);function s(e,t,n){var a=n?u:d;t.forEach(function(t){e.addEventListener(t,a)})}function c(e,t,n){var a=n?u:d;t.forEach(function(t){e.removeEventListener(t,a)})}var f=["mousedown","mouseup"],v=["touchstart","touchend"];function g(e){c(e,f,o.mouse),c(e,v,o.touch)}var m={enable:function(e){g(e),s(e,f,o.mouse),s(e,v,o.touch)},disable:g};t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,d){l.value=!0;var s=e.detail,c=o.default.cornerstone,f=s.element,v=c.getEnabledElement(f),g=((new Date).getTime(),-57),m={x:s.currentPoints.page.x,y:s.currentPoints.page.y+g},h=c.pageToPixel(f,m.x,m.y);function p(e){var o=e.detail;l.value=!1,!1===i.hasMoved&&(i.hasMoved=!0),i.active=!0;var u=o.currentPoints,d={x:u.page.x,y:u.page.y+g};h=c.pageToPixel(f,d.x,d.y),i.x=h.x,i.y=h.y,c.updateImage(f);var s=a.default.MEASUREMENT_MODIFIED,v={toolType:t,element:f,measurementData:n};(0,r.default)(f,s,v)}function E(e){var t=e.detail;l.value=!1,i.active=!1,f.removeEventListener(a.default.TOUCH_DRAG,p),u.forEach(function(e){f.removeEventListener(e,E)}),c.updateImage(f),e.type===a.default.TOUCH_PRESS&&(t.handlePressed=n,i.x=s.currentPoints.image.x,i.y=s.currentPoints.image.y),"function"==typeof d&&d(e)}f.addEventListener(a.default.TOUCH_DRAG,p),u.forEach(function(e){f.addEventListener(e,E)}),function e(t,n,a,r,i){if(!a.value)return;var l=o.default.cornerstone;var u=(new Date).getTime();var d=Math.abs(n.y-i.y);var s=d/10;if(d<1)return n.y=i.y,void(a.value=!1);n.y>i.y?n.y-=s:n.y<i.y&&(n.y+=s);l.updateImage(r.element);l.requestAnimationFrame(function(){e(u,n,a,r,i)})}(0,i,l,v,h)};var a=i(n(1)),o=i(n(0)),r=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var l={value:!1},u=[a.default.TOUCH_END,a.default.TOUCH_DRAG_END,a.default.TOUCH_PINCH,a.default.TOUCH_PRESS,a.default.TAP]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,u,d,s){var c=e.detail.element,f=o.default.cornerstone;function v(e){var n=e.detail;t.active=!0,Object.keys(t.handles).forEach(function(e){var a=t.handles[e];!0!==a.movesIndependently&&(a.x+=n.deltaPoints.image.x,a.y+=n.deltaPoints.image.y)}),f.updateImage(c);var o=a.default.MEASUREMENT_MODIFIED,r={toolType:u,element:c,measurementData:t};(0,l.default)(c,o,r),e.preventDefault(),e.stopPropagation()}function g(e){var n=e.detail;t.active=!1,t.invalidated=!1,c.removeEventListener(a.default.TOUCH_DRAG,v),c.removeEventListener(a.default.TOUCH_PINCH,g),c.removeEventListener(a.default.TOUCH_PRESS,g),c.removeEventListener(a.default.TOUCH_END,g),c.removeEventListener(a.default.TOUCH_DRAG_END,g),c.removeEventListener(a.default.TAP,g);var o=(0,r.default)(n,t.handles);!0===d&&!0===o&&(0,i.removeToolState)(c,u,t),f.updateImage(c),"function"==typeof s&&s(e)}return c.addEventListener(a.default.TOUCH_DRAG,v),c.addEventListener(a.default.TOUCH_PINCH,g),c.addEventListener(a.default.TOUCH_PRESS,g),c.addEventListener(a.default.TOUCH_END,g),c.addEventListener(a.default.TOUCH_DRAG_END,g),c.addEventListener(a.default.TAP,g),!0};var a=u(n(1)),o=u(n(0)),r=u(n(15)),i=n(2),l=u(n(6));function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t){t.removeEventListener(a.default.KEY_DOWN,e),t.addEventListener(a.default.KEY_DOWN,e)},disable:function(t){t.removeEventListener(a.default.KEY_DOWN,e)},enable:function(t){t.removeEventListener(a.default.KEY_DOWN,e)},deactivate:function(t){t.removeEventListener(a.default.KEY_DOWN,e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r){var i=Math.atan2(n.y-t.y,n.x-t.x),l={color:o,lineWidth:r};(0,a.drawLine)(e,void 0,t,n,l,"canvas"),l={color:o,lineWidth:r,fillStyle:o};var u=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];(0,a.drawJoinedLines)(e,void 0,n,u,l,"canvas")};var a=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i=a.default.cornerstone.getEnabledElement(e).image,l=[],u=0,d=i.getPixelData(),s=void 0,c=void 0,f=void 0;if(i.color)for(c=0;c<r;c++)for(f=0;f<o;f++){var v=d[s=4*((c+n)*i.columns+(f+t))],g=d[s+1],m=d[s+2];l[u++]=.2126*v+.7152*g+.0722*m}else for(c=0;c<r;c++)for(f=0;f<o;f++)s=(c+n)*i.columns+(f+t),l[u++]=d[s]*i.slope+i.intercept;return l};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=e.xRadius,r=e.yRadius;if(o<=0||r<=0)return!1;var i=n.x-t.x,l=n.y-t.y,u=function(e){return e*e},d=i*Math.cos(a),s=l*Math.sin(a),c=i*Math.sin(a),f=l*Math.cos(a);return u(d+s)/u(o)+u(c-f)/u(r)<=1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,r.getToolState)(e,"stack");if(n&&n.data&&n.data.length){var d=o.default.cornerstone,s=void 0;if(n.data.length>1){var c=(0,r.getToolState)(e,"stackRenderer");c&&c.data&&c.data.length&&(s=c.data[0])}var f=n.data[0];t<0&&(t+=f.imageIds.length);var v=l.default.getStartLoadHandler(),g=l.default.getEndLoadHandler(),m=l.default.getErrorLoadingHandler();if(t!==f.currentImageIdIndex){v&&v(e);var h={newImageIdIndex:t,direction:t-f.currentImageIdIndex};f.currentImageIdIndex=t;var p=f.imageIds[t];(Boolean(f.preventCache)?d.loadImage(p):d.loadAndCacheImage(p)).then(function(a){if(f.currentImageIdIndex===t){try{d.getEnabledElement(e)}catch(e){return}s?(s.currentImageIdIndex=t,s.render(e,n.data)):d.displayImage(e,a),g&&g(e,a)}},function(n){var a=f.imageIds[t];m&&m(e,a,n)}),i.default.startGrabbing(),(0,u.default)(e,a.default.STACK_SCROLL,h)}}};var a=d(n(1)),o=d(n(0)),r=n(2),i=d(n(49)),l=d(n(16)),u=d(n(6));function d(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(148)),o=r(n(147));function r(e){return e&&e.__esModule?e:{default:e}}var i={getOrientationString:a.default,invertOrientationString:o.default};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,u){var d=a.default.cornerstone,s=d.getEnabledElement(n).image,c=d.getEnabledElement(u).image;if(s&&c){var f=d.metaData.get("imagePlaneModule",s.imageId),v=d.metaData.get("imagePlaneModule",c.imageId);if(f&&v&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&v.rowCosines&&v.columnCosines&&v.imagePositionPatient&&f.frameOfReferenceUID===v.frameOfReferenceUID){f.rowCosines=(0,i.default)(f.rowCosines),f.columnCosines=(0,i.default)(f.columnCosines),f.imagePositionPatient=(0,i.default)(f.imagePositionPatient),v.rowCosines=(0,i.default)(v.rowCosines),v.columnCosines=(0,i.default)(v.columnCosines),v.imagePositionPatient=(0,i.default)(v.imagePositionPatient);var g=f.rowCosines.clone().cross(f.columnCosines),m=v.rowCosines.clone().cross(v.columnCosines),h=g.angleTo(m);if(!((h=Math.abs(h))<.5)){var p=(0,o.default)(f,v);if(p){var E=r.default.getActiveColor();e.setTransform(1,0,0,1,0,0),(0,l.draw)(e,function(e){(0,l.drawLine)(e,t.element,p.start,p.end,{color:E})})}}}}};var a=u(n(0)),o=u(n(70)),r=u(n(7)),i=u(n(23)),l=n(3);function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.planePlaneIntersection)(e,t);if(n)return{start:(0,a.projectPatientPointToImagePlane)(n.start,e),end:(0,a.projectPatientPointToImagePlane)(n.end,e)}};var a=n(38)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getToolOptions=t.setToolOptions=t.version=t.adaptiveBrush=t.brush=t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=t.wwwcRegionTouch=t.wwwcRegion=t.wwwcTouchDrag=t.wwwc=t.touchTool=t.touchPinchTool=t.touchDragTool=t.textMarkerTouch=t.textMarker=t.simpleMouseButtonTool=t.simpleAngleTouch=t.simpleAngle=t.seedAnnotateTouch=t.seedAnnotate=t.scaleOverlayTool=t.saveAs=t.rotateTouch=t.rotateTouchDrag=t.rotate=t.rectangleRoiTouch=t.rectangleRoi=t.probeTouch=t.probe=t.panMultiTouch=t.panTouchDrag=t.pan=t.orientationMarkers=t.multiTouchDragTool=t.mouseWheelTool=t.mouseButtonTool=t.mouseButtonRectangleTool=t.magnifyTouchDrag=t.magnify=t.lengthTouch=t.length=t.keyboardTool=t.imageStats=t.highlightTouch=t.highlight=t.freehandSculpter=t.freehand=t.eraserTouch=t.eraser=t.rotatedEllipticalRoiTouch=t.rotatedEllipticalRoi=t.ellipticalRoiTouch=t.ellipticalRoi=t.dragProbeTouch=t.dragProbe=void 0,t.doubleTapZoom=t.doubleTapTool=t.displayTool=t.crosshairsTouch=t.crosshairs=t.arrowAnnotateTouch=t.arrowAnnotate=t.angleTouch=t.angle=t.touchInput=t.preventGhostClick=t.mouseWheelInput=t.mouseInput=t.keyboardInput=t.touchMoveHandle=t.touchMoveAllHandles=t.moveNewHandleTouch=t.moveNewHandle=t.moveHandle=t.moveAllHandles=t.handleActivator=t.getHandleNearImagePoint=t.drawHandles=t.anyHandlesOutsideImage=t.stopClip=t.playClip=t.stackRenderers=t.scrollIndicator=t.stackPrefetch=t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=t.stackScrollKeyboard=t.appState=t.globalFrameOfReferenceSpecificToolStateManager=t.newFrameOfReferenceSpecificToolStateManager=t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=t.loadHandlerManager=t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=t.textStyle=t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=t.toolColors=t.toolCoordinates=t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=t.toolStyle=t.panZoomSynchronizer=t.stackImageIndexSynchronizer=t.stackImagePositionOffsetSynchronizer=t.stackImagePositionSynchronizer=t.stackScrollSynchronizer=t.Synchronizer=t.updateImageSynchronizer=t.wwwcSynchronizer=t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=t.timeSeriesPlayer=t.incrementTimePoint=t.probeTool4D=t.calculateEllipseStatistics=t.calculateSUV=t.copyPoints=t.drawArrow=t.drawCircle=t.drawEllipse=t.drawTextBox=t.getLuminance=t.isMobileDevice=t.getBrowserInfo=t.getMaxSimultaneousRequests=t.getDefaultSimultaneousRequests=t.getRGBPixels=t.isMouseButtonEnabled=t.makeUnselectable=t.pointInRotatedEllipse=t.pointInEllipse=t.pointInsideBoundingBox=t.planePlaneIntersection=t.imagePointToPatientPoint=t.projectPatientPointToImagePlane=t.roundToDecimal=t.scroll=t.scrollToIndex=t.setContextToDisplayFontSize=t.requestPoolManager=t.orientation=t.referenceLines=t.EVENTS=t.external=t.drawing=void 0;var a=n(0);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return dt(a).default}});var o=n(1);Object.defineProperty(t,"EVENTS",{enumerable:!0,get:function(){return dt(o).default}});var r=n(151);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return dt(r).default}});var i=n(68);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return dt(i).default}});var l=n(49);Object.defineProperty(t,"requestPoolManager",{enumerable:!0,get:function(){return dt(l).default}});var u=n(146);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return dt(u).default}});var d=n(67);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return dt(d).default}});var s=n(48);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return dt(s).default}});var c=n(47);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return dt(c).default}});var f=n(38);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return f.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return f.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return f.planePlaneIntersection}});var v=n(25);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return dt(v).default}});var g=n(46);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return dt(g).default}});var m=n(66);Object.defineProperty(t,"pointInRotatedEllipse",{enumerable:!0,get:function(){return dt(m).default}});var h=n(145);Object.defineProperty(t,"makeUnselectable",{enumerable:!0,get:function(){return dt(h).default}});var p=n(5);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return dt(p).default}});var E=n(45);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return dt(E).default}});var T=n(37);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return T.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return T.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return T.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return T.isMobileDevice}});var y=n(65);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return dt(y).default}});var M=n(12);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return dt(M).default}});var x=n(144);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return dt(x).default}});var _=n(143);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return dt(_).default}});var S=n(64);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return dt(S).default}});var O=n(44);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return dt(O).default}});var b=n(21);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return dt(b).default}});var C=n(43);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return dt(C).default}});var P=n(142);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return dt(P).default}});var I=n(42);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return dt(I).default}});var L=n(139);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return dt(L).default}});var w=n(138);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return w.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return w.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return w.timeSeriesScrollTouchDrag}});var D=n(137);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return dt(D).default}});var U=n(136);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return dt(U).default}});var A=n(135);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return dt(A).default}});var R=n(134);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return dt(R).default}});var k=n(133);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return dt(k).default}});var N=n(132);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return dt(N).default}});var H=n(131);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return dt(H).default}});var j=n(130);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return dt(j).default}});var V=n(13);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return dt(V).default}});var B=n(2);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return B.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return B.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return B.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return B.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return B.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return B.getElementToolStateManager}});var W=n(36);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return dt(W).default}});var G=n(7);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return dt(G).default}});var F=n(129);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return F.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return F.newTimeSeriesSpecificToolStateManager}});var z=n(22);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return dt(z).default}});var K=n(128);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return K.stackSpecificStateManager}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return K.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return K.addStackStateManager}});var q=n(16);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return dt(q).default}});var Y=n(30);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return Y.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return Y.globalImageIdSpecificToolStateManager}});var X=n(127);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return X.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return X.globalFrameOfReferenceSpecificToolStateManager}});var Z=n(126);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return dt(Z).default}});var J=n(125);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return dt(J).default}});var Q=n(124);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return Q.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return Q.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return Q.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return Q.stackScrollMultiTouch}});var $=n(123);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return dt($).default}});var ee=n(122);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return dt(ee).default}});var te=n(121);Object.defineProperty(t,"stackRenderers",{enumerable:!0,get:function(){return dt(te).default}});var ne=n(119);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return ne.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return ne.stopClip}});var ae=n(15);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return dt(ae).default}});var oe=n(9);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return dt(oe).default}});var re=n(24);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return dt(re).default}});var ie=n(29);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return dt(ie).default}});var le=n(34);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return dt(le).default}});var ue=n(35);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return dt(ue).default}});var de=n(28);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return dt(de).default}});var se=n(32);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return dt(se).default}});var ce=n(62);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return dt(ce).default}});var fe=n(61);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return dt(fe).default}});var ve=n(118);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return dt(ve).default}});var ge=n(117);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return dt(ge).default}});var me=n(116);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return dt(me).default}});var he=n(60);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return dt(he).default}});var pe=n(115);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return dt(pe).default}});var Ee=n(114);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return Ee.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return Ee.angleTouch}});var Te=n(113);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return Te.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return Te.arrowAnnotateTouch}});var ye=n(111);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return ye.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return ye.crosshairsTouch}});var Me=n(27);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return dt(Me).default}});var xe=n(59);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return dt(xe).default}});var _e=n(110);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return dt(_e).default}});var Se=n(109);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return Se.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return Se.dragProbeTouch}});var Oe=n(108);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return Oe.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return Oe.ellipticalRoiTouch}});var be=n(107);Object.defineProperty(t,"rotatedEllipticalRoi",{enumerable:!0,get:function(){return be.rotatedEllipticalRoi}}),Object.defineProperty(t,"rotatedEllipticalRoiTouch",{enumerable:!0,get:function(){return be.rotatedEllipticalRoiTouch}});var Ce=n(105);Object.defineProperty(t,"eraser",{enumerable:!0,get:function(){return Ce.eraser}}),Object.defineProperty(t,"eraserTouch",{enumerable:!0,get:function(){return Ce.eraserTouch}});var Pe=n(26);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return Pe.freehand}});var Ie=n(54);Object.defineProperty(t,"freehandSculpter",{enumerable:!0,get:function(){return Ie.freehandSculpter}});var Le=n(95);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return Le.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return Le.highlightTouch}});var we=n(94);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return dt(we).default}});var De=n(63);Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return dt(De).default}});var Ue=n(93);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return Ue.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return Ue.lengthTouch}});var Ae=n(92);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return Ae.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return Ae.magnifyTouchDrag}});var Re=n(53);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return dt(Re).default}});var ke=n(10);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return dt(ke).default}});var Ne=n(33);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return dt(Ne).default}});var He=n(41);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return dt(He).default}});var je=n(91);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return dt(je).default}});var Ve=n(90);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Ve.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Ve.panTouchDrag}});var Be=n(89);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return dt(Be).default}});var We=n(88);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return We.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return We.probeTouch}});var Ge=n(87);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return Ge.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return Ge.rectangleRoiTouch}});var Fe=n(86);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return Fe.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return Fe.rotateTouchDrag}});var ze=n(85);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return dt(ze).default}});var Ke=n(84);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return dt(Ke).default}});var qe=n(83);Object.defineProperty(t,"scaleOverlayTool",{enumerable:!0,get:function(){return dt(qe).default}});var Ye=n(82);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return Ye.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return Ye.seedAnnotateTouch}});var Xe=n(81);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return Xe.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return Xe.simpleAngleTouch}});var Ze=n(18);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return dt(Ze).default}});var Je=n(80);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return Je.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return Je.textMarkerTouch}});var Qe=n(20);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return dt(Qe).default}});var $e=n(52);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return dt($e).default}});var et=n(11);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return dt(et).default}});var tt=n(79);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return tt.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return tt.wwwcTouchDrag}});var nt=n(78);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return nt.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return nt.wwwcRegionTouch}});var at=n(77);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return at.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return at.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return at.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return at.zoomTouchDrag}});var ot=n(76);Object.defineProperty(t,"brush",{enumerable:!0,get:function(){return ot.brush}});var rt=n(73);Object.defineProperty(t,"adaptiveBrush",{enumerable:!0,get:function(){return rt.adaptiveBrush}});var it=n(72);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return dt(it).default}});var lt=n(4);Object.defineProperty(t,"setToolOptions",{enumerable:!0,get:function(){return lt.setToolOptions}}),Object.defineProperty(t,"getToolOptions",{enumerable:!0,get:function(){return lt.getToolOptions}});var ut=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(3));function dt(e){return e&&e.__esModule?e:{default:e}}t.drawing=ut},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="2.5.0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adaptiveBrush=void 0;var a=u(n(0)),o=n(2),r=u(n(51)),i=u(n(50)),l=n(39);function u(e){return e&&e.__esModule?e:{default:e}}var d="brush",s={draw:1,radius:5,tolerance:5,minRadius:1,maxRadius:20,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)",active:!1},c=void 0,f=void 0,v=void 0,g=void 0,m=void 0;function h(e){var t=E.getConfiguration(),n=e.element,r=a.default.cornerstone.getLayer(n,t.brushLayerId),u=a.default.cornerstone.getLayers(n)[0],s=r.image,m=s.rows,h=s.columns,p=(0,o.getToolState)(n,d).data[0];g=function(e,t,n,a){for(var o=E.getConfiguration(),r=o.draw,u=Math.round(c.x),d=Math.round(c.y),s=null,g=[],m=o.radius;0!==s&&m>o.minRadius;){s=0,g=(0,i.default)(m,n,a,u,d);for(var h=0;h<g.length;h++){var p=g[h][0],T=e[g[h][1]*a+p];if(T>f||T<v){s++;break}}m--}return 0===s&&(0,l.drawBrushPixels)(g,t,r,a),m}(u.image.getPixelData(),p.pixelData,m,h),r.invalid=!0,a.default.cornerstone.updateImage(n)}function p(e){var t=E.getConfiguration(),n=e.element,r=a.default.cornerstone.getLayer(n,t.brushLayerId),u=r.image,s=u.rows,c=u.columns,f=e.currentPoints.image,v=f.x,g=f.y,m=(0,o.getToolState)(n,d).data[0].pixelData,h=t.draw,p=t.radius;if(!(v<0||v>c||g<0||g>s)){var T=(0,i.default)(p,s,c,v,g);(0,l.drawBrushPixels)(T,m,h,c),r.invalid=!0,a.default.cornerstone.updateImage(n)}}var E=(0,r.default)({onMouseMove:function(e){var t=e.detail;c=t.currentPoints.image,a.default.cornerstone.updateImage(t.element)},onMouseDown:function(e){var t=e.detail,n=t.element,o=E.getConfiguration(),r=a.default.cornerstone.getLayer(n,o.brushLayerId),l=a.default.cornerstone.getLayers(n)[0],u=t.currentPoints.image,d=u.x,s=u.y,g=r.image,T=g.rows,y=g.columns,M=(0,i.default)(o.radius,T,y,d,s);0===o.draw?p(t):(function(e,t,n){var a=E.getConfiguration().tolerance,o=Number.MAX_VALUE,r=-Number.MAX_VALUE;e.forEach(function(e){var a=e[1]*n+e[0],i=t[a];o=Math.min(i,o),r=Math.max(i,r)}),v=o-a,f=r+a}(M,l.image.getPixelData(),y),h(t)),m=!0,c=t.currentPoints.image},onMouseUp:function(e){var t=e.detail;c=t.currentPoints.image;var n=E.getConfiguration();m=!1,g=n.radius,a.default.cornerstone.updateImage(t.element)},onDrag:function(e){var t=e.detail;0===s.draw?p(t):h(t),m=!0,c=t.currentPoints.image},toolType:"adaptiveBrush",onImageRendered:function(e){var t=e.detail;if(c){var n=t.image,a=n.rows,o=n.columns,r=c,u=r.x,d=r.y;if(!(u<0||u>o||d<0||d>a)){var s=E.getConfiguration(),f=t.canvasContext,v=m?s.dragColor:s.hoverColor,h=t.element;if(g=m&&g||s.radius,f.setTransform(1,0,0,1,0,0),s.active){var p=(0,i.default)(g,a,o,u,d);(0,l.drawBrushOnCanvas)(p,f,v,h)}}}}});E.setConfiguration(s),t.adaptiveBrush=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();t.Queue=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store={},this.front=0,this.end=0}return a(e,[{key:"enqueue",value:function(e){this.store[this.end]=e,this.end++}},{key:"dequeue",value:function(){if(this.front===this.end)return null;var e=this.store[this.front];return delete this.store[this.front],this.front++,e}},{key:"size",value:function(){return this.end-this.front}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fillColor=t.isCircleInPolygon=t.connectEndsOfBrush=t.getEndOfCircle=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=n(39),r=n(74);function i(e,t,n,a){for(var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e;e<t?r<=t:r>=t;r+=e<t?1:-1){if(o&&n(a,r))return r;if(!o&&n(r,a))return r}return null}function l(e,t,n){return t[e]===n}function u(e,t,n,a,o,i){var u=e,d=t,s=0,c=new r.Queue,f=[],v=[0,1,0,-1],g=[-1,0,1,0],m=0,h=function(e,t){return t*n+e};c.enqueue({x:e,y:t});for(var p=0;p<a*n;p+=1)f.push(0);for(f[h(e,t)]=1;0!==c.size()&&m<=a*n;){m+=1;var E=c.dequeue(),T=h(E.x,E.y);if(s<f[T]){var y=[E.x,E.y,f[T]];u=y[0],d=y[1],s=y[2]}for(var M=0;M<4;M+=1){var x=E.y+g[M],_=E.x+v[M],S=h(_,x);x<0||x>=a||_<0||_>=n||l(S,o,i)&&0===f[S]&&(f[S]=f[T]+1,c.enqueue({x:_,y:x}))}}return{x:u,y:d}}function d(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=[],r=e;e<t?r<=t:r>=t;r+=e<t?1:-1)o.push(a?[n,r]:[r,n]);return o}t.getEndOfCircle=function(e,t,n,a,o,r){var u=function(e,t){return t*n+e};return[i(t,0,function(e,t){return!l(u(e,t-1),o,r)},e,!0),i(e,n,function(e,t){return!l(u(e+1,t),o,r)},t,!1),i(t,a,function(e,t){return!l(u(e,t+1),o,r)},e,!0),i(e,0,function(e,t){return!l(u(e-1,t),o,r)},t,!1)]},t.connectEndsOfBrush=function(e,t,n,r,s,c,f){var v=function(e,t,a){return(0,o.drawBrushPixels)([[e,t]],c,a,n)},g=function(e,t){return(0,o.drawBrushPixels)(e,c,t,n)},m=function(e,t,n,a,o,r,u){for(var d=[0,1,0,-1],s=[-1,0,1,0],c=Number.MAX_SAFE_INTEGER,f=-1,v=void 0,g=void 0,m=void 0,h=function(e,t){return t*n+e},p=function(p){var E=void 0,T=void 0,y=void 0;if(p%2){if(E=t,null===(T=i(o[p]+d[p],1===p?n:0,function(e,t){return l(h(e,t),r,u)},E,!1)))return"continue";y=i(T+d[p],1===p?n:0,function(e,t){return!l(h(e+d[p],t+s[p]),r,u)},E,!1)}else{if(E=e,null===(T=i(o[p]+s[p],0===p?0:a,function(e,t){return l(h(e,t),r,u)},E,!0)))return"continue";y=i(T+s[p],0===p?0:a,function(e,t){return!l(h(e+d[p],t+s[p]),r,u)},E,!0)}var M=Math.abs(T-(p%2?e:t));c>M&&(c=M,f=p,v=E,g=T,m=y)},E=0;E<o.length;E++)p(E);return c===Number.MAX_SAFE_INTEGER?[null,null,null,null]:[f,v,g,m]}(e,t,n,r,s,c,f),h=a(m,4),p=h[0],E=h[1],T=h[2],y=h[3],M=[];if(null===p)return!1;if(g(d(T,y,E,!(p%2)),0),p%2){var x=u(T,E-1,n,r,c,f),_=u(T,E+1,n,r,c,f);M.push(x),M.push(_)}else{var S=u(E-1,T,n,r,c,f),O=u(E+1,T,n,r,c,f);M.push(S),M.push(O)}if(g(d(T,y,E,!(p%2)),f),M.sort(function(e,t){return e.x-t.x}),M[0].x===M[1].x)g(d(M[0].y,M[1].y,M[0].x,!0),f);else{var b=(M[1].y-M[0].y)/(M[1].x-M[0].x),C=M[0].y-b*M[0].x;if(Math.abs(b)>=1){M.sort(function(e,t){return e.y-t.y});for(var P=M[0].y;P<=M[1].y;P+=1)for(var I=-0;I<=2;I+=1)v(Math.round((P-C)/b)+I,P,f)}else for(var L=M[0].x;L<=M[1].x;L+=1)for(var w=-0;w<=2;w+=1)v(L,Math.round(b*L+C)+w,f)}return!0},t.isCircleInPolygon=function(e,t,n,a,o,r,u){var d=function(e,t){return t*n+e},s=i(o[3]-1,0,function(e,t){return l(d(e,t),r,u)},t,!1),c=i(o[1]+1,n,function(e,t){return l(d(e,t),r,u)},t,!1);return s&&c},t.fillColor=function(e,t,n,a,i,u){var d=new r.Queue,s=[0,1,0,-1],c=[-1,0,1,0],f=0,v=function(e,t){return t*n+e},g=function(e,t,a){return(0,o.drawBrushPixels)([[e,t]],i,a,n)};for(d.enqueue({x:e,y:t}),g(e,t,u);0!==d.size()&&f<=a*n;){f+=1;for(var m=d.dequeue(),h=0;h<4;h+=1){var p=m.y+c[h],E=m.x+s[h];p<0||p>=a||E<0||E>=n||l(v(E,p),i,u)||(d.enqueue({x:E,y:p}),g(E,p,u))}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.brush=void 0;var a=d(n(0)),o=n(2),r=d(n(51)),i=d(n(50)),l=n(39),u=n(75);function d(e){return e&&e.__esModule?e:{default:e}}var s="brush",c=void 0,f=!1;function v(e){var t=g.getConfiguration(),n=e.element,r=a.default.cornerstone.getLayer(n,t.brushLayerId),u=r.image,d=u.rows,c=u.columns,f=e.currentPoints.image,v=f.x,m=f.y,h=(0,o.getToolState)(n,s).data[0].pixelData,p=t.draw,E=t.radius;if(!(v<0||v>c||m<0||m>d)){var T=(0,i.default)(E,d,c,v,m);(0,l.drawBrushPixels)(T,h,p,c),r.invalid=!0,a.default.cornerstone.updateImage(n)}}var g=(0,r.default)({onMouseMove:function(e){var t=e.detail;c=t.currentPoints.image,a.default.cornerstone.updateImage(t.element)},onMouseDown:function(e){var t=e.detail;v(t),f=!0,c=t.currentPoints.image},onMouseUp:function(e){var t=e.detail;c=t.currentPoints.image,f=!1},onDrag:function(e){var t=e.detail;v(t),f=!0,c=t.currentPoints.image},toolType:"brush",onImageRendered:function(e){var t=e.detail;if(c){var n=t.image,a=n.rows,o=n.columns,r=c,u=r.x,d=r.y;if(!(u<0||u>o||d<0||d>a)){var s=g.getConfiguration(),v=s.radius,m=t.canvasContext,h=f?s.dragColor:s.hoverColor,p=t.element;if(m.setTransform(1,0,0,1,0,0),s.active){var E=(0,i.default)(v,a,o,u,d);(0,l.drawBrushOnCanvas)(E,m,h,p)}}}},onMouseDoubleClick:function(e){!function(e){var t=g.getConfiguration(),n=t.radius,r=e.element,i=a.default.cornerstone.getLayer(r,t.brushLayerId),l=i.image,d=l.rows,c=l.columns,f=e.currentPoints.image,v=f.x,m=f.y,h=(0,o.getToolState)(r,s).data[0].pixelData,p=t.draw;if(!(v<0||v>c||m<0||m>d)){v=Math.round(v),m=Math.round(m);var E=(0,u.getEndOfCircle)(v,m,c,d,h,p);Math.abs(E[0]-E[2])>2*n&&Math.abs(E[1]-E[3])>2*n||((0,u.connectEndsOfBrush)(v,m,c,d,E,h,p)&&(0,u.isCircleInPolygon)(v,m,c,d,E,h,p)&&(0,u.fillColor)(v,E[0]-1,c,d,h,p),i.invalid=!0,a.default.cornerstone.updateImage(r))}}(e.detail)}});g.setConfiguration({draw:1,radius:5,minRadius:1,maxRadius:20,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)",active:!1}),t.brush=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var a=f(n(1)),o=f(n(0)),r=f(n(18)),i=f(n(5)),l=f(n(33)),u=f(n(52)),d=f(n(20)),s=n(4),c=n(8);function f(e){return e&&e.__esModule?e:{default:e}}var v="zoom",g=void 0;function m(e,t){var n=y.getConfiguration(),a=Math.log(e.scale)/Math.log(1.7)+t,o=Math.pow(1.7,a);return n.maxScale&&o>n.maxScale?e.scale=n.maxScale:n.minScale&&o<n.minScale?e.scale=n.minScale:e.scale=o,e}function h(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var n=t.rotation*Math.PI/180,a=Math.cos(n),o=Math.sin(n),r=e.x*a-e.y*o,i=e.x*o+e.y*a;e.x=r,e.y=i}return e}function p(e,t){var n=o.default.cornerstone,a=e.element,r=m(e.viewport,t);n.setViewport(a,r);var i=n.pageToPixel(a,e.startPoints.page.x,e.startPoints.page.y),l={x:e.startPoints.image.x-i.x,y:e.startPoints.image.y-i.y};l=h(l,r),r.translation.x-=l.x,r.translation.y-=l.y,n.setViewport(a,r)}function E(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,T),t.removeEventListener(a.default.MOUSE_UP,E),t.removeEventListener(a.default.MOUSE_CLICK,E)}function T(e){var t=e.detail;if(!t.deltaPoints.page.y)return!1;var n=t.deltaPoints.page.y/100,a=y.getConfiguration();a&&a.invert&&(n*=-1),y.strategy(t,n),e.preventDefault(),e.stopPropagation()}var y=(0,r.default)(function(e){var t=e.detail,n=t.element,o=(0,s.getToolOptions)(v,n);(0,i.default)(t.which,o.mouseButtonMask)&&(g=t.startPoints,n.addEventListener(a.default.MOUSE_DRAG,T),n.addEventListener(a.default.MOUSE_UP,E),n.addEventListener(a.default.MOUSE_CLICK,E),e.preventDefault(),e.stopPropagation())},v);y.strategies={default:p,translate:function(e,t){var n=e.element,a=e.image,r=y.getConfiguration(),i=m(e.viewport,t),l={x:0,y:0};if(t<0)i.scale<3&&(Math.abs(i.translation.x)<.01?i.translation.x=0:l.x=i.translation.x/8,Math.abs(i.translation.y)<.01?i.translation.y=0:l.y=i.translation.y/8);else{r&&r.preventZoomOutsideImage&&(0,c.clipToBox)(g.image,a);var u={x:a.width/2-g.image.x,y:a.height/2-g.image.y};u=h(u,i);var d={x:i.translation.x-u.x,y:i.translation.y-u.y};Math.abs(d.x)<.01?i.translation.x=u.x:l.x=d.x/8,Math.abs(d.y)<.01?i.translation.y=u.y:l.y=d.y/8}i.translation.x-=l.x,i.translation.y-=l.y,o.default.cornerstone.setViewport(n,i)},zoomToCenter:function(e,t){var n=e.element,a=m(e.viewport,t);o.default.cornerstone.setViewport(n,a)}},y.strategy=p;var M=(0,l.default)(function(e){var t=e.detail,n=-t.direction/4,a=y.getConfiguration();a&&a.invert&&(n*=-1);var r=m(t.viewport,n);o.default.cornerstone.setViewport(t.element,r)}),x=(0,u.default)(function(e){var t=e.detail,n=o.default.cornerstone,a=y.getConfiguration(),r=t.viewport,i=t.element;r.scale+=t.scaleChange*r.scale,a.maxScale&&r.scale>a.maxScale?r.scale=a.maxScale:a.minScale&&r.scale<a.minScale&&(r.scale=a.minScale),n.setViewport(i,r);var l=n.pageToPixel(i,t.startPoints.page.x,t.startPoints.page.y),u={x:t.startPoints.image.x-l.x,y:t.startPoints.image.y-l.y};u=h(u,r),r.translation.x-=u.x,r.translation.y-=u.y,n.setViewport(i,r)}),_=(0,d.default)(T,v);t.zoom=y,t.zoomWheel=M,t.zoomTouchPinch=x,t.zoomTouchDrag=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var a=f(n(1)),o=f(n(0)),r=f(n(7)),i=n(2),l=f(n(65)),u=f(n(5)),d=n(4),s=f(n(8)),c=n(3);function f(e){return e&&e.__esModule?e:{default:e}}var v="wwwcRegion",g={minWindowWidth:10};function m(e){var t=e.detail.element,n=(0,i.getToolState)(t,v);n&&n.data&&(n.data=[]),t.removeEventListener(a.default.MOUSE_MOVE,M),t.removeEventListener(a.default.MOUSE_DRAG,M),t.removeEventListener(a.default.MOUSE_UP,h),t.removeEventListener(a.default.MOUSE_CLICK,h),t.addEventListener(a.default.MOUSE_DOWN,T)}function h(e){var t=e.detail,n=t.element;n.removeEventListener(a.default.MOUSE_MOVE,M),n.removeEventListener(a.default.MOUSE_DRAG,M),n.removeEventListener(a.default.MOUSE_UP,h),n.removeEventListener(a.default.MOUSE_CLICK,h),n.addEventListener(a.default.MOUSE_DOWN,T);var o=(0,i.getToolState)(t.element,v);o&&o.data&&o.data.length&&(o.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},p(t))}function p(e){var t=o.default.cornerstone,n=(0,i.getToolState)(e.element,v);if(n&&n.data&&n.data.length){var a=n.data[0].startPoint,r=n.data[0].endPoint,u=Math.abs(a.x-r.x),d=Math.abs(a.y-r.y),c=Math.min(a.x,r.x),f=Math.min(a.y,r.y);c=(0,s.default)(c,0,e.image.width),f=(0,s.default)(f,0,e.image.height),u=Math.floor(Math.min(u,Math.abs(e.image.width-c))),d=Math.floor(Math.min(d,Math.abs(e.image.height-f)));var g=function(e,t,n){var a=e.length;if(a<2)return{min:t,max:n,mean:(t+n)/2};for(var o=n,r=t,i=0,l=0;l<a;l++){var u=e[l];o=Math.min(o,u),r=Math.max(r,u),i+=u}return{min:o,max:r,mean:i/a}}((0,l.default)(e.element,c,f,u,d),e.image.minPixelValue,e.image.maxPixelValue),m=O.getConfiguration(),h=t.getViewport(e.element);void 0===m.minWindowWidth&&(m.minWindowWidth=10),h.voi.windowWidth=Math.max(Math.abs(g.max-g.min),m.minWindowWidth),h.voi.windowCenter=g.mean,t.setViewport(e.element,h),n.data=[],t.updateImage(e.element)}}function E(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_MOVE,E),t.removeEventListener(a.default.MOUSE_DRAG,E),t.addEventListener(a.default.MOUSE_MOVE,M),t.addEventListener(a.default.MOUSE_DRAG,M),t.addEventListener(a.default.MOUSE_CLICK,h),e.type===a.default.MOUSE_DRAG&&t.addEventListener(a.default.MOUSE_UP,h)}function T(e){var t=e.detail,n=t.element,o=(0,d.getToolOptions)(v,n);if((0,u.default)(t.which,o.mouseButtonMask))return n.addEventListener(a.default.MOUSE_DRAG,E),n.addEventListener(a.default.MOUSE_MOVE,E),n.removeEventListener(a.default.MOUSE_DOWN,T),y(t),!1}function y(e){var t=(0,i.getToolState)(e.element,v);t&&t.data&&(t.data=[]);var n={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,i.addToolState)(e.element,v,n)}function M(e){var t=e.detail,n=t.element,a=(0,i.getToolState)(n,v);a&&a.data&&a.data.length&&(a.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},o.default.cornerstone.updateImage(n))}function x(e){var t=e.detail,n=t.element,a=t.canvasContext,o=(0,i.getToolState)(t.element,v);if(o&&o.data&&o.data.length){var l=o.data[0].startPoint,u=o.data[0].endPoint;if(l&&u){a.setTransform(1,0,0,1,0,0);var d=r.default.getActiveColor(),s=O.getConfiguration();(0,c.draw)(a,function(e){(0,c.setShadow)(e,s),(0,c.drawRect)(e,n,l,u,{color:d})})}}}function _(e){e.removeEventListener(a.default.MOUSE_DOWN,T),e.removeEventListener(a.default.MOUSE_UP,h),e.removeEventListener(a.default.MOUSE_CLICK,h),e.removeEventListener(a.default.MOUSE_DRAG,M),e.removeEventListener(a.default.MOUSE_MOVE,M),e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,m),o.default.cornerstone.updateImage(e)}function S(e){e.removeEventListener(a.default.TOUCH_DRAG,M),e.removeEventListener(a.default.TOUCH_START,y),e.removeEventListener(a.default.TOUCH_DRAG_END,p),e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,x)}var O={activate:function(e,t){(0,d.setToolOptions)(v,e,{mouseButtonMask:t}),(0,i.getToolState)(e,v)||(0,i.addToolState)(e,v,[]);e.removeEventListener(a.default.MOUSE_DOWN,T),e.removeEventListener(a.default.MOUSE_UP,h),e.removeEventListener(a.default.MOUSE_CLICK,h),e.removeEventListener(a.default.MOUSE_DRAG,M),e.removeEventListener(a.default.MOUSE_MOVE,M),e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,m),e.addEventListener(a.default.MOUSE_DOWN,T),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,m),o.default.cornerstone.updateImage(e)},deactivate:_,disable:_,setConfiguration:function(e){g=e},getConfiguration:function(){return g}},b={activate:function(e){(0,i.getToolState)(e,v)||(0,i.addToolState)(e,v,[]);e.removeEventListener(a.default.TOUCH_DRAG,M),e.removeEventListener(a.default.TOUCH_START,y),e.removeEventListener(a.default.TOUCH_DRAG_END,p),e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,x),e.addEventListener(a.default.TOUCH_DRAG,M),e.addEventListener(a.default.TOUCH_START,y),e.addEventListener(a.default.TOUCH_DRAG_END,p),e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,x)},deactivate:S,disable:S};t.wwwcRegion=O,t.wwwcRegionTouch=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcTouchDrag=t.wwwc=void 0;var a=d(n(1)),o=d(n(0)),r=d(n(18)),i=d(n(20)),l=d(n(5)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s="wwwc";function c(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,v),t.removeEventListener(a.default.MOUSE_UP,c),t.removeEventListener(a.default.MOUSE_CLICK,c)}function f(e){var t=(e.image.maxPixelValue*e.image.slope+e.image.intercept-(e.image.minPixelValue*e.image.slope+e.image.intercept))/1024,n=e.deltaPoints.page.x*t,a=e.deltaPoints.page.y*t;e.viewport.voi.windowWidth+=n,e.viewport.voi.windowCenter+=a}function v(e){var t=e.detail;g.strategy(t),o.default.cornerstone.setViewport(t.element,t.viewport)}var g=(0,r.default)(function(e){var t=e.detail,n=t.element,o=(0,u.getToolOptions)(s,n);(0,l.default)(t.which,o.mouseButtonMask)&&(n.addEventListener(a.default.MOUSE_DRAG,v),n.addEventListener(a.default.MOUSE_UP,c),n.addEventListener(a.default.MOUSE_CLICK,c),e.preventDefault(),e.stopPropagation())},s);g.strategies={default:f},g.strategy=f;var m=(0,i.default)(function(e){var t=e.detail;e.stopImmediatePropagation();var n=t,a=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,r=n.deltaPoints.page.x*a,i=n.deltaPoints.page.y*a,l=g.getConfiguration();l.orientation?0===l.orientation?(n.viewport.voi.windowWidth+=r,n.viewport.voi.windowCenter+=i):(n.viewport.voi.windowWidth+=i,n.viewport.voi.windowCenter+=r):(n.viewport.voi.windowWidth+=r,n.viewport.voi.windowCenter+=i),o.default.cornerstone.setViewport(n.element,n.viewport)});t.wwwc=g,t.wwwcTouchDrag=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var a=m(n(1)),o=m(n(0)),r=m(n(10)),i=m(n(11)),l=m(n(25)),u=m(n(7)),d=m(n(5)),s=n(12),c=m(s),f=n(2),v=n(4),g=n(3);function m(e){return e&&e.__esModule?e:{default:e}}var h="textMarker";function p(e){var t=y.getConfiguration();if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(o.default.cornerstoneMath.point.insideRect(n.handles.end,a)){var r=t.markers.indexOf(t.current);return t.ascending?(r+=1)>=t.markers.length&&(t.loop?r-=t.markers.length:r=-1):(r-=1)<0&&(t.loop?r+=t.markers.length:r=-1),t.current=t.markers[r],n}}}function E(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var a=o.default.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),r=(0,l.default)(t.handles.end,n);return a<10||r}}function T(e){var t=e.detail,n=(0,f.getToolState)(t.element,h);if(n)for(var a=(0,g.getNewContext)(t.canvasContext.canvas),r=y.getConfiguration(),i=function(e){var i=n.data[e];if(!1===i.visible)return"continue";var l=u.default.getColorIfActive(i);(0,g.draw)(a,function(e){(0,g.setShadow)(e,r);i.textWidth=(0,s.textBoxWidth)(e,i.text,5);var n=o.default.cornerstone.pixelToCanvas(t.element,i.handles.end);i.handles.end.boundingBox=(0,c.default)(e,i.text,n.x,n.y-10,l,{centering:{x:!0,y:!0}})})},l=0;l<n.data.length;l++)i(l)}var y=(0,r.default)({createNewMeasurement:p,onImageRendered:T,pointNearTool:E,toolType:h,mouseDoubleClickCallback:function(e){var t=e.detail,n=o.default.cornerstone,r=t.element,i=void 0,l=(0,v.getToolOptions)(h,r);if((0,d.default)(t.which,l.mouseButtonMask)){var u=y.getConfiguration(),s=t.currentPoints.canvas,c=(0,f.getToolState)(r,h);if(c){for(var g=0;g<c.data.length;g++)if(E(0,i=c.data[g],s))return i.active=!0,n.updateImage(r),r.removeEventListener(a.default.MOUSE_MOVE,y.mouseMoveCallback),r.removeEventListener(a.default.MOUSE_DOWN,y.mouseDownCallback),r.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,y.mouseDownActivateCallback),r.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,y.mouseDoubleClickCallback),u.changeTextCallback(i,t,m),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation();e.preventDefault(),e.stopPropagation()}}function m(e,t,o){!0===o?(0,f.removeToolState)(r,h,e):e.text=t,e.active=!1,n.updateImage(r),r.addEventListener(a.default.MOUSE_MOVE,y.mouseMoveCallback),r.addEventListener(a.default.MOUSE_DOWN,y.mouseDownCallback),r.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,y.mouseDownActivateCallback),r.addEventListener(a.default.MOUSE_DOUBLE_CLICK,y.mouseDoubleClickCallback)}}}),M=(0,i.default)({createNewMeasurement:p,onImageRendered:T,pointNearTool:E,toolType:h,pressCallback:function(e){var t=e.detail,n=o.default.cornerstone,r=t.element,i=void 0;function l(e,t,o){!0===o?(0,f.removeToolState)(r,h,e):e.text=t,e.active=!1,n.updateImage(r),r.addEventListener(a.default.TOUCH_DRAG,M.touchMoveCallback),r.addEventListener(a.default.TOUCH_START_ACTIVE,M.touchDownActivateCallback),r.addEventListener(a.default.TOUCH_START,M.touchStartCallback),r.addEventListener(a.default.TAP,M.tapCallback),r.addEventListener(a.default.TOUCH_PRESS,M.pressCallback)}var u=y.getConfiguration(),d=t.currentPoints.canvas,s=(0,f.getToolState)(r,h);if(!s)return!1;if(t.handlePressed)return t.handlePressed.active=!0,n.updateImage(r),r.removeEventListener(a.default.TOUCH_DRAG,M.touchMoveCallback),r.removeEventListener(a.default.TOUCH_START_ACTIVE,M.touchDownActivateCallback),r.removeEventListener(a.default.TOUCH_START,M.touchStartCallback),r.removeEventListener(a.default.TAP,M.tapCallback),r.removeEventListener(a.default.TOUCH_PRESS,M.pressCallback),u.changeTextCallback(t.handlePressed,t,l),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation();for(var c=0;c<s.data.length;c++)if(E(0,i=s.data[c],d))return i.active=!0,n.updateImage(r),r.removeEventListener(a.default.TOUCH_DRAG,M.touchMoveCallback),r.removeEventListener(a.default.TOUCH_START_ACTIVE,M.touchDownActivateCallback),r.removeEventListener(a.default.TOUCH_START,M.touchStartCallback),r.removeEventListener(a.default.TAP,M.tapCallback),r.removeEventListener(a.default.TOUCH_PRESS,M.pressCallback),u.changeTextCallback(i,t,l),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation();e.preventDefault(),e.stopPropagation()}});t.textMarker=y,t.textMarkerTouch=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var a=M(n(1)),o=M(n(0)),r=M(n(10)),i=M(n(47)),l=M(n(17)),u=M(n(13)),d=M(n(7)),s=M(n(15)),c=M(n(28)),f=M(n(32)),v=M(n(9)),g=M(n(11)),m=M(n(31)),h=n(2),p=n(3),E=n(12),T=M(n(14)),y=M(n(19));function M(e){return e&&e.__esModule?e:{default:e}}var x="simpleAngle";function _(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function S(e,t,n){return!1!==t.visible&&((0,m.default)(e,t.handles.start,t.handles.middle,n)<25||(0,m.default)(e,t.handles.middle,t.handles.end,n)<25)}function O(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function b(e){var t=e.detail,n=(0,h.getToolState)(e.currentTarget,x);if(n)for(var a=o.default.cornerstone,r=t.enabledElement,i=(0,p.getNewContext)(t.canvasContext.canvas),s=u.default.getToolWidth(),c=I.getConfiguration(),f=function(e){var o=n.data[e];if(!1===o.visible)return"continue";(0,p.draw)(i,function(e){(0,p.setShadow)(e,c);var n=d.default.getColorIfActive(o),i=a.pixelToCanvas(t.element,o.handles.start),u=a.pixelToCanvas(t.element,o.handles.middle);(0,p.drawJoinedLines)(e,t.element,o.handles.start,[o.handles.middle,o.handles.end],{color:n});var f={drawHandlesIfActive:c&&c.drawHandlesOnHover};if((0,v.default)(e,t,o.handles,n,f),P(o,t.image),o.rAngle){var g=function(e,t){var n=(0,y.default)(t),a=n.rowPixelSpacing,o=n.colPixelSpacing,r=a&&o?"":" (isotropic)";return e.unit=String.fromCharCode(parseInt("00B0",16))+r,e.rAngle.toString()+e.unit}(o,t.image),h=void 0;if(!o.handles.textBox.hasMoved){h={x:u.x,y:u.y};var T=(0,E.textBoxWidth)(e,g,5);u.x<i.x?h.x-=15+T:h.x+=15;var M=a.internal.getTransform(r);M.invert();var x=M.transformPoint(h.x,h.y);o.handles.textBox.x=x.x,o.handles.textBox.y=x.y}(0,l.default)(e,t.element,o.handles.textBox,g,o.handles,m,n,s,0,!0)}})},g=0;g<n.data.length;g++)f(g);function m(e){return[e.start,e.middle,e.end]}}function C(e,t){P(t,o.default.cornerstone.getImage(e)),(0,T.default)(e,t,x)}function P(e,t){var n=(0,y.default)(t),a=n.rowPixelSpacing,o=n.colPixelSpacing;a=a||1,o=o||1;var r={x:(Math.ceil(e.handles.middle.x)-Math.ceil(e.handles.start.x))*o,y:(Math.ceil(e.handles.middle.y)-Math.ceil(e.handles.start.y))*a},l={x:(Math.ceil(e.handles.end.x)-Math.ceil(e.handles.middle.x))*o,y:(Math.ceil(e.handles.end.y)-Math.ceil(e.handles.middle.y))*a},u={x:(Math.ceil(e.handles.end.x)-Math.ceil(e.handles.start.x))*o,y:(Math.ceil(e.handles.end.y)-Math.ceil(e.handles.start.y))*a},d=O(r),s=O(l),c=O(u),f=Math.acos((Math.pow(d,2)+Math.pow(s,2)-Math.pow(c,2))/(2*d*s));f*=180/Math.PI,e.rAngle=(0,i.default)(f,2)}var I=(0,r.default)({createNewMeasurement:_,addNewMeasurement:function(e){var t=o.default.cornerstone,n=_(e),r=e.element;(0,h.addToolState)(r,x,n),r.removeEventListener(a.default.MOUSE_MOVE,I.mouseMoveCallback),r.removeEventListener(a.default.MOUSE_DRAG,I.mouseMoveCallback),r.removeEventListener(a.default.MOUSE_DOWN,I.mouseDownCallback),r.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,I.mouseDownActivateCallback),t.updateImage(r),(0,c.default)(e,x,n,n.handles.middle,function(){if(n.active=!1,(0,s.default)(e,n.handles))return(0,h.removeToolState)(r,x,n),r.addEventListener(a.default.MOUSE_MOVE,I.mouseMoveCallback),r.addEventListener(a.default.MOUSE_DRAG,I.mouseMoveCallback),r.addEventListener(a.default.MOUSE_DOWN,I.mouseDownCallback),r.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,I.mouseDownActivateCallback),void t.updateImage(r);n.handles.end.active=!0,t.updateImage(r),(0,c.default)(e,x,n,n.handles.end,function(){n.active=!1,(0,s.default)(e,n.handles)?(0,h.removeToolState)(r,x,n):C(r,n),r.addEventListener(a.default.MOUSE_MOVE,I.mouseMoveCallback),r.addEventListener(a.default.MOUSE_DRAG,I.mouseMoveCallback),r.addEventListener(a.default.MOUSE_DOWN,I.mouseDownCallback),r.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,I.mouseDownActivateCallback),t.updateImage(r)})})},onImageRendered:b,pointNearTool:S,toolType:x,onHandleDoneMove:C}),L=(0,g.default)({createNewMeasurement:_,addNewMeasurement:function(e){var t=o.default.cornerstone,n=_(e),r=e.element;(0,h.addToolState)(r,x,n),r.removeEventListener(a.default.TOUCH_DRAG,L.touchMoveCallback),r.removeEventListener(a.default.TOUCH_START_ACTIVE,L.touchDownActivateCallback),r.removeEventListener(a.default.TOUCH_START,L.touchStartCallback),r.removeEventListener(a.default.TAP,L.tapCallback),t.updateImage(r),(0,f.default)(e,x,n,n.handles.middle,function(){if((0,s.default)(e,n.handles))return(0,h.removeToolState)(r,x,n),r.addEventListener(a.default.TOUCH_DRAG,L.touchMoveCallback),r.addEventListener(a.default.TOUCH_START,L.touchStartCallback),r.addEventListener(a.default.TOUCH_START_ACTIVE,L.touchDownActivateCallback),r.addEventListener(a.default.TAP,L.tapCallback),void t.updateImage(r);(0,f.default)(e,x,n,n.handles.end,function(){(0,s.default)(e,n.handles)?((0,h.removeToolState)(r,x,n),t.updateImage(r)):C(r,n),r.addEventListener(a.default.TOUCH_DRAG,L.touchMoveCallback),r.addEventListener(a.default.TOUCH_START,L.touchStartCallback),r.addEventListener(a.default.TOUCH_START_ACTIVE,L.touchDownActivateCallback),r.addEventListener(a.default.TAP,L.tapCallback)})})},onImageRendered:b,pointNearTool:S,toolType:x,onHandleDoneMove:C});t.simpleAngle=I,t.simpleAngleTouch=L},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var a=y(n(1)),o=y(n(0)),r=y(n(10)),i=y(n(11)),l=y(n(22)),u=y(n(13)),d=y(n(7)),s=y(n(15)),c=y(n(35)),f=y(n(9)),v=y(n(5)),g=y(n(25)),m=y(n(17)),h=n(2),p=n(4),E=n(3),T=n(12);function y(e){return e&&e.__esModule?e:{default:e}}var M="seedAnnotate";var x={getTextCallback:function(e){e(prompt("Enter your annotation:"))},changeTextCallback:function(e,t,n){n(prompt("Change your annotation:"))},drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0};function _(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function S(e,t,n){if(!1===t.visible)return!1;if(t.handles.end){var a=o.default.cornerstone.pixelToCanvas(e,t.handles.end);return o.default.cornerstoneMath.point.distance(a,n)<25}}function O(e){var t=e.detail,n=(0,h.getToolState)(e.currentTarget,M);if(n)for(var a=o.default.cornerstone,r=t.enabledElement,i=(0,E.getNewContext)(t.canvasContext.canvas),s=t.canvasContext.canvas.width,c=u.default.getToolWidth(),v=b.getConfiguration(),g=function(e){var o=n.data[e];if(!1===o.visible)return"continue";(0,E.draw)(i,function(e){(0,E.setShadow)(e,v);var n=d.default.getColorIfActive(o),i=a.pixelToCanvas(t.element,o.handles.end);(0,E.drawCircle)(e,t.element,o.handles.end,6,{color:n});var u={drawHandlesIfActive:v&&v.drawHandlesOnHover};if(v.drawHandles&&(0,f.default)(e,t,i,n,u),o.text&&""!==o.text){var g=function(e){var t="";t=v.showCoordinates?e.text+" x: "+Math.round(e.handles.end.x)+" y: "+Math.round(e.handles.end.y):e.text;return t}(o),h=(0,T.textBoxWidth)(e,g,5),p=l.default.getFontSize()+10,M=Math.max(h,p)/2+5;i.x>s/2&&(M=-M);var x=void 0;if(!o.handles.textBox.hasMoved){x={x:i.x-h/2+M,y:i.y-p/2};var _=a.internal.getTransform(r);_.invert();var S=_.transformPoint(x.x,x.y);o.handles.textBox.x=S.x,o.handles.textBox.y=S.y}(0,m.default)(e,t.element,o.handles.textBox,g,o.handles,y,n,c,0,!1)}})},p=0;p<n.data.length;p++)g(p);function y(e){return[e.end]}}var b=(0,r.default)({addNewMeasurement:function(e){var t=o.default.cornerstone,n=e.element,a=b.getConfiguration(),r=_(e);function i(e){null===e?(0,h.removeToolState)(n,M,r):r.text=e,r.active=!1,t.updateImage(n)}(0,h.addToolState)(n,M,r),t.updateImage(n),(0,c.default)(e,M,r,r.handles.end,function(){(0,s.default)(e,r.handles)&&(0,h.removeToolState)(n,M,r),void 0===r.text&&a.getTextCallback(i),t.updateImage(n)})},createNewMeasurement:_,onImageRendered:O,pointNearTool:S,toolType:M,mouseDoubleClickCallback:function(e){var t=e.detail,n=o.default.cornerstone,a=t.element,r=void 0,i=(0,p.getToolOptions)(M,a);if((0,v.default)(t.which,i.mouseButtonMask)){var l=b.getConfiguration(),u=t.currentPoints.canvas,d=(0,h.getToolState)(a,M);if(d){for(var s=0;s<d.data.length;s++)if(r=d.data[s],S(a,r,u)||(0,g.default)(r.handles.textBox,u))return r.active=!0,n.updateImage(a),l.changeTextCallback(r,t,c),e.stopImmediatePropagation(),!1;e.preventDefault(),e.stopPropagation()}}function c(e,t,o){!0===o?(0,h.removeToolState)(a,M,e):e.text=t,e.active=!1,n.updateImage(a)}}});b.setConfiguration(x);var C=(0,i.default)({addNewMeasurement:function(e){var t=o.default.cornerstone,n=e.element,a=b.getConfiguration(),r=_(e);function i(e){null===e?(0,h.removeToolState)(n,M,r):r.text=e,r.active=!1,t.updateImage(n)}(0,h.addToolState)(n,M,r),t.updateImage(n),(0,c.default)(e,M,r,r.handles.end,function(){(0,s.default)(e,r.handles)&&(0,h.removeToolState)(n,M,r),void 0===r.text&&a.getTextCallback(i),t.updateImage(n)})},createNewMeasurement:_,onImageRendered:O,pointNearTool:S,toolType:M,pressCallback:function(e){var t=e.detail,n=o.default.cornerstone,r=t.element,i=void 0;function l(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,h.removeToolState)(r,M,e):e.text=t,e.active=!1,n.updateImage(r),r.addEventListener(a.default.TOUCH_START,C.touchStartCallback),r.addEventListener(a.default.TOUCH_START_ACTIVE,C.touchDownActivateCallback),r.addEventListener(a.default.TAP,C.tapCallback)}var u=b.getConfiguration(),d=t.currentPoints.canvas,s=(0,h.getToolState)(r,M);if(!s)return!1;if(t.handlePressed)return r.removeEventListener(a.default.TOUCH_START,C.touchStartCallback),r.removeEventListener(a.default.TOUCH_START_ACTIVE,C.touchDownActivateCallback),r.removeEventListener(a.default.TAP,C.tapCallback),u.changeTextCallback(t.handlePressed,t,l),e.stopImmediatePropagation(),!1;for(var c=0;c<s.data.length;c++)if(i=s.data[c],S(r,i,d)||(0,g.default)(i.handles.textBox,d))return i.active=!0,n.updateImage(r),r.removeEventListener(a.default.TOUCH_START,C.touchStartCallback),r.removeEventListener(a.default.TOUCH_START_ACTIVE,C.touchDownActivateCallback),r.removeEventListener(a.default.TAP,C.tapCallback),u.changeTextCallback(i,t,l),e.stopImmediatePropagation(),!1;e.preventDefault(),e.stopPropagation()}});t.seedAnnotate=b,t.seedAnnotateTouch=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(27)),o=i(n(0)),r=n(3);function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,a,o){var r={left:0,top:0,width:t.width,height:t.height},i=a*Math.min(1e3,t.width),l=o*Math.min(1e3,t.height);return{topLeft:{x:(r={left:r.left+i,top:r.top+l,width:r.width-2*i,height:r.height-2*l}).left,y:r.top},bottomRight:{x:r.left+r.width,y:r.top+r.height}}}function u(e){var t=e.detail,n=(0,r.getNewContext)(t.canvasContext.canvas),a=t.image,i=t.viewport,u=o.default.cornerstone.metaData.get("imagePlaneModule",a.imageId),s=void 0,c=void 0;if(u?(s=u.rowPixelSpacing||u.rowImagePixelSpacing,c=u.columnPixelSpacing||u.colImagePixelSpacing):(s=a.rowPixelSpacing,c=a.columnPixelSpacing),!s||!c){var f=a.data.string("x00181164").split("\\");if(2!==f.length)return;s=Number(f[0]),c=Number(f[1])}if(s&&c){var v={width:n.canvas.width,height:n.canvas.height},g={width:a.width,height:a.height},m=10/s*i.scale,h=10/c*i.scale,p=l(0,v,0,.25,.05),E=l(0,v,0,.05,.15);if(v.width&&v.height&&g.width&&g.height&&p&&E){var T=d.getConfiguration(),y=Object.assign({},{hscaleBounds:p,vscaleBounds:E,verticalMinorTick:m,horizontalMinorTick:h,minorTickLength:12.5,majorTickLength:25,verticalLine:{start:{x:E.bottomRight.x,y:E.topLeft.y},end:{x:E.bottomRight.x,y:E.bottomRight.y}},horizontalLine:{start:{x:p.topLeft.x,y:p.bottomRight.y},end:{x:p.bottomRight.x,y:p.bottomRight.y}}},T),M={color:y.color,lineWidth:y.lineWidth},x=function(e){for(var t=0,n=[];e.verticalLine.start.y+t*e.verticalMinorTick<=e.vscaleBounds.bottomRight.y;){var a={x:e.verticalLine.start.x,y:e.verticalLine.start.y+t*e.verticalMinorTick},o={x:0,y:e.verticalLine.start.y+t*e.verticalMinorTick};o.x=t%5==0?e.verticalLine.start.x-e.majorTickLength:e.verticalLine.start.x-e.minorTickLength,n.push({start:a,end:o}),t++}return n}(y),_=function(e){for(var t=0,n=[];e.horizontalLine.start.x+t*e.horizontalMinorTick<=e.hscaleBounds.bottomRight.x;){var a={x:e.horizontalLine.start.x+t*e.horizontalMinorTick,y:e.horizontalLine.start.y},o={x:e.horizontalLine.start.x+t*e.horizontalMinorTick,y:0};o.y=t%5==0?e.horizontalLine.start.y-e.majorTickLength:e.horizontalLine.start.y-e.minorTickLength,n.push({start:a,end:o}),t++}return n}(y);(0,r.draw)(n,function(e){e.shadowColor=y.shadowColor,e.shadowBlur=y.shadowBlur,(0,r.drawLine)(e,void 0,y.verticalLine.start,y.verticalLine.end,M,"canvas"),(0,r.drawLine)(e,void 0,y.horizontalLine.start,y.horizontalLine.end,M,"canvas"),(0,r.drawLines)(e,void 0,x,M,"canvas"),(0,r.drawLines)(e,void 0,_,M,"canvas")})}}}var d=(0,a.default)(u);d.setConfiguration({color:"white",lineWidth:2,shadowColor:"black",shadowBlur:4}),d.disable=function(e){e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,u),o.default.cornerstone.updateImage(e)},t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=e.querySelector("canvas");if(a.msToBlob){var o=a.msToBlob();return window.navigator.msSaveBlob(o,t)}var r=document.createElement("a");if(r.download=t,r.href=a.toDataURL(n,1),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i)}else r.fireEvent&&r.fireEvent("onclick")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(1)),o=r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.detail;return t.viewport.rotation+=t.rotation,o.default.cornerstone.setViewport(t.element,t.viewport),!1}var l={activate:function(e){e.removeEventListener(a.default.TOUCH_ROTATE,i),e.addEventListener(a.default.TOUCH_ROTATE,i)},disable:function(e){e.removeEventListener(a.default.TOUCH_ROTATE,i)}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rotateTouchDrag=t.rotate=void 0;var a=d(n(1)),o=d(n(0)),r=d(n(18)),i=d(n(58)),l=d(n(5)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s="rotate";function c(e,t,n){var a=e.element.getBoundingClientRect(e.element),r=e.element.clientWidth,i=e.element.clientHeight,l=e.viewport.scale,u=e.viewport.translation,d={x:a.left+r/2+u.x*l,y:a.top+i/2+u.y*l},s=t,c={x:e.currentPoints.client.x,y:e.currentPoints.client.y},f=Math.sqrt(Math.pow(d.x-s.x,2)+Math.pow(d.y-s.y,2)),v=Math.sqrt(Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2)),g=Math.sqrt(Math.pow(s.x-c.x,2)+Math.pow(s.y-c.y,2)),m=180*Math.acos((Math.pow(f,2)+Math.pow(v,2)-Math.pow(g,2))/(2*f*v))/Math.PI;(s.x-d.x)*(c.y-d.y)-(s.y-d.y)*(c.x-d.x)<0&&(m=-m),e.viewport.rotation=n+m,o.default.cornerstone.setViewport(e.element,e.viewport)}function f(e,t,n){var a=n.detail;v.strategy(a,e,t),o.default.cornerstone.setViewport(a.element,a.viewport),n.preventDefault(),n.stopPropagation()}var v=(0,r.default)(function(e){var t=e.detail,n=t.element,o=(0,u.getToolOptions)(s,n),r={x:t.currentPoints.client.x,y:t.currentPoints.client.y},i=t.viewport.rotation;if((0,l.default)(t.which,o.mouseButtonMask)){var d=f.bind({},r,i),c=function e(t){var n=t.detail.element;n.removeEventListener(a.default.MOUSE_DRAG,d),n.removeEventListener(a.default.MOUSE_UP,e),n.removeEventListener(a.default.MOUSE_CLICK,e)};n.addEventListener(a.default.MOUSE_DRAG,d),n.addEventListener(a.default.MOUSE_UP,c),n.addEventListener(a.default.MOUSE_CLICK,c),e.preventDefault(),e.stopPropagation()}},s);v.strategies={default:c,horizontal:function(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,o.default.cornerstone.setViewport(e.element,e.viewport)},vertical:function(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,o.default.cornerstone.setViewport(e.element,e.viewport)}},v.strategy=c;var g=(0,i.default)(function(e){var t=e.detail,n=t.element,o={x:t.currentPoints.client.x,y:t.currentPoints.client.y},r=t.viewport.rotation,i=f.bind({},o,r);n.addEventListener(a.default.TOUCH_DRAG,i),n.addEventListener(a.default.TOUCH_END,function e(t){var n=t.detail.element;n.removeEventListener(a.default.TOUCH_DRAG,i),n.removeEventListener(a.default.TOUCH_END,e)}),e.preventDefault(),e.stopPropagation()},s);t.rotate=v,t.rotateTouchDrag=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rectangleRoiTouch=t.rectangleRoi=void 0;var a=m(n(0)),o=m(n(10)),r=m(n(11)),i=m(n(13)),l=m(n(7)),u=m(n(9)),d=m(n(21)),s=m(n(14)),c=n(2),f=m(n(17)),v=n(3),g=m(n(19));function m(e){return e&&e.__esModule?e:{default:e}}var h="rectangleRoi";function p(e){return{visible:!0,active:!0,invalidated:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function E(e,t,n){if(!1===t.visible)return!1;var o=a.default.cornerstone,r=o.pixelToCanvas(e,t.handles.start),i=o.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,i.x),top:Math.min(r.y,i.y),width:Math.abs(r.x-i.x),height:Math.abs(r.y-i.y)};return a.default.cornerstoneMath.rect.distanceToPoint(l,n)<5}function T(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function y(e){var t=e.detail,n=(0,c.getToolState)(e.currentTarget,h);if(n){var o=a.default.cornerstone,r=t.image,d=t.element,s=i.default.getToolWidth(),m=_.getConfiguration(),p=o.metaData.get("generalSeriesModule",r.imageId),E=void 0,y=(0,g.default)(t.image),M=y.rowPixelSpacing,S=y.colPixelSpacing;p&&(E=p.modality);for(var O=(0,v.getNewContext)(t.canvasContext.canvas),b=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,v.draw)(O,function(e){(0,v.setShadow)(e,m);var n=l.default.getColorIfActive(a);if((0,v.drawRect)(e,d,a.handles.start,a.handles.end,{color:n}),m&&m.drawHandlesOnHover)if(!0===a.active)(0,u.default)(e,t,a.handles,n);else{(0,u.default)(e,t,a.handles,n,{drawHandlesIfActive:!0})}else(0,u.default)(e,t,a.handles,n);x(a,d,r,E,M,S);var o=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=[];if(t&&t.mean){var r="";"CT"===E&&(r=" HU");var i="Mean: "+T(t.mean.toFixed(2))+r,l="StdDev: "+T(t.stdDev.toFixed(2))+r;if(n&&void 0!==n.mean){i+=" SUV: "+T(n.mean.toFixed(2)),l+=" SUV: "+T(n.stdDev.toFixed(2))}o.push(i),o.push(l)}if(a){var u=" mm"+String.fromCharCode(178);M&&S||(u=" pixels"+String.fromCharCode(178));var d="Area: "+T(a.toFixed(2))+u;o.push(d)}return o}(a);a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2),(0,f.default)(e,d,a.handles.textBox,o,a.handles,P,n,s,0,!0)})},C=0;C<n.data.length;C++)b(C)}function P(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),o=Math.abs(e.start.y-e.end.y);return[{x:t+a/2,y:n},{x:t,y:n+o/2},{x:t+a/2,y:n+o},{x:t+a,y:n+o/2}]}}function M(e,t){var n=a.default.cornerstone.getImage(e),o=a.default.cornerstone.metaData.get("generalSeriesModule",n.imageId),r=void 0,i=(0,g.default)(n),l=i.rowPixelSpacing,u=i.colPixelSpacing;o&&(r=o.modality),x(t,e,n,r,l,u),(0,s.default)(e,t,h)}function x(e,t,n,o,r,i){var l=a.default.cornerstone,u=void 0,s=void 0,c=void 0;if(!1===e.invalidated)s=e.meanStdDev,c=e.meanStdDevSUV,u=e.area;else{var f={left:Math.min(e.handles.start.x,e.handles.end.x),top:Math.min(e.handles.start.y,e.handles.end.y),width:Math.abs(e.handles.start.x-e.handles.end.x),height:Math.abs(e.handles.start.y-e.handles.end.y)};if(!n.color)s=function(e,t){for(var n=0,a=0,o=0,r=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++)n+=e[r],a+=e[r]*e[r],o++,r++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0};var u=n/o,d=a/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d)}}(l.getPixels(t,f.left,f.top,f.width,f.height),f),"PT"===o&&(c={mean:(0,d.default)(n,(s.mean-n.intercept)/n.slope),stdDev:(0,d.default)(n,(s.stdDev-n.intercept)/n.slope)}),s&&!isNaN(s.mean)&&(e.meanStdDev=s,e.meanStdDevSUV=c);u=f.width*(i||1)*(f.height*(r||1)),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),r&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}var _=(0,o.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:M}),S=(0,r.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:M});t.rectangleRoi=_,t.rectangleRoiTouch=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.probeTouch=t.probe=void 0;var a=m(n(14)),o=m(n(0)),r=m(n(10)),i=m(n(11)),l=m(n(7)),u=m(n(22)),d=m(n(9)),s=m(n(12)),c=m(n(45)),f=m(n(21)),v=n(2),g=n(3);function m(e){return e&&e.__esModule?e:{default:e}}var h="probe";function p(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function E(e,t,n){if(!1===t.visible)return!1;var a=o.default.cornerstone.pixelToCanvas(e,t.handles.end);return o.default.cornerstoneMath.point.distance(a,n)<5}function T(e){var t=e.detail,n=(0,v.getToolState)(e.currentTarget,h);if(n)for(var a=o.default.cornerstone,r=(0,g.getNewContext)(t.canvasContext.canvas),i=u.default.getFontSize(),c=x.getConfiguration(),f=function(e){var o=n.data[e];if(!1===o.visible)return"continue";(0,g.draw)(r,function(e){var n=l.default.getColorIfActive(o);if((0,d.default)(e,t,o.handles,n),(!c||!c.disableTextBox)&&(M(o,t.element,t.image),o.str&&o.text)){var r={x:o.handles.end.x+3,y:o.handles.end.y-3},u=a.pixelToCanvas(t.element,r);(0,s.default)(e,o.str,u.x,u.y+i+5,n),(0,s.default)(e,o.text,u.x,u.y,n)}})},m=0;m<n.data.length;m++)f(m)}function y(e,t){M(t,e,o.default.cornerstone.getImage(e)),(0,a.default)(e,t,h)}function M(e,t,n){var a=Math.round(e.handles.end.x),r=Math.round(e.handles.end.y),i=void 0;if(a>=0&&r>=0&&a<n.columns&&r<n.rows)if(n.color)e.text=a+", "+r,i=(0,c.default)(t,a,r,1,1),e.str="R: "+i[0]+" G: "+i[1]+" B: "+i[2];else{var l=(i=o.default.cornerstone.getStoredPixels(t,a,r,1,1))[0],u=l*n.slope+n.intercept,d=(0,f.default)(n,l);e.text=a+", "+r,e.str="SP: "+l+" MO: "+parseFloat(u.toFixed(3)),d&&(e.str+=" SUV: "+parseFloat(d.toFixed(3)))}}var x=(0,r.default)({createNewMeasurement:p,onImageRendered:T,pointNearTool:E,toolType:h,onHandleDoneMove:y}),_=(0,i.default)({createNewMeasurement:p,onImageRendered:T,pointNearTool:E,toolType:h,onHandleDoneMove:y});t.probe=x,t.probeTouch=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}var r=(0,o(n(41)).default)(function(e){var t=e.detail,n=r.getConfiguration();n&&n.testPointers(t)&&(t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,a.default.cornerstone.setViewport(t.element,t.viewport),e.preventDefault(),e.stopPropagation())});r.setConfiguration({testPointers:function(e){return e.numPointers>=2}}),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.panTouchDrag=t.pan=void 0;var a=d(n(1)),o=d(n(0)),r=d(n(18)),i=d(n(20)),l=d(n(5)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s="pan";function c(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,f),t.removeEventListener(a.default.MOUSE_UP,c),t.removeEventListener(a.default.MOUSE_CLICK,c)}function f(e){var t=e.detail,n=t.viewport.scale,a=t.viewport.scale,r=t.image.columnPixelSpacing||1,i=t.image.rowPixelSpacing||1;i<r?n*=r/i:r<i&&(a*=i/r),t.viewport.translation.x+=t.deltaPoints.page.x/n,t.viewport.translation.y+=t.deltaPoints.page.y/a,o.default.cornerstone.setViewport(t.element,t.viewport),e.preventDefault(),e.stopPropagation()}var v=(0,r.default)(function(e){var t=e.detail,n=t.element,o=(0,u.getToolOptions)(s,n);(0,l.default)(t.which,o.mouseButtonMask)&&(n.addEventListener(a.default.MOUSE_DRAG,f),n.addEventListener(a.default.MOUSE_UP,c),n.addEventListener(a.default.MOUSE_CLICK,c),e.preventDefault(),e.stopPropagation())},s),g=(0,i.default)(f,s);t.pan=v,t.panTouchDrag=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(0)),o=s(n(68)),r=s(n(27)),i=s(n(7)),l=n(12),u=s(l),d=n(3);function s(e){return e&&e.__esModule?e:{default:e}}var c=(0,r.default)(function(e){var t=e.detail,n=t.element,r=function(e){var t=a.default.cornerstone,n=t.getEnabledElement(e),r=t.metaData.get("imagePlaneModule",n.image.imageId);if(r&&r.rowCosines&&r.columnCosines){var i=o.default.getOrientationString(r.rowCosines),l=o.default.getOrientationString(r.columnCosines),u=o.default.invertOrientationString(i);return{top:o.default.invertOrientationString(l),bottom:l,left:u,right:i}}}(n);if(r){var s=function(e){var t=a.default.cornerstone,n=t.getEnabledElement(e),o=void 0;o={x:n.image.width/2,y:5};var r=t.pixelToCanvas(e,o);o={x:n.image.width/2,y:n.image.height-5};var i=t.pixelToCanvas(e,o);o={x:5,y:n.image.height/2};var l=t.pixelToCanvas(e,o);return o={x:n.image.width-10,y:n.image.height/2},{top:r,bottom:i,left:l,right:t.pixelToCanvas(e,o)}}(n),f=(0,d.getNewContext)(t.canvasContext.canvas),v=i.default.getToolColor(),g=(0,l.textBoxWidth)(f,r.top,0),m=(0,l.textBoxWidth)(f,r.left,0),h=(0,l.textBoxWidth)(f,r.right,0),p=(0,l.textBoxWidth)(f,r.bottom,0);(0,u.default)(f,r.top,s.top.x-g/2,s.top.y,v),(0,u.default)(f,r.left,s.left.x-m/2,s.left.y,v);var E=c.getConfiguration();E&&E.drawAllMarkers&&((0,u.default)(f,r.right,s.right.x-h/2,s.right.y,v),(0,u.default)(f,r.bottom,s.bottom.x-p/2,s.bottom.y,v))}});t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.magnifyTouchDrag=t.magnify=void 0;var a=s(n(1)),o=s(n(0)),r=n(37),i=s(n(5)),l=n(4),u=n(8),d=n(3);function s(e){return e&&e.__esModule?e:{default:e}}var c="magnify",f={magnifySize:300,magnificationLevel:5},v=void 0,g=void 0,m=void 0,h=void 0;function p(e){var t=e.detail,n=t.element;n.removeEventListener(a.default.MOUSE_DRAG,x),n.removeEventListener(a.default.MOUSE_UP,p),n.removeEventListener(a.default.MOUSE_CLICK,p),E(t)}function E(e){e.element.querySelector(".magnifyTool").style.display="none",document.body.style.cursor="default",O()}function T(e){var t=e.detail,n=t.element,r=(0,l.getToolOptions)(c,n);(e.isTouchEvent||(0,i.default)(t.which,r.mouseButtonMask))&&(n.addEventListener(a.default.MOUSE_DRAG,x),n.addEventListener(a.default.TOUCH_DRAG,x),n.addEventListener(a.default.MOUSE_UP,p),n.addEventListener(a.default.TOUCH_END,p),n.addEventListener(a.default.MOUSE_CLICK,p),n.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,y),function(e){O();var t=e.enabledElement;void 0===t&&(t=o.default.cornerstone.getEnabledElement(e.element));var n=C.getConfiguration().magnificationLevel,a=t.canvas,r=t.image;(h=document.createElement("div")).width=a.width*n,h.height=a.height*n,o.default.cornerstone.enable(h,t.options);var i=o.default.cornerstone.getEnabledElement(h),l=o.default.cornerstone.getViewport(t.element);(m=i.canvas).width=a.width*n,m.height=a.height*n,i.viewport=Object.assign({},l),l.scale*=n,o.default.cornerstone.displayImage(h,r),o.default.cornerstone.setViewport(h,l)}(t),window.requestAnimationFrame(function(){return _(t)}),e.preventDefault(),e.stopPropagation())}function y(e){var t=e.detail;t.currentPoints=g,_(t)}function M(e){var t=e.detail,n=t.element;n.removeEventListener(a.default.TOUCH_DRAG_END,M),n.removeEventListener(a.default.TOUCH_END,M),n.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,y),E(t)}function x(e){var t=e.detail,n=t.element;_(t),!0===t.isTouchEvent&&(n.addEventListener(a.default.TOUCH_DRAG_END,M),n.addEventListener(a.default.TOUCH_END,M)),e.preventDefault(),e.stopPropagation()}function _(e){var t=e.element,n=t.querySelector(".magnifyTool");if(n||S(e.element),void 0!==m){var a=C.getConfiguration(),r=a.magnifySize,i=a.magnificationLevel,l=t.querySelector("canvas:not(.magnifyTool)"),s=(0,d.getNewContext)(n),c=r,f=o.default.cornerstone.pixelToCanvas(e.element,e.currentPoints.image);(0,u.clipToBox)(f,l),s.clearRect(0,0,r,r);var g={left:0,top:0,width:r,height:r};(0,d.fillBox)(s,g,"transparent");var h={x:f.x*i-.5*c,y:f.y*i-.5*c};"Safari"===v&&(h.x=Math.max(h.x,0),h.y=Math.max(h.y,0)),h.x=Math.min(h.x,m.width),h.y=Math.min(h.y,m.height),s.drawImage(m,h.x,h.y,c,c,0,0,c,c),n.style.top=f.y-.5*r+"px",n.style.left=f.x-.5*r+"px",e.isTouchEvent&&(n.style.top=f.y-.5*r-120+"px"),n.style.display="block",document.body.style.cursor="none"}}function S(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool");var n=C.getConfiguration();t.width=n.magnifySize,t.height=n.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}function O(){void 0!==h&&(o.default.cornerstone.disable(h),h=void 0,m=void 0)}function b(e){e.removeEventListener(a.default.MOUSE_DOWN,T),function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}(e)}var C={enable:function(e){var t=C.getConfiguration(t);if(!v){var n=(0,r.getBrowserInfo)().split(" ");v=n[0]}S(e)},activate:function(e,t){(0,l.setToolOptions)(c,e,{mouseButtonMask:t}),e.removeEventListener(a.default.MOUSE_DOWN,T),e.addEventListener(a.default.MOUSE_DOWN,T),S(e)},deactivate:b,disable:b,getConfiguration:function(){return f},setConfiguration:function(e){f=e}};function P(e){e.removeEventListener(a.default.TOUCH_START,T),e.addEventListener(a.default.TOUCH_START,T)}function I(e){e.removeEventListener(a.default.TOUCH_START,T)}var L={activate:P,deactivate:I,enable:P,disable:I};t.magnify=C,t.magnifyTouchDrag=L},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lengthTouch=t.length=void 0;var a=m(n(0)),o=m(n(10)),r=m(n(11)),i=m(n(14)),l=m(n(17)),u=m(n(13)),d=m(n(7)),s=m(n(9)),c=n(2),f=m(n(31)),v=n(3),g=m(n(19));function m(e){return e&&e.__esModule?e:{default:e}}var h="length";function p(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function E(e,t,n){return!1!==t.visible&&(0,f.default)(e,t.handles.start,t.handles.end,n)<25}function T(e,t){var n=a.default.cornerstone.getImage(e),o=(0,g.default)(n);M(t,o.rowPixelSpacing,o.colPixelSpacing),(0,i.default)(e,t,h)}function y(e){var t=e.detail,n=(0,c.getToolState)(e.currentTarget,h);if(n)for(var a=(0,v.getNewContext)(t.canvasContext.canvas),o=t.element,r=u.default.getToolWidth(),i=x.getConfiguration(),f=(0,g.default)(t.image),m=f.rowPixelSpacing,p=f.colPixelSpacing,E=function(e){var u=n.data[e];if(!1===u.visible)return"continue";(0,v.draw)(a,function(e){(0,v.setShadow)(e,i);var n=d.default.getColorIfActive(u);(0,v.drawLine)(e,o,u.handles.start,u.handles.end,{color:n});var a={drawHandlesIfActive:i&&i.drawHandlesOnHover};if((0,s.default)(e,t,u.handles,n,a),M(u,m,p),!u.handles.textBox.hasMoved){var c={x:Math.max(u.handles.start.x,u.handles.end.x)};c.x===u.handles.start.x?c.y=u.handles.start.y:c.y=u.handles.end.y,u.handles.textBox.x=c.x,u.handles.textBox.y=c.y}var f=function(e,t,n){var a=" mm";t&&n||(a=" pixels");return e.unit=a.trim(),""+e.length.toFixed(2)+a}(u,m,p);(0,l.default)(e,o,u.handles.textBox,f,u.handles,y,n,r,10,!0)})},T=0;T<n.data.length;T++)E(T);function y(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}function M(e,t,n){var a=(e.handles.end.x-e.handles.start.x)*(n||1),o=(e.handles.end.y-e.handles.start.y)*(t||1),r=Math.sqrt(a*a+o*o);e.length=r}var x=(0,o.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:T}),_=(0,r.default)({createNewMeasurement:p,onImageRendered:y,pointNearTool:E,toolType:h,onHandleDoneMove:T});t.length=x,t.lengthTouch=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(27)),o=i(n(12)),r=n(3);function i(e){return e&&e.__esModule?e:{default:e}}var l=(0,a.default)(function(e){var t=e.detail,n=t.image.stats,a=(0,r.getNewContext)(t.canvasContext.canvas),i=[];Object.keys(n).forEach(function(e){var t=e+" : "+n[e];i.push(t)}),(0,o.default)(a,i,0,0,"orange"),i.forEach(function(e){console.log(e)})});t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.highlightTouch=t.highlight=void 0;var a=c(n(14)),o=c(n(0)),r=c(n(53)),i=c(n(11)),l=c(n(7)),u=c(n(9)),d=n(2),s=n(3);function c(e){return e&&e.__esModule?e:{default:e}}var f="highlight";function v(e){var t=(0,d.getToolState)(e.event.currentTarget,f);if(!(t&&t.data&&t.data.length>0))return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function g(e,t,n){var a=o.default.cornerstone,r=a.pixelToCanvas(e,t.handles.start),i=a.pixelToCanvas(e,t.handles.end),l=Math.min(r.x,i.x),u=Math.min(r.y,i.y),d=Math.abs(r.x-i.x),s=Math.abs(r.y-i.y),c=!1;return n.x>=l&&n.x<=l+d&&n.y>=u&&n.y<=u+s&&(c=!0),c}function m(e,t,n){if(!1===t.visible)return!1;var a=o.default.cornerstone,r=a.pixelToCanvas(e,t.handles.start),i=a.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,i.x),top:Math.min(r.y,i.y),width:Math.abs(r.x-i.x),height:Math.abs(r.y-i.y)};return o.default.cornerstoneMath.rect.distanceToPoint(l,n)<5}function h(e){var t=e.detail,n=(0,d.getToolState)(e.currentTarget,f);if(void 0!==n){var a=(0,s.getNewContext)(t.canvasContext.canvas),o=n.data[0];!1!==o.visible&&o&&(0,s.draw)(a,function(e){var n={color:"transparent",fillStyle:"rgba(0,0,0,0.7)"};(0,s.fillOutsideRect)(e,t.element,o.handles.start,o.handles.end,n);var a=l.default.getColorIfActive(o);n={color:a,lineDash:[4]},(0,s.drawRect)(e,t.element,o.handles.start,o.handles.end,n),(0,u.default)(e,t,o.handles,a)})}}function p(e,t){(0,a.default)(e,t,f)}var E=(0,r.default)({createNewMeasurement:v,onImageRendered:h,pointNearTool:m,pointInsideRect:g,toolType:f,onHandleDoneMove:p},!0),T=(0,i.default)({createNewMeasurement:v,onImageRendered:h,pointNearTool:m,pointInsideRect:g,toolType:f,onHandleDoneMove:p},!0);t.highlight=E,t.highlightTouch=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sculpter=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),r=n(54),i=n(40),l=n(8);t.Sculpter=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,[{key:"sculpt",value:function(e,t){this._setData(e,t),this._pushHandles(),this._insertNewHandles(),this._consolidateHandles()}},{key:"_setData",value:function(e,t){var n=r.freehandSculpter.getConfiguration();this._eventData=e,this._element=e.element,this._image=e.image,this._mousePoint=e.currentPoints.image,this._dataHandles=t,this._toolSize=n.toolSizeImage,this._minSpacing=n.minSpacing,this._maxSpacing=n.maxSpacing}},{key:"_pushHandles",value:function(){for(var e=this._dataHandles,t=this._mousePoint,n=this._toolSize,a=0;a<e.length;a++){var r=o.default.cornerstoneMath.point.distance(e[a],t);r<n&&this._pushOneHandle(a,r)}}},{key:"_pushOneHandle",value:function(t,n){var a=this._dataHandles,o=a[t],r=this._mousePoint,i=this._toolSize,u=(o.x-r.x)/n,d=(o.y-r.y)/n,s={x:r.x+i*u,y:r.y+i*d};(0,l.clipToBox)(s,this._image),o.x=s.x,o.y=s.y;var c=e.getPreviousHandleIndex(t,a.length);a[c].lines.pop(),a[c].lines.push(o)}},{key:"_insertNewHandles",value:function(){for(var e=this._findNewHandleIndicies(),t=0,n=0;n<e.length;n++){var a=e[n]+1+t;this._insertHandleRadially(a),t++}}},{key:"_findNewHandleIndicies",value:function(){for(var t=this._dataHandles,n=[],a=0;a<t.length;a++){var r=o.default.cornerstone.pixelToCanvas(this._element,t[a]),i=e.getNextHandleIndex(a,t.length),l=o.default.cornerstone.pixelToCanvas(this._element,t[i]);o.default.cornerstoneMath.point.distance(r,l)>this._maxSpacing&&n.push(a)}return n}},{key:"_insertHandleRadially",value:function(t){var n=this._dataHandles,a=t-1,o=e.getNextHandleIndexBeforeInsert(t,n.length),r=this._getInsertPosition(t,a,o),l=new i.FreehandHandleData(r);n.splice(t,0,l),n[a].lines.pop(),n[a].lines.push(n[t]),t===n.length-1?n[t].lines.push(n[0]):n[t].lines.push(n[t+1])}},{key:"_getInsertPosition",value:function(e,t,n){var a=this._toolSize,r=this._mousePoint,i=this._dataHandles,u={x:(i[t].x+i[n].x)/2,y:(i[t].y+i[n].y)/2},d=o.default.cornerstoneMath.point.distance(r,u),s=void 0;if(d<a){var c={x:(u.x-r.x)/d,y:(u.y-r.y)/d};s={x:r.x+a*c.x,y:r.y+a*c.y}}else s=u;return(0,l.clipToBox)(s,this._image),s}},{key:"_consolidateHandles",value:function(){if(this._dataHandles.length>3){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_mergeCloseHandles",value:function(t){for(var n=0,a=0;a<t.length;a++){var o=e.getCorrectedPair(t[a],n);this._combineHandles(o),n++}var r=this._findCloseHandlePairs();r.length&&this._mergeCloseHandles(r)}},{key:"_findCloseHandlePairs",value:function(){for(var t=this._dataHandles,n=this._element,a=[],r=t.length,i=0;i<r;i++){var l=o.default.cornerstone.pixelToCanvas(n,t[i]),u=e.getNextHandleIndex(i,t.length),d=o.default.cornerstone.pixelToCanvas(n,t[u]);if(o.default.cornerstoneMath.point.distance(l,d)<this._minSpacing){var s=[i,u];a.push(s),0===i&&(r-=1),i++}}return a}},{key:"_combineHandles",value:function(t){var n=this._dataHandles,a={x:(n[t[0]].x+n[t[1]].x)/2,y:(n[t[0]].y+n[t[1]].y)/2};(0,l.clipToBox)(a,this._image),n[t[0]].x=a.x,n[t[0]].y=a.y;var o=e.getNextHandleIndex(t[1],n.length);n[t[0]].lines.pop(),n[t[0]].lines.push(n[o]),n.splice(t[1],1)}}],[{key:"getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}},{key:"getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=0,a=t.x,o=t.y,r=0,i=e.length-1;r<e.length;i=r,r+=1)if(!(e[r].x>a&&e[i].x>a)){var l=(e[r].x+(o-e[r].y))/((e[i].y-e[r].y)*(e[i].x-e[r].x))<a;e[r].y<o&&e[i].y>=o?n^=l:e[i].y<o&&e[r].y>=o&&(n^=l)}return n}},function(e,t,n){"use strict";function a(e,t,n){return!(!function(e,t,n){return t<e&&e<n||n<e&&e<t}(e.y,t.y,n.y)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var a=t;t=n,n=a}var o=function(e,t,n){var a=(n.y-t.y)/(n.x-t.x);return{value:t.x+a*(e.x-t.x),gradient:a}}(e,t,n);return Math.sign(o.gradient)*e.y>o.value}(e,t,n))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=!1,o=e.length-1,r=0;r<e.length;r++)a(t,e[r],e[o])&&(n=!n),o=r;return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a={count:0,mean:0,variance:0,stdDev:0},r=function(e,t,n){for(var a={value:0,squared:0,count:0},r=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++){var u={x:l,y:i};o(n,u,a,e[r]),r++}return a}(e,t,n);return 0===r.count?a:(a.count=r.count,a.mean=r.value/r.count,a.variance=r.squared/r.count-a.mean*a.mean,a.stdDev=Math.sqrt(a.variance),a)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(98));function o(e,t,n,o){(0,a.default)(e,t)&&(n.value+=o,n.squared+=o*o,n.count++)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=0,a=e.length-1;t=t||1;for(var o=0;o<e.length;o++)n+=(e[a].x+e[o].x)*(e[a].y-e[o].y),a=o;return Math.abs(n*t/2)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ClickedLineData=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.toolIndex=t,this.handleIndexArray=n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){!function(e,t){var n=(0,r.getToolState)(e.element,l);if(void 0===n)return;var a=t.handleIndex,o=t.toolIndex,u=n.data[o];if(u.handles.length<=3)return;a===u.handles.length-1?(u.handles[a-1].lines.pop(),u.handles[a-1].lines.push(u.handles[0])):0===a?(u.handles[u.handles.length-1].lines.pop(),u.handles[u.handles.length-1].lines.push(u.handles[a+1])):(u.handles[a-1].lines.pop(),u.handles[a-1].lines.push(u.handles[a+1]));u.handles.splice(a,1),u.invalidated=!0,u.active=!0,u.highlight=!0,i.default.cornerstone.updateImage(e.element)}(n,{toolIndex:t.toolIndex,handleIndex:t.handleNearby})}else{var u=new a.FreehandLineFinder(n).findLine();u&&function(e,t){var n=(0,r.getToolState)(e.element,l);if(void 0===n)return;var a=n.data[t.toolIndex],u=function(e){for(var t=e.handleIndexArray,n=1/0,a=t.includes(0),o=0;o<t.length;o++){var r=t[o];0!==r&&r<n&&(n=r)}a&&1===n&&(n=0);return++n}(t);if(u===1/0)return;var d=new o.FreehandHandleData(e.currentPoints.image);a.handles.splice(u,0,d),a.handles[u-1].lines.pop(),a.handles[u-1].lines.push(e.currentPoints.image),u===a.handles.length-1?a.handles[u].lines.push(a.handles[0]):a.handles[u].lines.push(a.handles[u+1]);a.active=!0,a.highlight=!0,a.invalidated=!0,i.default.cornerstone.updateImage(e.element)}(n,u)}e.preventDefault(),e.stopPropagation()};var a=n(55),o=n(40),r=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0));var l="freehand"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.detail;var n=a.freehand.getConfiguration();return!0===n.movingTextBox?(function(e,t){var n=a.freehand.getConfiguration();n.movingTextBox=!1,t.data[n.currentTool].invalidated=!0,n.currentHandle=0,n.currentTool=-1}(0,t),"textBox"):n.modifying?(function(e,t){var n=a.freehand.getConfiguration(),o=n.currentTool,r=t.data[o].handles;if(r.invalidHandlePlacement){var i=n.currentHandle,l=r[i],u=void 0;if(0===i){var d=r.length-1;u=r[d]}else u=r[i-1];l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,u.lines[0]=l,r.invalidHandlePlacement=!1}}(0,t),"handle"):null};var a=n(26)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=a.freehand.getConfiguration();n.movingTextBox&&function(e){var t=a.freehand.getConfiguration();e.hasMoved=!0,e.x=t.mouseLocation.handles.start.x,e.y=t.mouseLocation.handles.start.y}(e),n.modifying&&function(e,t){var n=a.freehand.getConfiguration(),r=-1;t.handles.invalidHandlePlacement=o.default.modify(t.handles,e),t.active=!0,t.highlight=!0,t.handles[e].x=n.mouseLocation.handles.start.x,t.handles[e].y=n.mouseLocation.handles.start.y,r=0===e?t.handles.length-1:e-1;if(e>=0){var i=t.handles[r].lines.length-1,l=t.handles[r].lines[i];l.x=n.mouseLocation.handles.start.x,l.y=n.mouseLocation.handles.start.y}}(e,t)};var a=n(26),o=function(e){return e&&e.__esModule?e:{default:e}}(n(56))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eraserTouch=t.eraser=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(71)),r=s(n(0)),i=s(n(1)),l=n(4),u=s(n(58)),d=s(n(5));function s(e){return e&&e.__esModule?e:{default:e}}var c="eraser",f={supportedTools:{}};function v(e){var t=e.detail.currentPoints.canvas,n=e.detail.element,i=(0,l.getToolOptions)(c,n).mouseButtonMask,u=e.detail.which,s=!1,v=!1;(0,d.default)(u,i)&&(Object.entries(f.supportedTools).forEach(function(e){var r=a(e,2),i=r[0],l=r[1],u=o.getToolState(n,i);u&&u.data.forEach(function(e){!s&&l.pointNearTool(n,e,t)&&(o.removeToolState(n,i,e),s=!0,v=!0)})}),v&&r.default.cornerstone.updateImage(n))}function g(e){var t=e.detail.currentPoints.canvas,n=e.detail.element,i=!1,l=!1;Object.entries(f.supportedTools).forEach(function(e){var r=a(e,2),u=r[0],d=r[1],s=o.getToolState(n,u);s&&s.data.forEach(function(e){e.active&&(e.active=!1,i=!0),!l&&d.pointNearTool(n,e,t)&&(e.active=!0,i=!0,l=!0)})}),i&&r.default.cornerstone.updateImage(n)}var m={activate:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.mouseButtonMask=t,(0,l.setToolOptions)(c,e,n),e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,g),e.addEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.addEventListener(i.default.MOUSE_MOVE,g),f.supportedTools={},Object.keys(o).forEach(function(e){var t=o[e];"function"==typeof t.pointNearTool&&(f.supportedTools[e]=t)})},disable:function(e){e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,g)},enable:function(e){e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,g)},deactivate:function(e){e.removeEventListener(i.default.MOUSE_DOWN_ACTIVATE,v),e.removeEventListener(i.default.MOUSE_MOVE,g)},getConfiguration:function(){return f},setConfiguration:function(e){f=e}},h=(0,u.default)(v,c);t.eraser=m,t.eraserTouch=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,d,s){var c=o.default.cornerstone,f=e.element,v={x:l.x-e.currentPoints.image.x,y:l.y-e.currentPoints.image.y},g=e.image.columns;function m(e){var d=e.detail;!1===l.hasMoved&&(l.hasMoved=!0),l.active=!0;var m=n.handles,h=m.start,p=m.end,E=u(n.handles),T=(p.y-h.y)/(p.x-h.x),y=-1/T,M=E.y-y*E.x,x=d.currentPoints.image.y+v.y-T*(d.currentPoints.image.x+v.x),_=function(e,t,n){return e*t+n};if("perpendicular"===l.key){var S={start:{x:0,y:_(y,0,M)},end:{x:g,y:_(y,g,M)}},O={start:{x:0,y:_(T,0,x)},end:{x:g,y:_(T,g,x)}},b=o.default.cornerstoneMath.lineSegment.intersectLine(S,O),C=function(e){return e*e},P=Math.sqrt(C(b.x-E.x)+C(b.y-E.y));n.shortestDistance=P,l.x=b.x,l.y=b.y}else{l.x=d.currentPoints.image.x+v.x,l.y=d.currentPoints.image.y+v.y,E=u(n.handles);var I=Math.atan(y);n.handles.perpendicularPoint.x=E.x-n.shortestDistance*Math.cos(I),n.handles.perpendicularPoint.y=E.y-n.shortestDistance*Math.sin(I)}s&&(0,i.clipToBox)(l,d.image),c.updateImage(f);var L=a.default.MEASUREMENT_MODIFIED,w={toolType:t,element:f,measurementData:n};(0,r.default)(f,L,w)}function h(){l.active=!1,f.removeEventListener(a.default.MOUSE_DRAG,m),f.removeEventListener(a.default.MOUSE_UP,h),f.removeEventListener(a.default.MOUSE_CLICK,h),c.updateImage(f),"function"==typeof d&&d()}f.addEventListener(a.default.MOUSE_DRAG,m),f.addEventListener(a.default.MOUSE_UP,h),f.addEventListener(a.default.MOUSE_CLICK,h)};var a=l(n(1)),o=l(n(0)),r=l(n(6)),i=n(8);function l(e){return e&&e.__esModule?e:{default:e}}function u(e){var t=e.start,n=e.end,a=Math.abs(t.x-n.x),o=Math.abs(t.y-n.y);return{x:Math.min(t.x,n.x)+a/2,y:Math.min(t.y,n.y)+o/2}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rotatedEllipticalRoiTouch=t.rotatedEllipticalRoi=void 0;var a=C(n(1)),o=C(n(0)),r=C(n(10)),i=C(n(11)),l=C(n(13)),u=C(n(36)),d=C(n(29)),s=C(n(7)),c=C(n(9)),f=C(n(24)),v=C(n(66)),g=C(n(43)),m=C(n(5)),h=C(n(21)),p=C(n(14)),E=C(n(17)),T=C(n(28)),y=C(n(34)),M=C(n(15)),x=C(n(106)),_=n(4),S=n(2),O=n(3),b=C(n(19));function C(e){return e&&e.__esModule?e:{default:e}}var P="rotatedEllipticalRoi";function I(e){return{visible:!0,active:!0,invalidated:!0,color:void 0,shortestDistance:0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,key:"start"},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,key:"end"},perpendicularPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,isFirst:!0,key:"perpendicular"},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function L(e,t,n,a){if(!1===t.visible)return!1;var r=o.default.cornerstone,i=U(t.handles),l=r.pixelToCanvas(e,t.handles.start),u=r.pixelToCanvas(e,t.handles.end),d=r.pixelToCanvas(e,t.handles.perpendicularPoint),s=r.pixelToCanvas(e,i),c=function(e){return e*e},f={xRadius:Math.sqrt(c(l.x-u.x)+c(l.y-u.y))/2-a/2,yRadius:Math.sqrt(c(d.x-s.x)+c(d.y-s.y))-a/2},g={xRadius:Math.sqrt(c(l.x-u.x)+c(l.y-u.y))/2+a/2,yRadius:Math.sqrt(c(d.x-s.x)+c(d.y-s.y))+a/2},m=Math.atan2(u.y-l.y,u.x-l.x);(0,v.default)(f,s,n,m);return!!(0,v.default)(g,s,n,m)}function w(e,t,n){return L(e,t,n,15)}function D(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function U(e){var t=e.start,n=e.end,a=Math.abs(t.x-n.x),o=Math.abs(t.y-n.y);return{x:Math.min(t.x,n.x)+a/2,y:Math.min(t.y,n.y)+o/2}}function A(e){var t=e.detail;u.default.setCoords(t);var n=(0,S.getToolState)(t.element,P);if(n){for(var a=!1,r=0;r<n.data.length;r++){var i=t.currentPoints.canvas,l=n.data[r];!0===(0,d.default)(t.element,l.handles,i)&&(a=!0),(w(t.element,l,i)&&!l.active||!w(t.element,l,i)&&l.active)&&(l.active=!l.active,a=!0)}!0===a&&o.default.cornerstone.updateImage(t.element)}}function R(e){var t=e.detail,n=(0,S.getToolState)(e.currentTarget,P);if(n){var a=o.default.cornerstone,r=t.image,i=t.element,u=l.default.getToolWidth(),d=H.getConfiguration(),f=a.metaData.get("generalSeriesModule",r.imageId),v=void 0,g=(0,b.default)(t.image),m=g.rowPixelSpacing,h=g.colPixelSpacing;f&&(v=f.modality);for(var p=(0,O.getNewContext)(t.canvasContext.canvas),T=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,O.draw)(p,function(e){(0,O.setShadow)(e,d);var n=s.default.getColorIfActive(a);if((0,O.drawRotatedEllipse)(e,i,a.handles.start,a.handles.end,a.handles.perpendicularPoint,{color:n}),d&&d.drawHandlesOnHover)if(!0===a.active)(0,c.default)(e,t,a.handles,n);else{(0,c.default)(e,t,a.handles,n,{drawHandlesIfActive:!0})}else(0,c.default)(e,t,a.handles,n);k(a,i,r,v,m,h),a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2);var o=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=e.extra,r=[];if(t&&void 0!==t.mean){var i="";"CT"===v&&(i=" HU");var l="Mean: "+D(t.mean.toFixed(2))+i,u="StdDev: "+D(t.stdDev.toFixed(2))+i;if(n&&void 0!==n.mean){l+=" SUV: "+D(n.mean.toFixed(2)),u+=" SUV: "+D(n.stdDev.toFixed(2))}r.push(l),r.push(u)}if(a){var d=" mm"+String.fromCharCode(178);m&&h||(d=" pixels"+String.fromCharCode(178));var s="Area: "+D(a.toFixed(2))+d;r.push(s)}o&&r.push(o);return o?[o]:[]}(a);(0,E.default)(e,i,a.handles.textBox,o,a.handles,M,n,u,0,!0)})},y=0;y<n.data.length;y++)T(y)}function M(e){Math.min(e.start.x,e.end.x),Math.min(e.start.y,e.end.y),Math.abs(e.start.x-e.end.x),Math.abs(e.start.y-e.end.y);return[{x:e.start.x,y:e.start.y},{x:e.end.x,y:e.end.y},{x:e.perpendicularPoint.x,y:e.perpendicularPoint.y}]}}function k(e,t,n,a,r,i){var l=o.default.cornerstone,u=void 0,d=void 0,s=void 0;if(!1===e.invalidated)d=e.meanStdDev,s=e.meanStdDevSUV,u=e.area;else{var c={left:Math.round(Math.min(e.handles.start.x,e.handles.end.x)),top:Math.round(Math.min(e.handles.start.y,e.handles.end.y)),width:Math.round(Math.abs(e.handles.start.x-e.handles.end.x)),height:Math.round(Math.abs(e.handles.start.y-e.handles.end.y))};if(!n.color){var f=l.getPixels(t,c.left,c.top,c.width,c.height);d=(0,g.default)(f,c),"PT"===a&&(s={mean:(0,h.default)(n,(d.mean-n.intercept)/n.slope),stdDev:(0,h.default)(n,(d.stdDev-n.intercept)/n.slope)}),d&&!isNaN(d.mean)&&(e.meanStdDev=d,e.meanStdDevSUV=s)}u=Math.PI*(c.width*(i||1)/2)*(c.height*(r||1)/2),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),r&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}function N(e,t){var n=o.default.cornerstone.getImage(e),a=o.default.cornerstone.metaData.get("generalSeriesModule",n.imageId),r=void 0,i=(0,b.default)(n),l=i.rowPixelSpacing,u=i.colPixelSpacing;a&&(r=a.modality),k(t,e,n,r,l,u),(0,p.default)(e,t,P)}var H=(0,r.default)({createNewMeasurement:I,onImageRendered:R,pointNearTool:w,toolType:P,onHandleDoneMove:N,addNewMeasurement:function(e){var t=e.element,n=I(e);(0,S.addToolState)(t,P,n),o.default.cornerstone.updateImage(t),(0,T.default)(e,P,n,n.handles.end,function(){if((0,M.default)(e,n.handles))(0,S.removeToolState)(t,P,n);else{var a=U(n.handles);n.handles.perpendicularPoint.x=a.x,n.handles.perpendicularPoint.y=a.y,n.handles.perpendicularPoint.isFirst=!1,N(t,n)}})},mouseDownCallback:function(e){var t=e.detail,n=void 0,r=t.element,i=(0,_.getToolOptions)(P,r);if((0,m.default)(t.which,i.mouseButtonMask)){var l=t.startPoints.canvas,u=(0,S.getToolState)(e.currentTarget,P);if(u){var d=void 0;for(d=0;d<u.data.length;d++){n=u.data[d];var s=(0,f.default)(r,n.handles,l,6);if(s)return r.removeEventListener(a.default.MOUSE_MOVE,A),n.active=!0,(0,x.default)(t,P,n,s,v,!0),e.stopImmediatePropagation(),e.stopPropagation(),void e.preventDefault()}if(w){var c={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(d=0;d<u.data.length;d++)if((n=u.data[d]).active=!1,w(r,n,l))return n.active=!0,r.removeEventListener(a.default.MOUSE_MOVE,A),(0,y.default)(e,n,u,P,c,v),e.stopImmediatePropagation(),e.stopPropagation(),void e.preventDefault()}}}function v(){n.invalidated=!0,(0,M.default)(t,n.handles)?(0,S.removeToolState)(r,P,n):N&&N(r,n),o.default.cornerstone.updateImage(r),r.addEventListener(a.default.MOUSE_MOVE,A)}}}),j=(0,i.default)({createNewMeasurement:I,onImageRendered:R,pointNearTool:function(e,t,n){return L(e,t,n,25)},toolType:P,onHandleDoneMove:N});t.rotatedEllipticalRoi=H,t.rotatedEllipticalRoiTouch=j},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ellipticalRoiTouch=t.ellipticalRoi=void 0;var a=p(n(0)),o=p(n(10)),r=p(n(11)),i=p(n(13)),l=p(n(7)),u=p(n(9)),d=p(n(46)),s=p(n(43)),c=p(n(21)),f=p(n(14)),v=p(n(17)),g=n(2),m=n(3),h=p(n(19));function p(e){return e&&e.__esModule?e:{default:e}}var E="ellipticalRoi";function T(e){return{visible:!0,active:!0,invalidated:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function y(e,t,n,o){if(!1===t.visible)return!1;var r=a.default.cornerstone,i=r.pixelToCanvas(e,t.handles.start),l=r.pixelToCanvas(e,t.handles.end),u={left:Math.min(i.x,l.x)+o/2,top:Math.min(i.y,l.y)+o/2,width:Math.abs(i.x-l.x)-o,height:Math.abs(i.y-l.y)-o},s={left:Math.min(i.x,l.x)-o/2,top:Math.min(i.y,l.y)-o/2,width:Math.abs(i.x-l.x)+o,height:Math.abs(i.y-l.y)+o},c=(0,d.default)(u,n);return!(!(0,d.default)(s,n)||c)}function M(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function x(e){var t=e.detail,n=(0,g.getToolState)(e.currentTarget,E);if(n){var o=a.default.cornerstone,r=t.image,d=t.element,s=i.default.getToolWidth(),c=O.getConfiguration(),f=o.metaData.get("generalSeriesModule",r.imageId),p=void 0,T=(0,h.default)(t.image),y=T.rowPixelSpacing,x=T.colPixelSpacing;f&&(p=f.modality);for(var S=(0,m.getNewContext)(t.canvasContext.canvas),b=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,m.draw)(S,function(e){(0,m.setShadow)(e,c);var n=l.default.getColorIfActive(a);if((0,m.drawEllipse)(e,d,a.handles.start,a.handles.end,{color:n}),c&&c.drawHandlesOnHover)if(!0===a.active)(0,u.default)(e,t,a.handles,n);else{(0,u.default)(e,t,a.handles,n,{drawHandlesIfActive:!0})}else(0,u.default)(e,t,a.handles,n);_(a,d,r,p,y,x),a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2);var o=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=e.extra,r=[];if(t&&void 0!==t.mean){var i="";"CT"===p&&(i=" HU");var l="Mean: "+M(t.mean.toFixed(2))+i,u="StdDev: "+M(t.stdDev.toFixed(2))+i;if(n&&void 0!==n.mean){l+=" SUV: "+M(n.mean.toFixed(2)),u+=" SUV: "+M(n.stdDev.toFixed(2))}r.push(l),r.push(u)}if(a){var d=" mm"+String.fromCharCode(178);y&&x||(d=" pixels"+String.fromCharCode(178));var s="Area: "+M(a.toFixed(2))+d;r.push(s)}o&&r.push(o);return o?[o]:[]}(a);(0,v.default)(e,d,a.handles.textBox,o,a.handles,P,n,s,0,!0)})},C=0;C<n.data.length;C++)b(C)}function P(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),o=Math.abs(e.start.y-e.end.y);return[{x:t+a/2,y:n},{x:t,y:n+o/2},{x:t+a/2,y:n+o},{x:t+a,y:n+o/2}]}}function _(e,t,n,o,r,i){var l=a.default.cornerstone,u=void 0,d=void 0,f=void 0;if(!1===e.invalidated)d=e.meanStdDev,f=e.meanStdDevSUV,u=e.area;else{var v={left:Math.round(Math.min(e.handles.start.x,e.handles.end.x)),top:Math.round(Math.min(e.handles.start.y,e.handles.end.y)),width:Math.round(Math.abs(e.handles.start.x-e.handles.end.x)),height:Math.round(Math.abs(e.handles.start.y-e.handles.end.y))};if(!n.color){var g=l.getPixels(t,v.left,v.top,v.width,v.height);d=(0,s.default)(g,v),"PT"===o&&(f={mean:(0,c.default)(n,(d.mean-n.intercept)/n.slope),stdDev:(0,c.default)(n,(d.stdDev-n.intercept)/n.slope)}),d&&!isNaN(d.mean)&&(e.meanStdDev=d,e.meanStdDevSUV=f)}u=Math.PI*(v.width*(i||1)/2)*(v.height*(r||1)/2),isNaN(u)||(e.area=u,e.unit="mm"+String.fromCharCode(178),r&&i||(e.unit="pixels"+String.fromCharCode(178))),e.invalidated=!1}}function S(e,t){var n=a.default.cornerstone.getImage(e),o=a.default.cornerstone.metaData.get("generalSeriesModule",n.imageId),r=void 0,i=(0,h.default)(n),l=i.rowPixelSpacing,u=i.colPixelSpacing;o&&(r=o.modality),_(t,e,n,r,l,u),(0,f.default)(e,t,E)}var O=(0,o.default)({createNewMeasurement:T,onImageRendered:x,pointNearTool:function(e,t,n){return y(e,t,n,15)},toolType:E,onHandleDoneMove:S}),b=(0,r.default)({createNewMeasurement:T,onImageRendered:x,pointNearTool:function(e,t,n){return y(e,t,n,25)},toolType:E,onHandleDoneMove:S});t.ellipticalRoi=O,t.ellipticalRoiTouch=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dragProbeTouch=t.dragProbe=void 0;var a=h(n(1)),o=h(n(0)),r=h(n(18)),i=h(n(20)),l=h(n(22)),u=h(n(7)),d=n(12),s=h(d),c=h(n(45)),f=h(n(21)),v=h(n(5)),g=n(4),m=n(3);function h(e){return e&&e.__esModule?e:{default:e}}var p="dragProbe",E=void 0;function T(e){var t=o.default.cornerstone,n=t.getEnabledElement(e.element),a=(0,m.getNewContext)(n.canvas),r=u.default.getActiveColor(),i=l.default.getFontSize(),d=_.getConfiguration(),v=Math.round(e.currentPoints.image.x),g=Math.round(e.currentPoints.image.y);v<0||g<0||v>=e.image.columns||g>=e.image.rows||(0,m.draw)(a,function(n){(0,m.setShadow)(n,d);var a=void 0,o=void 0,l=void 0;if(e.image.color)a=(0,c.default)(e.element,v,g,1,1),o=v+", "+g,l="R: "+a[0]+" G: "+a[1]+" B: "+a[2]+" A: "+a[3];else{var u=(a=t.getStoredPixels(e.element,v,g,1,1))[0],h=u*e.image.slope+e.image.intercept,p=(0,f.default)(e.image,u);o=v+", "+g,l="SP: "+u+" MO: "+parseFloat(h.toFixed(3)),p&&(l+=" SUV: "+parseFloat(p.toFixed(3)))}var E={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},T=t.pixelToCanvas(e.element,E);(0,s.default)(n,l,T.x,T.y+i+5,r),(0,s.default)(n,o,T.x,T.y,r)})}function y(e){var t=e.detail,n=t.element;n.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,M),n.removeEventListener(a.default.MOUSE_DRAG,x),n.removeEventListener(a.default.MOUSE_UP,y),n.removeEventListener(a.default.MOUSE_CLICK,y),o.default.cornerstone.updateImage(t.element)}function M(){E&&(_.strategy(E),E=null)}function x(e){var t=e.detail,n=t.element;E=t,o.default.cornerstone.updateImage(n),e.preventDefault(),e.stopPropagation()}var _=(0,r.default)(function(e){var t=e.detail,n=t.element,r=(0,g.getToolOptions)(p,n);(0,v.default)(t.which,r.mouseButtonMask)&&(n.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,M),n.addEventListener(a.default.MOUSE_DRAG,x),n.addEventListener(a.default.MOUSE_UP,y),n.addEventListener(a.default.MOUSE_CLICK,y),_.strategy(t),e.preventDefault(),e.stopPropagation())},p);_.strategies={default:T,minimal:function(e){var t=o.default.cornerstone,n=e.element,a=t.getEnabledElement(n),r=a.image,i=(0,m.getNewContext)(a.canvas),v=u.default.getActiveColor(),g=_.getConfiguration(),h=void 0;(h=!0===e.isTouchEvent?t.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-4*l.default.getFontSize()):t.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-l.default.getFontSize()/2)).x<0||h.y<0||h.x>=r.columns||h.y>=r.rows||(0,m.draw)(i,function(a){(0,m.setShadow)(a,g);var o=t.metaData.get("generalSeriesModule",r.imageId),i=void 0;o&&(i=o.modality);var u=void 0,p="";if(r.color)p="R: "+(u=(0,c.default)(n,h.x,h.y,1,1))[0]+" G: "+u[1]+" B: "+u[2];else{var E=(u=t.getStoredPixels(n,h.x,h.y,1,1))[0],T=E*e.image.slope+e.image.intercept,y=parseFloat(T.toFixed(2));if("CT"===i)p+="HU: "+y;else if("PT"===i){p+=y;var M=(0,f.default)(e.image,E);M&&(p+=" SUV: "+parseFloat(M.toFixed(2)))}else p+=y}var x=t.pixelToCanvas(n,h),_=void 0,S=(0,d.textBoxWidth)(a,p,5);_=!0===e.isTouchEvent?{x:-S/2,y:-l.default.getFontSize()-10-12}:{x:12,y:-(l.default.getFontSize()+10)/2},(0,m.drawCircle)(a,n,x,6,{color:v},"canvas"),(0,s.default)(a,p,x.x+_.x,x.y+_.y,v)})}},_.strategy=T;var S={fireOnTouchStart:!0,touchStartCallback:function(e){e.detail.element.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,M)},touchEndCallback:function(e){var t=e.detail.element;t.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,M),o.default.cornerstone.updateImage(t)}},O=(0,i.default)(x,p,S);t.dragProbe=_,t.dragProbeTouch=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function r(e){a.default.cornerstone.fitToWindow(e.element)}var i=(0,o(n(59)).default)(function(e){var t=e.detail;i.strategy(t),e.preventDefault(),e.stopPropagation()});i.strategies={default:r},i.strategy=r,t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.crosshairsTouch=t.crosshairs=void 0;var a=c(n(1)),o=c(n(0)),r=c(n(16)),i=n(2),l=c(n(5)),u=n(38),d=c(n(23)),s=n(4);function c(e){return e&&e.__esModule?e:{default:e}}var f="crosshairs";function v(e){var t=e.detail;e.stopImmediatePropagation();var n=(0,i.getToolState)(e.currentTarget,f);if(n){var a=o.default.cornerstone,l=e.currentTarget,s=a.getEnabledElement(l).image.imageId,c=a.metaData.get("imagePlaneModule",s);if(c){var v=t.currentPoints.image,g=(0,u.imagePointToPatientPoint)(v,c);n.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==l){var t=Number.MAX_VALUE,n=-1,o=(0,i.getToolState)(e,"stack");if(void 0!==o){var u=o.data[0];if(u.imageIds.forEach(function(e,o){var r=a.metaData.get("imagePlaneModule",e);if(r&&r.imagePositionPatient&&r.rowCosines&&r.columnCosines){var i=(0,d.default)(r.imagePositionPatient),l=(0,d.default)(r.rowCosines),u=(0,d.default)(r.columnCosines).clone().cross(l.clone()),s=Math.abs(u.clone().dot(i)-u.clone().dot(g));s<t&&(t=s,n=o)}}),n!==u.currentImageIdIndex&&-1!==n&&void 0!==u.imageIds[n]){var s=r.default.getStartLoadHandler(),c=r.default.getEndLoadHandler(),f=r.default.getErrorLoadingHandler();s&&s(e);(!0===u.preventCache?a.loadImage(u.imageIds[n]):a.loadAndCacheImage(u.imageIds[n])).then(function(t){var o=a.getViewport(e);u.currentImageIdIndex=n,a.displayImage(e,t,o),c&&c(e,t)},function(t){var a=u.imageIds[n];f&&f(e,a,t)})}}}})}}}function g(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,h),t.removeEventListener(a.default.MOUSE_UP,g)}function m(e){var t=e.detail,n=t.element,o=(0,s.getToolOptions)(f,n);(0,l.default)(t.which,o.mouseButtonMask)&&(n.addEventListener(a.default.MOUSE_DRAG,h),n.addEventListener(a.default.MOUSE_UP,g),v(e),e.preventDefault(),e.stopPropagation())}function h(e){v(e),e.preventDefault(),e.stopPropagation()}function p(e,t,n){(0,s.setToolOptions)(f,e,{mouseButtonMask:t}),(0,i.clearToolState)(e,f),(0,i.addToolState)(e,f,{synchronizationContext:n}),e.removeEventListener(a.default.MOUSE_DOWN,m),e.addEventListener(a.default.MOUSE_DOWN,m)}function E(e){e.removeEventListener(a.default.MOUSE_DOWN,m)}var T={activate:p,deactivate:E,enable:p,disable:E};function y(e){var t=e.detail.element;t.removeEventListener(a.default.TOUCH_DRAG,x),t.removeEventListener(a.default.TOUCH_DRAG_END,y)}function M(e){var t=e.detail.element;return t.addEventListener(a.default.TOUCH_DRAG,x),t.addEventListener(a.default.TOUCH_DRAG_END,y),v(e),!1}function x(e){v(e),e.preventDefault(),e.stopPropagation()}function _(e,t){(0,i.clearToolState)(e,f),(0,i.addToolState)(e,f,{synchronizationContext:t}),e.removeEventListener(a.default.TOUCH_START,M),e.addEventListener(a.default.TOUCH_START,M)}function S(e){e.removeEventListener(a.default.TOUCH_START,M)}var O={activate:_,deactivate:S,enable:_,disable:S};t.crosshairs=T,t.crosshairsTouch=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,i,l){var u=e.length>0?a.default.cornerstoneMath.point.findClosestPoint(e,t):t,d=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}],s=a.default.cornerstoneMath.point.findClosestPoint(d,u),c={color:i,lineWidth:l,lineDash:[2,3]};(0,o.drawLine)(r,void 0,u,s,c,"canvas")};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrowAnnotateTouch=t.arrowAnnotate=void 0;var a=O(n(1)),o=O(n(0)),r=O(n(10)),i=O(n(11)),l=O(n(13)),u=O(n(22)),d=O(n(7)),s=O(n(9)),c=O(n(64)),f=O(n(28)),v=O(n(32)),g=O(n(15)),m=O(n(5)),h=O(n(25)),p=O(n(17)),E=n(2),T=n(4),y=O(n(31)),M=n(3),x=n(12),_=O(n(6)),S=O(n(14));function O(e){return e&&e.__esModule?e:{default:e}}var b="arrowAnnotate";var C={getTextCallback:function(e){e(prompt("Enter your annotation:"))},changeTextCallback:function(e,t,n){n(prompt("Change your annotation:"))},drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};function P(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function I(e,t,n){return!1!==t.visible&&(0,y.default)(e,t.handles.start,t.handles.end,n)<25}function L(e){var t=e.detail,n=(0,E.getToolState)(e.currentTarget,b);if(n)for(var a=t.enabledElement,r=o.default.cornerstone,i=(0,M.getNewContext)(t.canvasContext.canvas),f=l.default.getToolWidth(),v=D.getConfiguration(),g=function(e){var o=n.data[e];if(!1===o.visible)return"continue";(0,M.draw)(i,function(e){(0,M.setShadow)(e,v);var n=d.default.getColorIfActive(o),i=r.pixelToCanvas(t.element,o.handles.start),l=r.pixelToCanvas(t.element,o.handles.end);v.arrowFirst?(0,c.default)(e,l,i,n,f):(0,c.default)(e,i,l,n,f);var g={drawHandlesIfActive:v&&v.drawHandlesOnHover};v.drawHandles&&(0,s.default)(e,t,o.handles,n,g);var m=function(e){return e.text}(o);if(m&&""!==m){var E=(0,x.textBoxWidth)(e,m,5),T=u.default.getFontSize()+10,y=Math.max(E,T)/2+5;if(l.x<i.x&&(y=-y),!o.handles.textBox.hasMoved){var _=void 0;_=v.arrowFirst?{x:l.x-E/2+y,y:l.y-T/2}:{x:i.x-E/2-y,y:i.y-T/2};var S=r.internal.getTransform(a);S.invert();var O=S.transformPoint(_.x,_.y);o.handles.textBox.x=O.x,o.handles.textBox.y=O.y}(0,p.default)(e,t.element,o.handles.textBox,m,o.handles,h,n,f,0,!1)}})},m=0;m<n.data.length;m++)g(m);function h(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}function w(e,t){(0,S.default)(e,t,b)}var D=(0,r.default)({addNewMeasurement:function(e){var t=e.element,n=P(e),r=o.default.cornerstone;function i(e){null===e?(0,E.removeToolState)(t,b,n):n.text=e,n.active=!1,r.updateImage(t);var o=a.default.MEASUREMENT_MODIFIED,i={toolType:b,element:t,measurementData:n};(0,_.default)(t,o,i),t.addEventListener(a.default.MOUSE_MOVE,D.mouseMoveCallback),t.addEventListener(a.default.MOUSE_DOWN,D.mouseDownCallback),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,D.mouseDownActivateCallback),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,D.mouseDoubleClickCallback)}(0,E.addToolState)(t,b,n),t.removeEventListener(a.default.MOUSE_MOVE,D.mouseMoveCallback),t.removeEventListener(a.default.MOUSE_DOWN,D.mouseDownCallback),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,D.mouseDownActivateCallback),t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,D.mouseDoubleClickCallback),r.updateImage(t),(0,f.default)(e,b,n,n.handles.end,function(){if((0,g.default)(e,n.handles))(0,E.removeToolState)(t,b,n);else{var a=D.getConfiguration();void 0===n.text&&a.getTextCallback(i),w(t,n)}r.updateImage(t)})},createNewMeasurement:P,onImageRendered:L,pointNearTool:I,toolType:b,mouseDoubleClickCallback:function(e){var t=e.detail,n=t.element,a=o.default.cornerstone,r=(0,T.getToolOptions)(b,n),i=void 0;if((0,m.default)(t.which,r.mouseButtonMask)){var l=D.getConfiguration(),u=t.currentPoints.canvas,d=(0,E.getToolState)(n,b);if(d)for(var s=0;s<d.data.length;s++)if(i=d.data[s],I(n,i,u)||(0,h.default)(i.handles.textBox,u))return i.active=!0,a.updateImage(n),l.changeTextCallback(i,t,c),e.stopImmediatePropagation(),!1}function c(e,t,o){!0===o?(0,E.removeToolState)(n,b,e):e.text=t,e.active=!1,a.updateImage(n)}},onHandleDoneMove:w});D.setConfiguration(C);var U=(0,i.default)({addNewMeasurement:function(e){var t=e.element,n=P(e),r=o.default.cornerstone;function i(e){null===e?(0,E.removeToolState)(t,b,n):n.text=e,n.active=!1,r.updateImage(t);var o=a.default.MEASUREMENT_MODIFIED,i={toolType:b,element:t,measurementData:n};(0,_.default)(t,o,i),t.addEventListener(a.default.TOUCH_PRESS,U.pressCallback),t.addEventListener(a.default.TOUCH_START_ACTIVE,U.touchDownActivateCallback),t.addEventListener(a.default.TAP,U.tapCallback)}(0,E.addToolState)(t,b,n),t.removeEventListener(a.default.TOUCH_PRESS,U.pressCallback),t.removeEventListener(a.default.TOUCH_START_ACTIVE,U.touchDownActivateCallback),t.removeEventListener(a.default.TAP,U.tapCallback),r.updateImage(t),(0,v.default)(e,b,n,n.handles.end,function(){if((0,g.default)(e,n.handles))(0,E.removeToolState)(t,b,n);else{var a=D.getConfiguration();void 0===n.text&&a.getTextCallback(i),w(t,n)}r.updateImage(t)})},createNewMeasurement:P,onImageRendered:L,pointNearTool:I,toolType:b,pressCallback:function(e){var t=e.detail,n=t.element,r=o.default.cornerstone,i=void 0;function l(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,E.removeToolState)(n,b,e):e.text=t,e.active=!1,r.updateImage(n),n.addEventListener(a.default.TOUCH_START,U.touchStartCallback),n.addEventListener(a.default.TOUCH_START_ACTIVE,U.touchDownActivateCallback),n.addEventListener(a.default.TAP,U.tapCallback)}var u=D.getConfiguration(),d=t.currentPoints.canvas,s=(0,E.getToolState)(n,b);if(s){if(t.handlePressed)return n.removeEventListener(a.default.TOUCH_START,U.touchStartCallback),n.removeEventListener(a.default.TOUCH_START_ACTIVE,U.touchDownActivateCallback),n.removeEventListener(a.default.TAP,U.tapCallback),u.changeTextCallback(t.handlePressed,t,l),e.stopImmediatePropagation(),!1;for(var c=0;c<s.data.length;c++)if(i=s.data[c],I(n,i,d)||(0,h.default)(i.handles.textBox,d))return i.active=!0,r.updateImage(n),n.removeEventListener(a.default.TOUCH_START,U.touchStartCallback),n.removeEventListener(a.default.TOUCH_START_ACTIVE,U.touchDownActivateCallback),n.removeEventListener(a.default.TAP,U.tapCallback),u.changeTextCallback(i,t,l),e.stopImmediatePropagation(),!1;e.preventDefault(),e.stopPropagation()}},onHandleDoneMove:w});t.arrowAnnotate=D,t.arrowAnnotateTouch=U},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.angleTouch=t.angle=void 0;var a=m(n(0)),o=m(n(10)),r=m(n(11)),i=m(n(12)),l=m(n(47)),u=m(n(7)),d=m(n(9)),s=n(2),c=m(n(31)),f=n(3),v=m(n(14)),g=m(n(19));function m(e){return e&&e.__esModule?e:{default:e}}var h="angle";function p(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function E(e,t,n){return!1!==t.visible&&((0,c.default)(e,t.handles.start,t.handles.end,n)<5||(0,c.default)(e,t.handles.start2,t.handles.end2,n)<5)}function T(e){var t=e.detail,n=(0,s.getToolState)(e.currentTarget,h);if(void 0!==n)for(var o=(0,f.getNewContext)(t.canvasContext.canvas),r=x.getConfiguration(),l=a.default.cornerstone,c=function(e){var a=n.data[e];if(!1===a.visible)return"continue";(0,f.draw)(o,function(e){(0,f.setShadow)(e,r);var n=u.default.getColorIfActive(a),o=[{start:a.handles.start,end:a.handles.end},{start:a.handles.start2,end:a.handles.end2}];(0,f.drawLines)(e,t.element,o,{color:n}),(0,d.default)(e,t,a.handles),y(a,t.image);var s=a.rAngle;a.unit=String.fromCharCode(parseInt("00B0",16));var c=s.toString()+a.unit,v=l.pixelToCanvas(t.element,a.handles.start2),g=l.pixelToCanvas(t.element,a.handles.end2),m=(v.x+g.x)/2,h=(v.y+g.y)/2;(0,i.default)(e,c,m,h,n)})},v=0;v<n.data.length;v++)c(v)}function y(e,t){var n=(0,g.default)(t),a=n.rowPixelSpacing,o=n.colPixelSpacing;a=a||1,o=o||1;var r=(Math.ceil(e.handles.start.x)-Math.ceil(e.handles.end.x))*o,i=(Math.ceil(e.handles.start.y)-Math.ceil(e.handles.end.y))*a,u=(Math.ceil(e.handles.start2.x)-Math.ceil(e.handles.end2.x))*o,d=(Math.ceil(e.handles.start2.y)-Math.ceil(e.handles.end2.y))*a,s=Math.acos(Math.abs((r*u+i*d)/(Math.sqrt(r*r+i*i)*Math.sqrt(u*u+d*d))));s*=180/Math.PI,e.rAngle=(0,l.default)(s,2)}function M(e,t){y(t,a.default.cornerstone.getImage(e)),(0,v.default)(e,t,h)}var x=(0,o.default)({createNewMeasurement:p,onImageRendered:T,pointNearTool:E,toolType:h,onHandleDoneMove:M}),_=(0,r.default)({createNewMeasurement:p,onImageRendered:T,pointNearTool:E,toolType:h,onHandleDoneMove:M});t.angle=x,t.angleTouch=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(1)),o=d(n(0)),r=d(n(44)),i=d(n(60)),l=d(n(6)),u=n(4);function d(e){return e&&e.__esModule?e:{default:e}}var s=void 0,c=void 0,f=void 0,v=void 0,g=void 0,m=void 0,h=void 0,p=void 0,E=1,T=0,y=!1,M=!1,x=void 0,_=700,S=5,O="touchInput";function b(e){var t=o.default.cornerstone,n=e.currentTarget||e.srcEvent.currentTarget,i=t.getEnabledElement(n);if(i.image){var u=void 0,d=void 0,O=void 0,b=void 0;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(M=!1,clearTimeout(h)),e.type){case"tap":M=!1,clearTimeout(h),(c={page:o.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),u=a.default.TAP,g={event:e,viewport:t.getViewport(n),image:i.image,element:n,currentPoints:c,type:u,isTouchEvent:!0},(0,l.default)(n,u,g);break;case"doubletap":M=!1,clearTimeout(h),(c={page:o.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),u=a.default.DOUBLE_TAP,g={event:e,viewport:t.getViewport(n),image:i.image,element:n,currentPoints:c,type:u,isTouchEvent:!0},(0,l.default)(n,u,g);break;case"pinchstart":M=!1,clearTimeout(h),E=1;break;case"pinchmove":if(M=!1,clearTimeout(h),!0===y){E=e.scale,y=!1;break}d=(e.scale-E)/E,(s={page:e.center,image:t.pageToPixel(n,e.center.x,e.center.y)}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_PINCH,g={event:e,startPoints:s,viewport:t.getViewport(n),image:i.image,element:n,direction:e.scale<1?1:-1,scaleChange:d,type:u,isTouchEvent:!0},(0,l.default)(n,u,g),E=e.scale;break;case"touchstart":E=1,clearTimeout(h),clearTimeout(m),m=setTimeout(function(){(s={page:o.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:t.pageToPixel(n,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_START,e.touches.length>1&&(u=a.default.MULTI_TOUCH_START),g={event:e,viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,currentPoints:s,type:u,isTouchEvent:!0},!0===(0,l.default)(n,u,g)&&(u=a.default.TOUCH_START_ACTIVE,e.touches.length>1&&(u=a.default.MULTI_TOUCH_START_ACTIVE),g.type=u,(0,l.default)(n,u,g)),f=(0,r.default)(s)},50),M=!0,p=0,h=setTimeout(function(){M&&((c={page:o.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:t.pageToPixel(n,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_PRESS,g={event:e,viewport:t.getViewport(n),image:i.image,element:n,currentPoints:c,type:u,isTouchEvent:!0},(0,l.default)(n,u,g))},_);break;case"touchend":E=1,M=!1,clearTimeout(h),setTimeout(function(){(s={page:o.default.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:t.pageToPixel(n,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=t.pixelToCanvas(n,s.image),u=a.default.TOUCH_END,g={event:e,viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,currentPoints:s,type:u,isTouchEvent:!0},(0,l.default)(n,u,g)},50);break;case"panmove":O={x:e.deltaX-x.x,y:e.deltaY-x.y},x={x:e.deltaX,y:e.deltaY},(c={page:{x:f.page.x+O.x,y:f.page.y+O.y},image:t.pageToPixel(n,f.page.x+O.x,f.page.y+O.y),client:{x:f.client.x+O.x,y:f.client.y+O.y}}).canvas=t.pixelToCanvas(n,c.image),v={page:o.default.cornerstoneMath.point.subtract(c.page,f.page),image:o.default.cornerstoneMath.point.subtract(c.image,f.image),client:o.default.cornerstoneMath.point.subtract(c.client,f.client),canvas:o.default.cornerstoneMath.point.subtract(c.canvas,f.canvas)},(p+=Math.sqrt(v.page.x*v.page.x+v.page.y*v.page.y))>S&&(M=!1,clearTimeout(h)),u=a.default.TOUCH_DRAG,e.pointers.length>1&&(u=a.default.MULTI_TOUCH_DRAG),g={viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,lastPoints:f,currentPoints:c,deltaPoints:v,numPointers:e.pointers.length,type:u,isTouchEvent:!0},(0,l.default)(n,u,g),f=(0,r.default)(c);break;case"panstart":x={x:e.deltaX,y:e.deltaY},(c={page:o.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),f=(0,r.default)(c);break;case"panend":if(M=!1,clearTimeout(h),!f)return!1;(c={page:o.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=t.pixelToCanvas(n,c.image),v={page:o.default.cornerstoneMath.point.subtract(c.page,f.page),image:o.default.cornerstoneMath.point.subtract(c.image,f.image),client:o.default.cornerstoneMath.point.subtract(c.client,f.client),canvas:o.default.cornerstoneMath.point.subtract(c.canvas,f.canvas)},u=a.default.TOUCH_DRAG_END,g={event:e.srcEvent,viewport:t.getViewport(n),image:i.image,element:n,startPoints:s,lastPoints:f,currentPoints:c,deltaPoints:v,type:u,isTouchEvent:!0},(0,l.default)(n,u,g),2===e.pointers.length-e.changedPointers.length&&(y=!0);break;case"rotatemove":M=!1,clearTimeout(h),b=e.rotation-T,T=e.rotation,u=a.default.TOUCH_ROTATE,g={event:e.srcEvent,viewport:t.getViewport(n),image:i.image,element:n,rotation:b,type:u},(0,l.default)(n,u,g)}return!1}}function C(e){i.default.disable(e);["touchstart","touchend"].forEach(function(t){e.removeEventListener(t,b)});var t=(0,u.getToolOptions)(O,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",b)}var P={enable:function(e){C(e);var t=o.default.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},a=new t.Manager(e,n),r={pointers:0,direction:t.DIRECTION_ALL,threshold:0},l=new t.Pan(r),d=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});d.recognizeWith(l),d.recognizeWith(s),s.recognizeWith(l);var c=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(l),a.add([c,l,s,d]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",b),i.default.enable(e),["touchstart","touchend"].forEach(function(t){e.addEventListener(t,b)});var f=(0,u.getToolOptions)(O,e);f.hammer=a,(0,u.setToolOptions)(O,e,f)},disable:C};t.default=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(1)),o=i(n(0)),r=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=o.default.cornerstone,n=e.currentTarget,i=t.getEnabledElement(n);if(i.image&&!("mousewheel"===e.type&&0===e.wheelDeltaY||"DOMMouseScroll"===e.type&&1===e.axis)){e.preventDefault();var l=void 0,u=void 0;void 0!==e.pageX&&void 0!==e.pageY?(l=e.pageX,u=e.pageY):(l=e.x,u=e.y);var d=t.pageToPixel(n,l,u),s=((e=window.event&&window.event.wheelDelta?window.event:e).wheelDelta?e.wheelDelta:e.deltaY?-e.deltaY:e.detail?-e.detail:e.wheelDelta)<0?-1:1,c={element:n,viewport:t.getViewport(n),image:i.image,direction:s,pageX:l,pageY:u,imageX:d.x,imageY:d.y};(0,r.default)(n,a.default.MOUSE_WHEEL,c)}}var u=["mousewheel","DOMMouseScroll"];function d(e){u.forEach(function(t){e.removeEventListener(t,l)})}var s={enable:function(e){d(e),u.forEach(function(t){e.addEventListener(t,l)})},disable:d};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n(1)),o=l(n(0)),r=l(n(44)),i=l(n(6));function l(e){return e&&e.__esModule?e:{default:e}}var u=!0,d=void 0,s=200;function c(e){return"number"!=typeof e.buttons?e.which:0===e.buttons?0:e.buttons%2==1?1:e.buttons%4==2?3:e.buttons%8==4?2:0}function f(){u=!1}function v(e){var t=o.default.cornerstone,n=e.currentTarget,l=t.getEnabledElement(n);if(l.image){var u=a.default.MOUSE_DOUBLE_CLICK,d={page:o.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};d.canvas=t.pixelToCanvas(n,d.image);var s=(0,r.default)(d),c={event:e,which:e.which,viewport:t.getViewport(n),image:l.image,element:n,startPoints:d,lastPoints:s,currentPoints:d,deltaPoints:{x:0,y:0},type:u};(0,i.default)(n,u,c)}}function g(e){var t=o.default.cornerstone,n=e.currentTarget,l=t.getEnabledElement(n);if(l.image){d=setTimeout(f,s);var v=a.default.MOUSE_DOWN;n.removeEventListener("mousemove",m);var g={page:o.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};g.canvas=t.pixelToCanvas(n,g.image);var h=(0,r.default)(g),p={event:e,which:c(e),viewport:t.getViewport(n),image:l.image,element:n,startPoints:g,lastPoints:h,currentPoints:g,deltaPoints:{x:0,y:0},type:v};(0,i.default)(p.element,v,p)&&(p.type=a.default.MOUSE_DOWN_ACTIVATE,(0,i.default)(p.element,a.default.MOUSE_DOWN_ACTIVATE,p));var E=c(e);document.addEventListener("mousemove",T),document.addEventListener("mouseup",function e(r){clearTimeout(d);var s=a.default.MOUSE_UP;u&&(s=a.default.MOUSE_CLICK);var c={page:o.default.cornerstoneMath.point.pageToPoint(r),image:t.pageToPixel(n,r.pageX,r.pageY),client:{x:r.clientX,y:r.clientY}};c.canvas=t.pixelToCanvas(n,c.image);var f={page:o.default.cornerstoneMath.point.subtract(c.page,h.page),image:o.default.cornerstoneMath.point.subtract(c.image,h.image),client:o.default.cornerstoneMath.point.subtract(c.client,h.client),canvas:o.default.cornerstoneMath.point.subtract(c.canvas,h.canvas)},v={event:r,which:E,viewport:t.getViewport(n),image:l.image,element:n,startPoints:g,lastPoints:h,currentPoints:c,deltaPoints:f,type:s};(0,i.default)(v.element,s,v),document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",e),n.addEventListener("mousemove",m),u=!0})}function T(e){var u=a.default.MOUSE_DRAG,d={page:o.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};d.canvas=t.pixelToCanvas(n,d.image);var s={page:o.default.cornerstoneMath.point.subtract(d.page,h.page),image:o.default.cornerstoneMath.point.subtract(d.image,h.image),client:o.default.cornerstoneMath.point.subtract(d.client,h.client),canvas:o.default.cornerstoneMath.point.subtract(d.canvas,h.canvas)},c={which:E,viewport:t.getViewport(n),image:l.image,element:n,startPoints:g,lastPoints:h,currentPoints:d,deltaPoints:s,type:u,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};(0,i.default)(c.element,u,c),h=(0,r.default)(d)}}function m(e){var t=o.default.cornerstone,n=e.currentTarget,l=t.getEnabledElement(n);if(l.image){var u=a.default.MOUSE_MOVE,d={page:o.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};d.canvas=t.pixelToCanvas(n,d.image);var s=(0,r.default)(d),c={page:o.default.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};c.canvas=t.pixelToCanvas(n,c.image);var f={page:o.default.cornerstoneMath.point.subtract(c.page,s.page),image:o.default.cornerstoneMath.point.subtract(c.image,s.image),client:o.default.cornerstoneMath.point.subtract(c.client,s.client),canvas:o.default.cornerstoneMath.point.subtract(c.canvas,s.canvas)},v={viewport:t.getViewport(n),image:l.image,element:n,startPoints:d,lastPoints:s,currentPoints:c,deltaPoints:f,type:u};(0,i.default)(n,u,v),s=(0,r.default)(c)}}function h(e){e.removeEventListener("mousedown",g),e.removeEventListener("mousemove",m),e.removeEventListener("dblclick",v)}var p={enable:function(e){h(e),e.addEventListener("mousedown",g),e.addEventListener("mousemove",m),e.addEventListener("dblclick",v)},disable:h};t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(1)),o=i(n(0)),r=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var l=void 0,u=void 0;function d(e){var t=o.default.cornerstone,n=e.currentTarget,i=t.getEnabledElement(n);if(i.image){var d={event:window.event||e,element:n,viewport:t.getViewport(n),image:i.image,currentPoints:{page:{x:l,y:u},image:t.pageToPixel(n,l,u)},keyCode:e.keyCode,which:e.which};d.currentPoints.canvas=t.pixelToCanvas(n,d.currentPoints.image);var s={keydown:a.default.KEY_DOWN,keypress:a.default.KEY_PRESS,keyup:a.default.KEY_UP};(0,r.default)(n,s[e.type],d)}}function s(e){l=e.pageX,u=e.pageY}var c=["keydown","keypress","keyup"];var f={enable:function(e){c.forEach(function(t){e.removeEventListener(t,d),e.addEventListener(t,d)}),e.removeEventListener("mousemove",s),e.addEventListener("mousemove",s)},disable:function(e){c.forEach(function(t){e.removeEventListener(t,d)}),e.removeEventListener("mousemove",s)}};t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stopClip=t.playClip=void 0;var a=u(n(1)),o=u(n(0)),r=u(n(16)),i=n(2),l=u(n(6));function u(e){return e&&e.__esModule?e:{default:e}}var d="playClip";function s(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}t.playClip=function(e,t){var n=void 0,u=void 0;if(void 0===e)throw new Error("playClip: element must not be undefined");var c=(0,i.getToolState)(e,"stack");if(c&&c.data&&c.data.length){var f=o.default.cornerstone,v=void 0;if(c.data.length>1){var g=(0,i.getToolState)(e,"stackRenderer");g&&g.data&&g.data.length&&(v=g.data[0])}var m=c.data[0],h=(0,i.getToolState)(e,d);h&&h.data&&h.data.length?s(n=h.data[0]):(n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},(0,i.addToolState)(e,d,n)),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===m.imageIds.length&&(u=function(e,t){var n=void 0,a=void 0,o=void 0,r=0,i=e.length,l=[];for(l.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)o=Number(e[n])/t|0,l.push(o),1===n?a=o:o!==a&&(l.isTimeVarying=!0),r+=o;return l.length>0&&(o=l.isTimeVarying?r/l.length|0:l[0],l.push(o)),l}(n.frameTimeVector,n.speed));var p=function(){var t=void 0,o=void 0,i=void 0,u=m.currentImageIdIndex,d=m.imageIds.length;if(n.reverse?u--:u++,!n.loop&&(u<0||u>=d))return s(n),void function(e){var t={element:e};(0,l.default)(e,a.default.CLIP_STOPPED,t)}(e);u>=d&&(u=0),u<0&&(u=d-1),u!==m.currentImageIdIndex&&(t=r.default.getStartLoadHandler(),o=r.default.getEndLoadHandler(),i=r.default.getErrorLoadingHandler(),t&&t(e),(!0===m.preventCache?f.loadImage(m.imageIds[u]):f.loadAndCacheImage(m.imageIds[u])).then(function(t){try{m.currentImageIdIndex=u,v?(v.currentImageIdIndex=u,v.render(e,c.data)):f.displayImage(e,t),o&&o(e,t)}catch(e){return}},function(t){var n=m.imageIds[u];i&&i(e,n,t)}))};u&&u.length>0&&u.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout(function e(){n.intervalId=setTimeout(e,u[m.currentImageIdIndex]),p()},0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(p,1e3/Math.abs(n.framesPerSecond)))}},t.stopClip=function(e){var t=(0,i.getToolState)(e,d);t&&t.data&&t.data.length&&s(t.data[0])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),r=n(2);var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return a(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=(0,r.getToolState)(e,"stack").data);var a=o.default.cornerstone,i=t[0],l=i.imageIds[this.currentImageIdIndex],u=t.slice(1,t.length);return a.loadAndCacheImage(l).then(function(t){var o=n.layerIds[0],r=[];return o?a.setLayerImage(e,t,o):(o=a.addLayer(e,t,i.options),n.layerIds.push(o)),a.displayImage(e,t),u.forEach(function(t,i){var u=n.findImageFn(t.imageIds,l),d=i+1,s=n.layerIds[d];if(s||(s=a.addLayer(e,void 0,t.options),n.layerIds.push(s)),u){var c=a.loadAndCacheImage(u).then(function(t){a.setLayerImage(e,t,s),a.updateImage(e)});r.push(c)}else a.setLayerImage(e,void 0,s),a.setActiveLayer(e,o),a.updateImage(e)}),Promise.all(r)})}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(120));var o={};o.FusionRenderer=a.default,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(27)),o=n(2),r=n(3);var i=6;var l=(0,a.default)(function(e){var t=e.detail,n=t.element,a=t.enabledElement.canvas.width,u=t.enabledElement.canvas.height;if(!a||!u)return!1;var d=(0,r.getNewContext)(t.enabledElement.canvas);(0,r.draw)(d,function(e){var t=l.getConfiguration(),d=void 0;d="horizontal"===t.orientation?{left:0,top:u-i,width:a,height:i}:{left:0,top:0,width:i,height:u},(0,r.fillBox)(e,d,t.backgroundColor);var s=(0,o.getToolState)(n,"stack");if(s&&s.data&&s.data.length){var c=s.data[0].imageIds,f=s.data[0].currentImageIdIndex,v=a/c.length,g=u/c.length,m=v*f,h=g*f;d="horizontal"===t.orientation?{left:m,top:u-i,width:v,height:i}:{left:0,top:h,width:i,height:g},(0,r.fillBox)(e,d,t.fillColor)}})});l.setConfiguration({backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"}),t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(n(0)),o=u(n(49)),r=u(n(16)),i=n(2),l=n(37);function u(e){return e&&e.__esModule?e:{default:e}}var d="stackPrefetch",s="prefetch",c={maxImagesToPrefetch:1/0,preserveExistingPool:!1},f=void 0,v=10;var g=function(e){return Math.max.apply(null,e)},m=function(e){return Math.min.apply(null,e)};function h(e){var t=(0,i.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],l=(0,i.getToolState)(e,d);if(l){var u=l.data[0]||{};if(u.indicesToRequest&&u.indicesToRequest.length||(u.enabled=!1),!1!==u.enabled)if(l.data[0].indicesToRequest.sort(function(e,t){return e-t}),u.indicesToRequest.slice().forEach(function(e){var t=n.imageIds[e];t&&(a.default.cornerstone.imageCache.getImageLoadObject(t)&&D(e))}),u.indicesToRequest.length){c.preserveExistingPool||o.default.clearRequestStack(s);for(var f=function(e,t){var n=[],a=[];return e.forEach(function(e){e<t?n.push(e):e>t&&a.push(e)}),{low:e.indexOf(g(n)),high:e.indexOf(m(a))}}(u.indicesToRequest,n.currentImageIdIndex),v=void 0,h=void 0,p=r.default.getErrorLoadingHandler(),E=f.low,T=f.high,y=[];E>=0||T<u.indicesToRequest.length;){var M=n.currentImageIdIndex,x=M-u.indicesToRequest[E]>c.maxImagesToPrefetch,_=u.indicesToRequest[T]-M>c.maxImagesToPrefetch,S=!x&&E>=0,O=!_&&T<u.indicesToRequest.length;if(!O&&!S)break;S&&(h=u.indicesToRequest[E--],v=n.imageIds[h],y.push(v)),O&&(h=u.indicesToRequest[T++],v=n.imageIds[h],y.push(v))}var b=!0,C=!1,P=void 0;try{for(var I,L=y.reverse()[Symbol.iterator]();!(b=(I=L.next()).done);b=!0){var w=I.value;o.default.addRequest(e,w,s,!1,U,A,!0)}}catch(e){C=!0,P=e}finally{try{!b&&L.return&&L.return()}finally{if(C)throw P}}o.default.startGrabbing()}}}function D(e){var t=u.indicesToRequest.indexOf(e);t>-1&&u.indicesToRequest.splice(t,1)}function U(e){D(n.imageIds.indexOf(e.imageId))}function A(t){console.log("prefetch errored: "+t),p&&p(e,v,t,"stackPrefetch")}}function p(e){return function(t){var n=t.detail,a=void 0;try{a=(0,i.getToolState)(e,"stack")}catch(e){return}if(a&&a.data&&a.data.length){var o=a.data[0].imageIds.indexOf(n.imageId);if(!(o<0)){var r=(0,i.getToolState)(e,d);r&&r.data&&r.data.length&&r.data[0].indicesToRequest.push(o)}}}}function E(e){clearTimeout(f),f=setTimeout(function(){var t=e.target;try{h(t)}catch(e){return}},v)}var T={enable:function(e){(0,i.getToolState)(e,d).data=[];var t=(0,i.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var o={indicesToRequest:function(e,t){e=Math.round(e)||0;var n=[],a=(t=Math.round(t)||0)-e+1;if(a<=0)return n;for(;a--;)n[a]=t--;return n}(0,n.imageIds.length-1),enabled:!0,direction:1},r=o.indicesToRequest.indexOf(n.currentImageIdIndex);o.indicesToRequest.splice(r,1),(0,i.addToolState)(e,d,o),h(e),e.removeEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,E),e.addEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,E);var l=p(e);a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,l),a.default.cornerstone.events.addEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,l)}else console.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(f),e.removeEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,E);var t=p(e);a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=(0,i.getToolState)(e,d);n&&n.data.length&&(n.data[0].enabled=!1,o.default.clearRequestStack(s))},getConfiguration:function(){return c},setConfiguration:function(e){c=e,e.maxSimultaneousRequests&&(0,l.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}};t.default=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=void 0;var a=f(n(1)),o=f(n(20)),r=f(n(41)),i=f(n(18)),l=f(n(33)),u=f(n(5)),d=f(n(48)),s=n(2),c=n(4);function f(e){return e&&e.__esModule?e:{default:e}}var v="stackScroll";function g(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,m),t.removeEventListener(a.default.MOUSE_UP,g),t.removeEventListener(a.default.MOUSE_CLICK,g)}function m(e){var t=e.detail,n=t.element,a=(0,s.getToolState)(n,"stack");if(a&&a.data&&a.data.length){var o=a.data[0],r=h.getConfiguration(),i=!0;r&&void 0!==r.allowSkipping&&(i=r.allowSkipping);var l=Math.max(2,n.offsetHeight/Math.max(o.imageIds.length,8));r&&r.stackScrollSpeed&&(l=r.stackScrollSpeed);var u=(0,c.getToolOptions)(v,n),f=u.deltaY||0;if(f+=t.deltaPoints.page.y,Math.abs(f)>=l){var g=Math.round(f/l);(0,d.default)(n,g,!1,i),u.deltaY=f%l}else u.deltaY=f;(0,c.setToolOptions)(v,n,u),e.preventDefault(),e.stopPropagation()}}var h=(0,i.default)(function(e){var t=e.detail,n=t.element,o=(0,c.getToolOptions)(v,n);if((0,u.default)(t.which,o.mouseButtonMask))return o.deltaY=0,(0,c.setToolOptions)(v,n,o),n.addEventListener(a.default.MOUSE_DRAG,m),n.addEventListener(a.default.MOUSE_UP,g),n.addEventListener(a.default.MOUSE_CLICK,g),e.stopImmediatePropagation(),!1},v),p=(0,l.default)(function(e){var t=e.detail,n=-t.direction,a=h.getConfiguration(),o=!1,r=!0;a&&(o=void 0!==a.loop&&a.loop,r=void 0===a.allowSkipping||a.allowSkipping),(0,d.default)(t.element,n,o,r)}),E={eventData:{deltaY:0}},T=(0,o.default)(m,"stackScrollTouchDrag",E);var y=(0,r.default)(function(e){var t=e.detail,n=y.getConfiguration();n&&n.testPointers(t)&&m(e)},E);y.setConfiguration({testPointers:function(e){return e.numPointers>=3}}),t.stackScroll=h,t.stackScrollWheel=p,t.stackScrollTouchDrag=T,t.stackScrollMultiTouch=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(48));function o(e){return e&&e.__esModule?e:{default:e}}var r={UP:38,DOWN:40};var i=(0,o(n(63)).default)(function(e){var t=e.detail,n=t.keyCode;if(n===r.UP||n===r.DOWN){var o=1;n===r.DOWN&&(o=-1),(0,a.default)(t.element,o)}});t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=n(30),r=n(2);var i={save:function(e){var t={imageIdToolState:o.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var n=(0,r.getElementToolStateManager)(e);n!==o.globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=n.saveToolState(),t.elementViewport[e.id]=a.default.cornerstone.getViewport(e))}),t},restore:function(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport")){var t=a.default.cornerstone;return o.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(n){var a=document.getElementById(n);if(a&&e.elementToolState.hasOwnProperty(n)){var i=(0,r.getElementToolStateManager)(a);if(i!==o.globalImageIdSpecificToolStateManager){i.restoreToolState(e.elementToolState[n]);var l=e.elementViewport[n];t.setViewport(a,l),t.updateImage(a)}}}),e}}};t.default=i},function(e,t,n){"use strict";function a(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}},add:function(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(a)},remove:function(t,n,a){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n)){for(var r=o[n],i=-1,l=0;l<r.data.length;l++)r.data[l]===a&&(i=l);-1!==i&&r.data.splice(i,1)}}}}}Object.defineProperty(t,"__esModule",{value:!0});var o=a();t.newFrameOfReferenceSpecificToolStateManager=a,t.globalFrameOfReferenceSpecificToolStateManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=void 0;var a=n(30),o=n(2);function r(e,t){var n={};return{get:function(a,o){return e.indexOf(o)>=0?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(a,o)},add:function(a,o,r){if(!(e.indexOf(o)>=0))return t.add(a,o,r);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(r)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var i=[];function l(e,t){var n=(0,o.getElementToolStateManager)(e);n||(n=a.globalImageIdSpecificToolStateManager);var l=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(l=l.concat(t));var u=r(l,n);i.push(u),(0,o.setElementToolStateManager)(e,u)}var u={newStackSpecificToolStateManager:r,addStackStateManager:l};t.stackSpecificStateManager=u,t.newStackSpecificToolStateManager=r,t.addStackStateManager=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=void 0;var a=n(30),o=n(2);function r(e,t){var n={};return{get:function(a,o){return e.indexOf(o)>=0?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(a,o)},add:function(a,o,r){if(!(e.indexOf(o)>=0))return t.add(a,o,r);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(r)}}}var i=[];t.addTimeSeriesStateManager=function(e,t){t=t||["timeSeries"];var n=(0,o.getElementToolStateManager)(e);void 0===n&&(n=a.globalImageIdSpecificToolStateManager);var l=r(t,n);i.push(l),(0,o.setElementToolStateManager)(e,l)},t.newTimeSeriesSpecificToolStateManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var o=a.default.cornerstone,r=o.getViewport(t),i=o.getViewport(n);i.scale===r.scale&&i.translation.x===r.translation.x&&i.translation.y===r.translation.y||(i.scale=r.scale,i.translation.x=r.translation.x,i.translation.y=r.translation.y,e.setViewport(n,i))}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var l=a.default.cornerstone,u=(0,o.getToolState)(t,"stack").data[0],d=(0,o.getToolState)(n,"stack").data[0],s=u.currentImageIdIndex;if((s=(0,i.default)(s,0,d.imageIds.length-1))!==d.currentImageIdIndex){var c=r.default.getStartLoadHandler(),f=r.default.getEndLoadHandler(),v=r.default.getErrorLoadingHandler();c&&c(n);(!0===d.preventCache?l.loadImage(d.imageIds[s]):l.loadAndCacheImage(d.imageIds[s])).then(function(t){var a=l.getViewport(n);d.currentImageIdIndex=s,e.displayImage(n,t,a),f&&f(n,t)},function(e){var t=d.imageIds[s];v&&v(n,t,e)})}}};var a=l(n(0)),o=n(2),r=l(n(16)),i=l(n(8));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l,u){if(n!==t){var d=a.default.cornerstone,s=d.getEnabledElement(t),c=d.metaData.get("imagePlaneModule",s.image.imageId);if(void 0!==c&&void 0!==c.imagePositionPatient){var f=(0,i.default)(c.imagePositionPatient),v=(0,o.getToolState)(n,"stack").data[0],g=Number.MAX_VALUE,m=-1;if(u){var h=f.clone().add(u);if(v.imageIds.forEach(function(e,t){var n=d.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=(0,i.default)(n.imagePositionPatient),o=h.distanceToSquared(a);o<g&&(g=o,m=t)}}),m!==v.currentImageIdIndex&&-1!==m){var p=r.default.getStartLoadHandler(),E=r.default.getEndLoadHandler(),T=r.default.getErrorLoadingHandler();v.currentImageIdIndex=m;var y=v.imageIds[m];p&&p(n);(!0===v.preventCache?d.loadImage(y):d.loadAndCacheImage(y)).then(function(t){var a=d.getViewport(n);v.currentImageIdIndex===m&&(e.displayImage(n,t,a),E&&E(n,t))},function(e){var t=v.imageIds[m];T&&T(n,t,e)})}}}}};var a=l(n(0)),o=n(2),r=l(n(16)),i=l(n(23));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var l=a.default.cornerstone,u=l.getEnabledElement(t).image,d=l.metaData.get("imagePlaneModule",u.imageId);if(void 0!==d&&void 0!==d.imagePositionPatient){var s=(0,i.default)(d.imagePositionPatient),c=(0,o.getToolState)(n,"stack").data[0],f=Number.MAX_VALUE,v=-1;if(c.imageIds.forEach(function(e,t){var n=l.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=(0,i.default)(n.imagePositionPatient).distanceToSquared(s);a<f&&(f=a,v=t)}}),v!==c.currentImageIdIndex){var g=r.default.getStartLoadHandler(),m=r.default.getEndLoadHandler(),h=r.default.getErrorLoadingHandler();c.currentImageIdIndex=v;var p=c.imageIds[v];if(g&&g(n),-1!==v){(!0===c.preventCache?l.loadImage(p):l.loadAndCacheImage(p)).then(function(t){var a=l.getViewport(n);c.currentImageIdIndex===v&&(e.displayImage(n,t,a),m&&m(n,t))},function(e){var t=c.imageIds[v];h&&h(n,t,e)})}}}}};var a=l(n(0)),o=n(2),r=l(n(16)),i=l(n(23));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,l){if(t!==n&&l&&l.direction){var u=a.default.cornerstone,d=(0,o.getToolState)(n,"stack").data[0],s=d.currentImageIdIndex+l.direction;if(s=(0,i.default)(s,0,d.imageIds.length-1),d.currentImageIdIndex!==s){var c=r.default.getStartLoadHandler(),f=r.default.getEndLoadHandler(),v=r.default.getErrorLoadingHandler();d.currentImageIdIndex=s;var g=d.imageIds[s];c&&c(n);(!0===d.preventCache?u.loadImage(g):u.loadAndCacheImage(g)).then(function(t){var a=u.getViewport(n);d.currentImageIdIndex===s&&(e.displayImage(n,t,a),f&&f(n,t))},function(e){var t=d.imageIds[s];v&&v(n,t,e)})}}};var a=l(n(0)),o=n(2),r=l(n(16)),i=l(n(8));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),o=i(n(23)),r=n(4);function i(e){return e&&e.__esModule?e:{default:e}}function l(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})}t.default=function(e,t){var n=a.default.cornerstone,i=this,u=[],d=[],s=!1,c={},f=t;function v(e,t){i.enabled&&u.length&&d.length&&(s=!0,d.forEach(function(n){var a=d.indexOf(n);if(-1!==a){var o=c.imageIds.targetElements[a],r=u.indexOf(e);if(-1!==r){var l=c.imageIds.sourceElements[r],s=void 0;l===o?s=0:void 0!==c.distances[l]&&(s=c.distances[l][o]),f(i,e,n,t,s)}}}),s=!1)}function g(e){var t=e.detail;!0!==s&&v(e.currentTarget,t)}function m(e){var t=e.detail.element;i.remove(t),(0,r.clearToolOptionsByElement)(t)}this.enabled=!0,this.setHandler=function(e){f=e},this.getHandler=function(){return f},this.getDistances=function(){u.length&&d.length&&(c.distances={},c.imageIds={sourceElements:[],targetElements:[]},u.forEach(function(e){var t=n.getEnabledElement(e);if(t&&t.image){var a=t.image.imageId,r=n.metaData.get("imagePlaneModule",a);if(r&&r.imagePositionPatient){var i=(0,o.default)(r.imagePositionPatient);c.hasOwnProperty(t)||(c.distances[a]={},c.imageIds.sourceElements.push(a),d.forEach(function(t){var r=n.getEnabledElement(t);if(r&&r.image){var l=r.image.imageId;if(c.imageIds.targetElements.push(l),e!==t&&a!==l&&!c.distances[a].hasOwnProperty(l)){var u=n.metaData.get("imagePlaneModule",l);if(u&&u.imagePositionPatient){var d=(0,o.default)(u.imagePositionPatient);c.distances[a][l]=d.clone().sub(i)}}}}),Object.keys(c.distances[a]).length||delete c.distances[a])}}}))},this.addSource=function(t){-1===u.indexOf(t)&&(u.push(t),e.split(" ").forEach(function(e){t.addEventListener(e,g)}),i.getDistances(),i.updateDisableHandlers())},this.addTarget=function(e){-1===d.indexOf(e)&&(d.push(e),i.getDistances(),f(i,e,e,0),i.updateDisableHandlers())},this.add=function(e){i.addSource(e),i.addTarget(e)},this.removeSource=function(t){var n=u.indexOf(t);-1!==n&&(u.splice(n,1),e.split(" ").forEach(function(e){t.removeEventListener(e,g)}),i.getDistances(),v(t),i.updateDisableHandlers())},this.removeTarget=function(e){var t=d.indexOf(e);-1!==t&&(d.splice(t,1),i.getDistances(),f(i,e,e,0),i.updateDisableHandlers())},this.remove=function(e){i.removeTarget(e),i.removeSource(e)},this.getSourceElements=function(){return u},this.getTargetElements=function(){return d},this.displayImage=function(e,t,a){s=!0,n.displayImage(e,t,a),s=!1},this.setViewport=function(e,t){s=!0,n.setViewport(e,t),s=!1},this.updateDisableHandlers=function(){l(u.concat(d)).forEach(function(e){e.removeEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED,m),e.addEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED,m)})},this.destroy=function(){l(u.concat(d)).forEach(function(e){i.remove(e)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){n!==t&&a.default.cornerstone.updateImage(n)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var o=a.default.cornerstone,r=o.getViewport(t),i=o.getViewport(n);i.voi.windowWidth===r.voi.windowWidth&&i.voi.windowCenter===r.voi.windowCenter&&i.invert===r.invert||(i.voi.windowWidth=r.voi.windowWidth,i.voi.windowCenter=r.voi.windowCenter,i.invert=r.invert,e.setViewport(n,i))}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=void 0;var a=c(n(1)),o=c(n(18)),r=c(n(20)),i=c(n(33)),l=c(n(42)),u=c(n(5)),d=n(2),s=n(4);function c(e){return e&&e.__esModule?e:{default:e}}var f="timeSeriesScroll";function v(e){var t=e.detail.element;t.removeEventListener(a.default.MOUSE_DRAG,g),t.removeEventListener(a.default.MOUSE_UP,v),t.removeEventListener(a.default.MOUSE_CLICK,v)}function g(e){var t=e.detail,n=t.element;e.data.deltaY+=t.deltaPoints.page.y;var a=(0,d.getToolState)(t.element,"timeSeries");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var o=a.data[0],r=n.offsetHeight/o.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(r=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=r||e.data.deltaY<=-r){var i=Math.round(e.data.deltaY/r),u=e.data.deltaY%r;(0,l.default)(t.element,i),e.data.deltaY=u}return!1}}var m=(0,o.default)(function(e){var t=e.detail,n=t.element,o=(0,s.getToolOptions)(f,n);if((0,u.default)(t.which,o.mouseButtonMask))return o.deltaY=0,(0,s.setToolOptions)(f,n,o),n.addEventListener(a.default.MOUSE_DRAG,g),n.addEventListener(a.default.MOUSE_UP,v),n.addEventListener(a.default.MOUSE_CLICK,v),e.stopImmediatePropagation(),!1},f),h=(0,i.default)(function(e){var t=e.detail,n=-t.direction;(0,l.default)(t.element,n)}),p=(0,r.default)(function(e){var t=e.originalEvent.detail,n={deltaY:0};n.deltaY+=t.deltaPoints.page.y;var a=(0,d.getToolState)(t.element,"stack");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){if(n.deltaY>=3||n.deltaY<=-3){var o=n.deltaY/3,r=n.deltaY%3;(0,l.default)(n.element,o),n.deltaY=r}return!1}});t.timeSeriesScroll=m,t.timeSeriesScrollWheel=h,t.timeSeriesScrollTouchDrag=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n(42));var r="timeSeriesPlayer";var i={start:function(e,t){if(void 0===e)throw new Error("playClip: element must not be undefined");void 0===t&&(t=30);var n=(0,a.getToolState)(e,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var i=(0,a.getToolState)(e,r),l=void 0;void 0===i||0===i.data.length?(l={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},(0,a.addToolState)(e,r,l)):(l=i.data[0]).framesPerSecond=t,void 0===l.intervalId&&(l.intervalId=setInterval(function(){l.framesPerSecond>0?(0,o.default)(e,1,!0):(0,o.default)(e,-1,!0)},1e3/Math.abs(l.framesPerSecond)))}},stop:function(e){var t=(0,a.getToolState)(e,r);if(t&&t.data&&t.data.length){var n=t.data[0];clearInterval(n.intervalId),n.intervalId=void 0}}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=o.default.cornerstone,t=this;t.samples=[],this.set=function(n){t.samples=n,(0,r.default)(e.events,a.default.LINE_SAMPLE_UPDATED)}};var a=i(n(1)),o=i(n(0)),r=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(1)),o=i(n(0)),r=i(n(6));function i(e){return e&&e.__esModule?e:{default:e}}var l=new function(){var e=o.default.cornerstone,t=this;t.measurements=[],this.add=function(n){var o={index:t.measurements.push(n),measurement:n};(0,r.default)(e.events,a.default.MEASUREMENT_ADDED,o)},this.remove=function(n){var o=t.measurements[n];t.measurements.splice(n,1);var i={index:n,measurement:o};(0,r.default)(e.events,a.default.MEASUREMENT_REMOVED,i)}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(0)),o=c(n(10)),r=c(n(9)),i=n(2),l=c(n(141)),u=c(n(140)),d=c(n(12)),s=n(3);function c(e){return e&&e.__esModule?e:{default:e}}var f="probe4D";var v=(0,o.default)({createNewMeasurement:function(e){var t=(0,i.getToolState)(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var n=t.data[0],o={timeSeries:n,lineSample:new u.default,imageIdIndex:n.stacks[n.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return function(e){var t=a.default.cornerstone,n=[];e.timeSeries.stacks.forEach(function(a){(!0===a.preventCache?t.loadImage(a.imageIds[e.imageIdIndex]):t.loadAndCacheImage(a.imageIds[e.imageIdIndex])).then(function(t){var a=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*t.width,o=t.getPixelData()[a];n.push(o)})}),e.lineSample.set(n)}(o),l.default.add(o),o}},onImageRendered:function(e){var t=a.default.cornerstone,n=e.detail,o=(0,i.getToolState)(e.currentTarget,f);if(o){var l=n.canvasContext;l.setTransform(1,0,0,1,0,0);for(var u=function(e){(0,s.draw)(l,function(a){var i=o.data[e];(0,r.default)(a,n,i.handles,"white");var l={x:i.handles.end.x+3,y:i.handles.end.y-3},u=t.pixelToCanvas(n.element,l);(0,d.default)(a,i.handles.end.x+", "+i.handles.end.y,u.x,u.y,"white")})},c=0;c<o.data.length;c++)u(c)}},toolType:f});t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){var r={color:n,lineWidth:o};(0,a.drawCircle)(e,void 0,t,6,r,"canvas")};var a=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r){var i={x:t,y:n},l={x:t+o,y:n+r};(0,a.drawEllipse)(e,void 0,i,l,{},"canvas")};var a=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return a.default.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return t=(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=(0,o.default)(e),n="",r=t.x<0?"R":"L",i=t.y<0?"A":"P",l=t.z<0?"F":"H",u=new a.default.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),d=0;d<3;d++)if(u.x>1e-4&&u.x>u.y&&u.x>u.z)n+=r,u.x=0;else if(u.y>1e-4&&u.y>u.x&&u.y>u.z)n+=i,u.y=0;else{if(!(u.z>1e-4&&u.z>u.x&&u.z>u.y))break;n+=l,u.z=0}return n};var a=r(n(0)),o=r(n(23));function r(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefault=function(e,t){return void 0!==e?e:t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(0)),o=n(2),r=i(n(69));function i(e){return e&&e.__esModule?e:{default:e}}var l="referenceLines";function u(e){var t=e.detail,n=(0,o.getToolState)(e.currentTarget,l);if(void 0!==n){var r=n.data[0].synchronizationContext.getSourceElements(),i=n.data[0].renderer,u=t.canvasContext.canvas.getContext("2d");a.default.cornerstone.setToPixelCoordinateSystem(t.enabledElement,u),r.forEach(function(n){n!==e.currentTarget&&i(u,t,e.currentTarget,n)})}}var d={enable:function(e,t,n){n=n||r.default,(0,o.addToolState)(e,l,{synchronizationContext:t,renderer:n}),e.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,u),e.addEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,u),a.default.cornerstone.updateImage(e)},disable:function(e){e.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,u),a.default.cornerstone.updateImage(e)}};t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(70)),o=i(n(150)),r=i(n(69));function i(e){return e&&e.__esModule?e:{default:e}}var l={calculateReferenceLine:a.default,tool:o.default,renderActiveReferenceLine:r.default};t.default=l}])});
//# sourceMappingURL=cornerstoneTools.min.js.map